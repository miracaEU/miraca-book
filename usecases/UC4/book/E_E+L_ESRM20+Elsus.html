
<!DOCTYPE html>


<html lang="en" data-content_root="../../../" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>UC4 &#8212; MIRACA Technical Workbench</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  <!--
    this give us a css class that will be invisible only if js is disabled
  -->
  <noscript>
    <style>
      .pst-js-only { display: none !important; }

    </style>
  </noscript>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../../../_static/styles/theme.css?digest=8878045cc6db502f8baf" rel="stylesheet" />
<link href="../../../_static/styles/pydata-sphinx-theme.css?digest=8878045cc6db502f8baf" rel="stylesheet" />

    <link rel="stylesheet" type="text/css" href="../../../_static/pygments.css?v=03e43079" />
    <link rel="stylesheet" type="text/css" href="../../../_static/styles/sphinx-book-theme.css?v=eba8b062" />
    <link rel="stylesheet" type="text/css" href="../../../_static/togglebutton.css?v=13237357" />
    <link rel="stylesheet" type="text/css" href="../../../_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="../../../_static/mystnb.8ecb98da25f57f5357bf6f572d296f466b2cfe2517ffebfabe82451661e28f02.css?v=6644e6bb" />
    <link rel="stylesheet" type="text/css" href="../../../_static/sphinx-thebe.css?v=4fa983c6" />
    <link rel="stylesheet" type="text/css" href="../../../_static/sphinx-design.min.css?v=95c83b7e" />
  
  <!-- So that users can add custom icons -->
  <script src="../../../_static/scripts/fontawesome.js?digest=8878045cc6db502f8baf"></script>
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../../../_static/scripts/bootstrap.js?digest=8878045cc6db502f8baf" />
<link rel="preload" as="script" href="../../../_static/scripts/pydata-sphinx-theme.js?digest=8878045cc6db502f8baf" />

    <script src="../../../_static/documentation_options.js?v=9eb32ce0"></script>
    <script src="../../../_static/doctools.js?v=9a2dae69"></script>
    <script src="../../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../../_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="../../../_static/copybutton.js?v=f281be69"></script>
    <script src="../../../_static/scripts/sphinx-book-theme.js?v=887ef09a"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../../../_static/togglebutton.js?v=4a39c7ea"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="../../../_static/design-tabs.js?v=f930bc37"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script async="async" src="../../../_static/sphinx-thebe.js?v=c100c467"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'usecases/UC4/book/E_E+L_ESRM20+Elsus';</script>
    <link rel="author" title="About these documents" href="../../../about.html" />
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
    <link rel="next" title="Use Case 5 - Energy" href="../../UC5/Use_Case_5_v1.html" />
    <link rel="prev" title="Use case 3 - Flooding in Zuid-Holland" href="../../UC3/book/Use_Case_template.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  <meta name="docsearch:version" content="" />
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <dialog id="pst-search-dialog">
    
<form class="bd-search d-flex align-items-center"
      action="../../../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form>
  </dialog>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <dialog id="pst-primary-sidebar-modal"></dialog>
      <div id="pst-primary-sidebar" class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">

  
    
  

<a class="navbar-brand logo" href="../../../intro.html">
  
  
  
  
  
    
    
      
    
    
    <img src="../../../_static/logo.png" class="logo__image only-light" alt="MIRACA Technical Workbench - Home"/>
    <img src="../../../_static/logo.png" class="logo__image only-dark pst-js-only" alt="MIRACA Technical Workbench - Home"/>
  
  
</a></div>
        <div class="sidebar-primary-item">

<button class="btn search-button-field search-button__button pst-js-only" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
 <i class="fa-solid fa-magnifying-glass"></i>
 <span class="search-button__default-text">Search</span>
 <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
</button></div>
        <div class="sidebar-primary-item"><nav class="bd-links bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="../../../intro.html">
                    Welcome to the Miraca Book
                </a>
            </li>
        </ul>
        <p aria-level="2" class="caption" role="heading"><span class="caption-text">The Miraca approach</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../../../riskassessment/miraca_approach.html">Description of the framework</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../../riskassessment/example.html">Example: Belgium road infrastructure</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../riskassessment/AssetRiskModelling/book/risk_assessment_belgium.html">Climate Risk Assessment</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../riskassessment/Systemic-Economic-Impact/book/systemic_impacts_belgium.html">Systemic Economic impacts</a></li>
</ul>
</details></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Use Cases</span></p>
<ul class="current nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../../introduction.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../placeholder1.html">Use Case 1 - Flooding and windstorms in the TEN-T corridor</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../placeholder2.html">Use Case 2 - Wildfires in Catalonia</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../UC3/book/Use_Case_template.html">Use case 3 - Flooding in Zuid-Holland</a></li>
<li class="toctree-l1 current active"><a class="current reference internal" href="#">Use Case 4 - Landslides &amp; Earthquake in Greece</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../UC5/Use_Case_5_v1.html">Use Case 5 - Energy</a></li>




</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Technical background</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1 has-children"><a class="reference internal" href="../../../background/Exposure_Miraca/book/intro.html">Exposure database</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../background/Exposure_Miraca/book/Exposure_Miraca.html">Exploring the Critical Infrastructure Exposure Database</a></li>
</ul>
</details></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../../background/Vulnerability/book/intro.html">Vulnerability Database</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../background/Vulnerability/book/Vulnerability_workbench.html">Explore the Vulnerability database</a></li>
</ul>
</details></li>
<li class="toctree-l1"><a class="reference internal" href="../../../background/RoadFlowModelling/book/miraca_roads.html">Network modelling</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../background/CBAmodelling/book/miraca_cba.html">Cost-benefit analysis</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../../background/AdaptationModelling/book/01_direct_damages_baseline.html">Adaptation strategies to Critical Infrastructure</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../background/AdaptationModelling/book/02_indirect_damages_baseline.html">Adaptation of Critical Infrastructure - Indirect losses</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../background/AdaptationModelling/book/03_batch_process_adaptations.html">Adaptation of CI - Calculate adaptations</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../background/AdaptationModelling/book/04_results_summary.html">Summary</a></li>
</ul>
</details></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">About</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../../../about.html">About Miraca</a></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
      <div class="sidebar-primary-item">
<div id="ethical-ad-placement"
      class="flat"
      data-ea-publisher="readthedocs"
      data-ea-type="readthedocs-sidebar"
      data-ea-manual="true">
</div></div>
  </div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><button class="sidebar-toggle primary-toggle btn btn-sm" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</button></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-source-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Source repositories">
    <i class="fab fa-github"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://github.com/miracaEU/miraca-book" target="_blank"
   class="btn btn-sm btn-source-repository-button dropdown-item"
   title="Source repository"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="btn__text-container">Repository</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/miracaEU/miraca-book/issues/new?title=Issue%20on%20page%20%2Fusecases/UC4/book/E_E+L_ESRM20+Elsus.html&body=Your%20issue%20content%20here." target="_blank"
   class="btn btn-sm btn-source-issues-button dropdown-item"
   title="Open an issue"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="btn__text-container">Open issue</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="../../../_sources/usecases/UC4/book/E_E+L_ESRM20+Elsus.ipynb" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.ipynb</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button pst-js-only" aria-label="Color mode" data-bs-title="Color mode"  data-bs-placement="bottom" data-bs-toggle="tooltip">
  <i class="theme-switch fa-solid fa-sun                fa-lg" data-mode="light" title="Light"></i>
  <i class="theme-switch fa-solid fa-moon               fa-lg" data-mode="dark"  title="Dark"></i>
  <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"  title="System Settings"></i>
</button>


<button class="btn btn-sm pst-navbar-icon search-button search-button__button pst-js-only" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
</button>
<button class="sidebar-toggle secondary-toggle btn btn-sm" title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</button>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>UC4</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#single-hazard-seismic-risk-assessment">Single hazard - Seismic risk assessment</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#multi-hazard-earthquake-triggered-landslide">Multi hazard - Earthquake triggered landslide</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#pl-1-0">PL = 1.0</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id1">PL &lt; 1.0</a></li>
</ul>
</li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section class="tex2jax_ignore mathjax_ignore" id="uc4">
<h1>UC4<a class="headerlink" href="#uc4" title="Link to this heading">#</a></h1>
<p>UC4 (Adaptation to societal risk of geohazards through schools and hospitals in Greece) will highlight the importance of incorporating geohazards, such as earthquakes and landslides, and hydrological hazards (floods) into climate adaptation strategies. Climate change can intensify extreme weather conditions, which may subsequently increase the frequency and severity of geohazards (e.g., landslides) and hydrological hazards (e.g., floods). UC4 will assess the societal and economic risk of healthcare and educational facilities in Central Macedonia, Greece, under varying climate change scenarios. By evaluating both single-hazard and multi-hazard events, UC4 will contribute to shaping effective adaptation strategies to mitigate their impacts to critical infrastructures, like schools and hospitals.</p>
<section id="single-hazard-seismic-risk-assessment">
<h2>Single hazard - Seismic risk assessment<a class="headerlink" href="#single-hazard-seismic-risk-assessment" title="Link to this heading">#</a></h2>
<ul class="simple">
<li><p>Use of the newly developed open-access European Seismic Hazard maps (ESHM20, Danciu, et al., 2021) which provide PGA and spectral accelerations at different periods (T=0.3s, 0.6s, 1s, 1.5s) at bedrock for six different return periods, i.e.,  Tm= 73 years, 102 years, 475 years, 1000 years, 2500 years, 5000 years) derived from probabilistic seismic hazard analysis (PSHA)</p></li>
<li><p>Estimate median PGA and spectral accelerations at different periods (Sa(T)) at the ground surface for the different return periods considering a detailed site model using Openquake engine</p></li>
<li><p>Exposure model: based on GEM building taxonomy</p></li>
<li><p>Vulnerability assessment: Use of appropriate seismic vulnerability curves for schools and hospitals (e.g., ESRM20) and appropriate literature curves for concrete precast buildings (Yesilyurt et al. 2021)</p></li>
<li><p>Seismic risk assessment : Results will be given in terms of loss maps for different return periods and loss exceedance curves</p></li>
</ul>
<div class="cell tag_hide-input docutils container">
<details class="admonition hide above-input">
<summary aria-label="Toggle hidden content">
<p class="collapsed admonition-title">Show code cell source</p>
<p class="expanded admonition-title">Hide code cell source</p>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># HIDE CODE</span>
<span class="c1"># Import necessary libraries</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">os</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">sys</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">warnings</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">inspect</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">pandas</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">pd</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">geopandas</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">gpd</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">rasterio</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">shapely.geometry</span><span class="w"> </span><span class="kn">import</span> <span class="n">Point</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">scipy.stats</span><span class="w"> </span><span class="kn">import</span> <span class="n">lognorm</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">rasterstats</span><span class="w"> </span><span class="kn">import</span> <span class="n">point_query</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">rasterio.warp</span><span class="w"> </span><span class="kn">import</span> <span class="n">calculate_default_transform</span><span class="p">,</span> <span class="n">reproject</span><span class="p">,</span> <span class="n">Resampling</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">mpl</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.pyplot</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">plt</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.colors</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">mcolors</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">matplotlib</span><span class="w"> </span><span class="kn">import</span> <span class="n">rcParams</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">matplotlib.lines</span><span class="w"> </span><span class="kn">import</span> <span class="n">Line2D</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">matplotlib</span><span class="w"> </span><span class="kn">import</span> <span class="n">font_manager</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">matplotlib.offsetbox</span><span class="w"> </span><span class="kn">import</span> <span class="n">OffsetImage</span><span class="p">,</span> <span class="n">AnnotationBbox</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">rasterio.features</span><span class="w"> </span><span class="kn">import</span> <span class="n">shapes</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">matplotlib.colors</span><span class="w"> </span><span class="kn">import</span> <span class="n">ListedColormap</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">gc</span> 
<span class="kn">from</span><span class="w"> </span><span class="nn">pathlib</span><span class="w"> </span><span class="kn">import</span> <span class="n">Path</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">shapely</span><span class="w"> </span><span class="kn">import</span> <span class="n">wkt</span>



<span class="c1"># Ignore all warnings</span>
<span class="n">warnings</span><span class="o">.</span><span class="n">filterwarnings</span><span class="p">(</span><span class="s2">&quot;ignore&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</details>
</div>
<p>Select whether you want to compute the risk assessment for educational buildings (asset = “Schools”) or healthcare facilities (asset = “Hospitals”).</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">asset</span> <span class="o">=</span> <span class="s2">&quot;Schools&quot;</span>
</pre></div>
</div>
</div>
</div>
<p>Define the folder where the data is available and where the results will be saved.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">data_path</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">())</span> <span class="o">/</span> <span class="s1">&#39;data&#39;</span>

<span class="n">savepath</span> <span class="o">=</span> <span class="n">Path</span><span class="o">.</span><span class="n">home</span><span class="p">()</span> <span class="o">/</span> <span class="s1">&#39;UC4&#39;</span> <span class="o">/</span> <span class="s1">&#39;Results&#39;</span> <span class="o">/</span> <span class="n">asset</span>
</pre></div>
</div>
</div>
</div>
<p>The following color variables are defined for the Miraca theme. These colors will be used for visualizations. The font settings for the plots are also adjusted for consistency.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># miraca colors</span>
<span class="n">c1</span> <span class="o">=</span> <span class="s1">&#39;#4069F6&#39;</span> <span class="c1"># primary blue 500 </span>
<span class="n">c2</span> <span class="o">=</span> <span class="s1">&#39;#171E37&#39;</span> <span class="c1"># black</span>
<span class="n">c3</span> <span class="o">=</span> <span class="s1">&#39;#64F4C0&#39;</span> <span class="c1"># accent green </span>
<span class="n">c4</span> <span class="o">=</span> <span class="s1">&#39;#FFFFFF&#39;</span> <span class="c1"># white</span>
<span class="n">c5</span> <span class="o">=</span> <span class="s1">&#39;#ED5861&#39;</span> <span class="c1"># red</span>
<span class="n">c6</span> <span class="o">=</span> <span class="s1">&#39;#F8CD48&#39;</span> <span class="c1"># yellow</span>
<span class="n">c7</span> <span class="o">=</span> <span class="s1">&#39;#72DA95&#39;</span> <span class="c1"># green 500</span>
<span class="n">c8</span> <span class="o">=</span> <span class="s1">&#39;#373D52&#39;</span> <span class="c1"># grey 900</span>
<span class="n">c9</span> <span class="o">=</span> <span class="s1">&#39;#8F94A3&#39;</span> <span class="c1"># grey 500</span>
<span class="n">c10</span> <span class="o">=</span> <span class="s1">&#39;#EBEDF5&#39;</span> <span class="c1"># grey 100</span>
<span class="n">c11</span> <span class="o">=</span> <span class="s1">&#39;#72DA95&#39;</span> <span class="c1"># green</span>
<span class="n">c12</span> <span class="o">=</span> <span class="s1">&#39;#373D52&#39;</span> <span class="c1"># blue 900</span>
<span class="n">c13</span> <span class="o">=</span> <span class="s1">&#39;#6687F8&#39;</span> <span class="c1"># blue 400</span>
<span class="n">c14</span> <span class="o">=</span> <span class="s1">&#39;#EBEDF5&#39;</span> <span class="c1"># blue 100</span>
<span class="n">c15</span> <span class="o">=</span> <span class="s1">&#39;#373D52&#39;</span> <span class="c1"># 429787 900</span>
<span class="n">c16</span> <span class="o">=</span> <span class="s1">&#39;#9CF8D7&#39;</span> <span class="c1"># green 400</span>
<span class="n">c17</span> <span class="o">=</span> <span class="s1">&#39;#E0FDF2&#39;</span> <span class="c1"># green 100</span>

<span class="c1"># Adjust font settings</span>
<span class="n">mpl</span><span class="o">.</span><span class="n">rc</span><span class="p">(</span><span class="s1">&#39;font&#39;</span><span class="p">,</span> <span class="n">family</span><span class="o">=</span><span class="s1">&#39;Calibri&#39;</span><span class="p">)</span>
<span class="n">font</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;family&#39;</span><span class="p">:</span> <span class="s1">&#39;Calibri&#39;</span><span class="p">,</span> <span class="s1">&#39;weight&#39;</span><span class="p">:</span> <span class="s1">&#39;bold&#39;</span><span class="p">}</span>
<span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;mathtext.default&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;regular&#39;</span>
<span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;mathtext.rm&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">font</span><span class="p">[</span><span class="s1">&#39;family&#39;</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<p>This dictionary initializes a DataFrame containing seismic return period data. The ‘No’ column represents a sequential identifier for each seismic scenario. The ‘Return_Period’ column specifies the return period in years, and the ‘1/years’ column provides the corresponding annual probability of occurrence (i.e., the inverse of the return period). The resulting DataFrame, Scenaria, captures these seismic scenario details.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">data</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;No&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">5</span><span class="p">],</span>
        <span class="s1">&#39;Return_Period&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">73</span><span class="p">,</span><span class="mi">102</span><span class="p">,</span><span class="mi">475</span><span class="p">,</span><span class="mi">1000</span><span class="p">,</span><span class="mi">2500</span><span class="p">,</span><span class="mi">5000</span><span class="p">],</span>
        <span class="s1">&#39;1/years&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mf">0.0137</span><span class="p">,</span><span class="mf">0.0098</span><span class="p">,</span><span class="mf">0.0021</span><span class="p">,</span><span class="mf">0.001</span><span class="p">,</span><span class="mf">0.0003</span><span class="p">,</span><span class="mf">0.0001</span><span class="p">]</span>
<span class="p">}</span>

<span class="n">Scenaria</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Load &amp; visualise exposure data</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Load exposure data</span>
<span class="k">if</span> <span class="n">asset</span> <span class="o">==</span> <span class="s2">&quot;Schools&quot;</span><span class="p">:</span>
    <span class="n">csv1_path</span> <span class="o">=</span> <span class="n">data_path</span> <span class="o">/</span> <span class="s2">&quot;Exposure_Riskschools.csv&quot;</span>
<span class="k">else</span><span class="p">:</span>
    <span class="n">csv1_path</span> <span class="o">=</span> <span class="n">data_path</span> <span class="o">/</span> <span class="s2">&quot;Exposure_Hospitals.csv&quot;</span>


<span class="c1"># Load the CSV file into pandas DataFrames</span>
<span class="n">df1</span><span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">csv1_path</span><span class="p">)</span>

<span class="c1"># Column names for longitude and latitude</span>
<span class="n">longitude_col1</span> <span class="o">=</span> <span class="s1">&#39;Longitude&#39;</span>
<span class="n">latitude_col1</span> <span class="o">=</span> <span class="s1">&#39;Latitude&#39;</span>

<span class="c1"># Convert the DataFrame to GeoDataFrames</span>
<span class="n">gdf1</span> <span class="o">=</span> <span class="n">gpd</span><span class="o">.</span><span class="n">GeoDataFrame</span><span class="p">(</span><span class="n">df1</span><span class="p">,</span> <span class="n">geometry</span><span class="o">=</span><span class="n">gpd</span><span class="o">.</span><span class="n">points_from_xy</span><span class="p">(</span><span class="n">df1</span><span class="p">[</span><span class="n">longitude_col1</span><span class="p">],</span> <span class="n">df1</span><span class="p">[</span><span class="n">latitude_col1</span><span class="p">]))</span>

<span class="c1"># Set the CRS  </span>
<span class="n">gdf1</span><span class="o">.</span><span class="n">set_crs</span><span class="p">(</span><span class="n">epsg</span><span class="o">=</span><span class="mi">4326</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="n">gdf1</span><span class="o">.</span><span class="n">explore</span><span class="p">(</span>
    <span class="n">marker_kwds</span><span class="o">=</span><span class="p">{</span>
        <span class="s2">&quot;radius&quot;</span><span class="p">:</span> <span class="mi">4</span><span class="p">,</span>  <span class="c1"># Scale marker size (adjust as needed)</span>
        <span class="s2">&quot;fill&quot;</span><span class="p">:</span> <span class="kc">True</span>
    <span class="p">},</span>
    <span class="n">color</span><span class="o">=</span><span class="n">c1</span><span class="p">,</span>                         <span class="c1"># Color map: Orange-Red (you can change it)</span>
    <span class="n">legend</span><span class="o">=</span><span class="kc">True</span>                          <span class="c1"># Show legend</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Load &amp; visualise hazard data</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Load hazard data</span>
<span class="n">csv2_path</span> <span class="o">=</span> <span class="n">data_path</span> <span class="o">/</span> <span class="s2">&quot;Hazard_Central_Macedonia.csv&quot;</span>

<span class="c1"># Load the CSV file into pandas DataFrames</span>
<span class="n">df2</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">csv2_path</span><span class="p">)</span>

<span class="c1"># Column names for longitude and latitude</span>
<span class="n">longitude_col2</span> <span class="o">=</span> <span class="s1">&#39;lon&#39;</span>
<span class="n">latitude_col2</span> <span class="o">=</span> <span class="s1">&#39;lat&#39;</span>

<span class="c1"># Convert the DataFrame to GeoDataFrames</span>
<span class="n">gdf2</span> <span class="o">=</span> <span class="n">gpd</span><span class="o">.</span><span class="n">GeoDataFrame</span><span class="p">(</span><span class="n">df2</span><span class="p">,</span> <span class="n">geometry</span><span class="o">=</span><span class="n">gpd</span><span class="o">.</span><span class="n">points_from_xy</span><span class="p">(</span><span class="n">df2</span><span class="p">[</span><span class="n">longitude_col2</span><span class="p">],</span> <span class="n">df2</span><span class="p">[</span><span class="n">latitude_col2</span><span class="p">]))</span>

<span class="c1"># Set the CRS </span>
<span class="n">gdf2</span><span class="o">.</span><span class="n">set_crs</span><span class="p">(</span><span class="n">epsg</span><span class="o">=</span><span class="mi">4326</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>


<span class="n">gdf2</span><span class="o">.</span><span class="n">explore</span><span class="p">(</span>
    <span class="n">column</span><span class="o">=</span><span class="s2">&quot;PGA-0.001&quot;</span><span class="p">,</span>
    <span class="n">cmap</span><span class="o">=</span><span class="s2">&quot;OrRd&quot;</span><span class="p">,</span>
    <span class="n">legend</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">legend_kwds</span><span class="o">=</span><span class="p">{</span>
        <span class="s1">&#39;caption&#39;</span><span class="p">:</span> <span class="s1">&#39;PGA (T=1000 years)&#39;</span><span class="p">,</span>
        <span class="s1">&#39;orientation&#39;</span><span class="p">:</span> <span class="s1">&#39;horizontal&#39;</span>  <span class="c1"># optional: &#39;horizontal&#39; or &#39;vertical&#39;</span>
    <span class="p">},</span>
    <span class="n">marker_kwds</span><span class="o">=</span><span class="p">{</span>
        <span class="s1">&#39;radius&#39;</span><span class="p">:</span> <span class="mi">4</span><span class="p">,</span>
        <span class="s1">&#39;fill&#39;</span><span class="p">:</span> <span class="kc">True</span>
    <span class="p">}</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>The follwing csv file contains the spatially joined data of exposure and hazard points, with the nearest hazard point coordinates added for each exposure point.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Perform the spatial join using the nearest neighbor method</span>
<span class="n">joined_gdf</span> <span class="o">=</span> <span class="n">gpd</span><span class="o">.</span><span class="n">sjoin_nearest</span><span class="p">(</span><span class="n">gdf1</span><span class="p">,</span> <span class="n">gdf2</span><span class="p">,</span> <span class="n">how</span><span class="o">=</span><span class="s2">&quot;left&quot;</span><span class="p">,</span> <span class="n">distance_col</span><span class="o">=</span><span class="s2">&quot;distance&quot;</span><span class="p">)</span>

<span class="c1"># Add nearest x and y coordinates from gdf2</span>

<span class="n">joined_gdf</span><span class="p">[</span><span class="s1">&#39;nearest_x&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">joined_gdf</span><span class="p">[</span><span class="n">longitude_col2</span><span class="p">]</span>  <span class="c1"># Nearest longitude from gdf2</span>
<span class="n">joined_gdf</span><span class="p">[</span><span class="s1">&#39;nearest_y&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">joined_gdf</span><span class="p">[</span><span class="n">latitude_col2</span><span class="p">]</span>   <span class="c1"># Nearest latitude from gdf2</span>

<span class="c1"># Ensure the directory exists before saving</span>
<span class="n">savepath</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">parents</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="c1"># Save the joined GeoDataFrame to CSV</span>
<span class="n">joined_gdf</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">savepath</span> <span class="o">/</span> <span class="sa">f</span><span class="s2">&quot;Joined_nearest_hazard_</span><span class="si">{</span><span class="n">asset</span><span class="si">}</span><span class="s2">.csv&quot;</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>


<span class="n">joined_gdf</span><span class="o">.</span><span class="n">explore</span><span class="p">(</span>
    <span class="n">column</span><span class="o">=</span><span class="s2">&quot;PGA-0.001&quot;</span><span class="p">,</span>
    <span class="n">cmap</span><span class="o">=</span><span class="s2">&quot;OrRd&quot;</span><span class="p">,</span>
    <span class="n">legend</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">legend_kwds</span><span class="o">=</span><span class="p">{</span>
        <span class="s1">&#39;caption&#39;</span><span class="p">:</span> <span class="s1">&#39;PGA (T=1000 years)&#39;</span><span class="p">,</span>
        <span class="s1">&#39;orientation&#39;</span><span class="p">:</span> <span class="s1">&#39;horizontal&#39;</span>  <span class="c1"># optional: &#39;horizontal&#39; or &#39;vertical&#39;</span>
    <span class="p">},</span>
    <span class="n">marker_kwds</span><span class="o">=</span><span class="p">{</span>
        <span class="s1">&#39;radius&#39;</span><span class="p">:</span> <span class="mi">4</span><span class="p">,</span>
        <span class="s1">&#39;fill&#39;</span><span class="p">:</span> <span class="kc">True</span>
    <span class="p">},</span>
    <span class="n">tooltip</span><span class="o">=</span><span class="s2">&quot;PGA-0.001&quot;</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Load the the European Landslide Susceptibility Map version 2 for the region of central Macedonia in Greece (already converting raster data into polygons - precomputed data). Also, it was performed spatial join to find the nearest raster values by linking each exposure point with the nearest raster values from the landslide susceptibility map.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Load the CSV</span>
<span class="n">csv3_path</span> <span class="o">=</span> <span class="n">data_path</span> <span class="o">/</span> <span class="sa">f</span><span class="s2">&quot;Joined_nearest_susceptibility_</span><span class="si">{</span><span class="n">asset</span><span class="si">}</span><span class="s2">.csv&quot;</span>

<span class="n">susc</span><span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">csv3_path</span><span class="p">)</span>

<span class="c1"># Convert WKT string to geometry (assuming the column is named &#39;geometry&#39;)</span>
<span class="n">susc</span><span class="p">[</span><span class="s1">&#39;geometry&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">susc</span><span class="p">[</span><span class="s1">&#39;geometry&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">wkt</span><span class="o">.</span><span class="n">loads</span><span class="p">)</span>

<span class="c1"># Convert to GeoDataFrame</span>
<span class="n">joined_gdf</span> <span class="o">=</span> <span class="n">gpd</span><span class="o">.</span><span class="n">GeoDataFrame</span><span class="p">(</span><span class="n">susc</span><span class="p">,</span> <span class="n">geometry</span><span class="o">=</span><span class="s1">&#39;geometry&#39;</span><span class="p">)</span>

<span class="c1"># Set the correct CRS if known (replace EPSG:4326 if different)</span>
<span class="n">joined_gdf</span><span class="o">.</span><span class="n">set_crs</span><span class="p">(</span><span class="s2">&quot;EPSG:4326&quot;</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">);</span>
</pre></div>
</div>
</div>
</div>
<p>Visualise susceptibility map</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Step 1: Ensure raster_value is treated as categorical with specific order</span>
<span class="n">joined_gdf</span><span class="p">[</span><span class="s2">&quot;Susceptibility_index&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Categorical</span><span class="p">(</span>
    <span class="n">joined_gdf</span><span class="p">[</span><span class="s2">&quot;raster_value&quot;</span><span class="p">],</span>
    <span class="n">categories</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">],</span>
    <span class="n">ordered</span><span class="o">=</span><span class="kc">True</span>
<span class="p">)</span>

<span class="c1"># Step 2: Define custom colors for each class (adjust as needed)</span>
<span class="n">colors</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;#ffffcc&#39;</span><span class="p">,</span> <span class="s1">&#39;#a1dab4&#39;</span><span class="p">,</span> <span class="s1">&#39;#41b6c4&#39;</span><span class="p">,</span> <span class="s1">&#39;#2c7fb8&#39;</span><span class="p">,</span> <span class="s1">&#39;red&#39;</span><span class="p">]</span>  <span class="c1"># Light yellow to dark blue</span>

<span class="c1"># Step 3: Plot with .explore using the categorical column and custom colors</span>
<span class="n">joined_gdf</span><span class="o">.</span><span class="n">explore</span><span class="p">(</span>
    <span class="n">column</span><span class="o">=</span><span class="s2">&quot;Susceptibility_index&quot;</span><span class="p">,</span>
    <span class="c1">#cmap=ListedColormap(colors),</span>
    <span class="n">cmap</span><span class="o">=</span><span class="s2">&quot;OrRd&quot;</span><span class="p">,</span>
    <span class="n">legend</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">legend_kwds</span><span class="o">=</span><span class="p">{</span>
        <span class="s1">&#39;caption&#39;</span><span class="p">:</span> <span class="s1">&#39;Susceptibility Index&#39;</span><span class="p">,</span>
        <span class="s1">&#39;orientation&#39;</span><span class="p">:</span> <span class="s1">&#39;horizontal&#39;</span>
    <span class="p">},</span>
    <span class="n">marker_kwds</span><span class="o">=</span><span class="p">{</span>
        <span class="s1">&#39;radius&#39;</span><span class="p">:</span> <span class="mi">4</span><span class="p">,</span>
        <span class="s1">&#39;fill&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
    <span class="p">},</span>
    <span class="n">text</span><span class="o">=</span><span class="s2">&quot;Susceptibility_index&quot;</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Final dataframe containing exposure and hazard (earthquake and landslides) data</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Load Exposure and Hazard Data</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">savepath</span> <span class="o">/</span> <span class="sa">f</span><span class="s2">&quot;Joined_nearest_hazard_</span><span class="si">{</span><span class="n">asset</span><span class="si">}</span><span class="s2">.csv&quot;</span><span class="p">)</span>
<span class="c1"># Load the CSV file with the new column</span>
<span class="n">new_column_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">data_path</span> <span class="o">/</span> <span class="sa">f</span><span class="s2">&quot;Joined_nearest_susceptibility_</span><span class="si">{</span><span class="n">asset</span><span class="si">}</span><span class="s2">.csv&quot;</span><span class="p">)</span>
<span class="n">df</span><span class="p">[</span><span class="s1">&#39;SAMPLE_1&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">new_column_df</span><span class="p">[</span><span class="s1">&#39;raster_value&#39;</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<p>Extract values for fragility based on Typology.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Load ESRM20 data</span>
<span class="n">sheet_name</span> <span class="o">=</span> <span class="s2">&quot;Final&quot;</span>
<span class="n">Fragility</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_excel</span><span class="p">(</span><span class="n">data_path</span> <span class="o">/</span> <span class="s2">&quot;fragility_various_IM_lognormal.xlsx&quot;</span><span class="p">,</span> <span class="n">sheet_name</span><span class="o">=</span><span class="n">sheet_name</span><span class="p">)</span>
<span class="n">Fragility</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Typology&#39;</span><span class="p">,</span> <span class="s1">&#39;IMT&#39;</span><span class="p">,</span> <span class="s1">&#39;Median_DS1&#39;</span><span class="p">,</span> <span class="s1">&#39;Median_DS2&#39;</span><span class="p">,</span> <span class="s1">&#39;Median_DS3&#39;</span><span class="p">,</span> <span class="s1">&#39;Median_DS4&#39;</span><span class="p">,</span> <span class="s1">&#39;Beta_DS1&#39;</span><span class="p">,</span> <span class="s2">&quot;Beta_DS2&quot;</span><span class="p">,</span> <span class="s2">&quot;Beta_DS3&quot;</span><span class="p">,</span><span class="s2">&quot;Beta_DS4&quot;</span><span class="p">]</span>

<span class="c1"># Initialize lists to store results</span>
<span class="n">IM1</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">IM2</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">IM3</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">IM4</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">Beta_DS1</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">Beta_DS2</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">Beta_DS3</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">Beta_DS4</span> <span class="o">=</span> <span class="p">[]</span>

<span class="c1"># Iterate over each value in &#39;Typology&#39; column of data</span>
<span class="k">for</span> <span class="n">taxonomy</span> <span class="ow">in</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;Typology&#39;</span><span class="p">]:</span>
    <span class="c1"># Check if any row in &#39;Typology&#39; column matches current taxonomy</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">Fragility</span><span class="p">[</span><span class="s1">&#39;Typology&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">taxonomy</span><span class="p">)</span><span class="o">.</span><span class="n">any</span><span class="p">():</span>
        <span class="c1"># Find the row where &#39;Typology&#39; matches and retrieve values</span>
        <span class="n">filtered_data</span> <span class="o">=</span> <span class="n">Fragility</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">Fragility</span><span class="p">[</span><span class="s1">&#39;Typology&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">taxonomy</span><span class="p">]</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">filtered_data</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
            <span class="n">IM1</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">filtered_data</span><span class="p">[</span><span class="s1">&#39;Median_DS1&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="n">IM2</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">filtered_data</span><span class="p">[</span><span class="s1">&#39;Median_DS2&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="n">IM3</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">filtered_data</span><span class="p">[</span><span class="s1">&#39;Median_DS3&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="n">IM4</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">filtered_data</span><span class="p">[</span><span class="s1">&#39;Median_DS4&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="n">Beta_DS1</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">filtered_data</span><span class="p">[</span><span class="s1">&#39;Beta_DS1&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="n">Beta_DS2</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">filtered_data</span><span class="p">[</span><span class="s1">&#39;Beta_DS2&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="n">Beta_DS3</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">filtered_data</span><span class="p">[</span><span class="s1">&#39;Beta_DS3&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="n">Beta_DS4</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">filtered_data</span><span class="p">[</span><span class="s1">&#39;Beta_DS4&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># Handle case where no matching Typology is found in ESRM20</span>
            <span class="n">IM1</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>
            <span class="n">IM2</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>
            <span class="n">IM3</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>
            <span class="n">IM4</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>
            <span class="n">Beta_DS1</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>
            <span class="n">Beta_DS2</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>
            <span class="n">Beta_DS3</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>            
            <span class="n">Beta_DS4</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># Handle case where no matching Typology is found in ESRM20</span>
        <span class="n">IM1</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>
        <span class="n">IM2</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>
        <span class="n">IM3</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>
        <span class="n">IM4</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>
        <span class="n">Beta_DS1</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>
        <span class="n">Beta_DS2</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>
        <span class="n">Beta_DS3</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>            
        <span class="n">Beta_DS4</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>

<span class="c1"># Create a new DataFrame to store results</span>
<span class="n">IM</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span>
    <span class="s1">&#39;IM1&#39;</span><span class="p">:</span> <span class="n">IM1</span><span class="p">,</span>
    <span class="s1">&#39;IM2&#39;</span><span class="p">:</span> <span class="n">IM2</span><span class="p">,</span>
    <span class="s1">&#39;IM3&#39;</span><span class="p">:</span> <span class="n">IM3</span><span class="p">,</span>
    <span class="s1">&#39;IM4&#39;</span><span class="p">:</span> <span class="n">IM4</span><span class="p">,</span>
    <span class="s1">&#39;Beta_DS1&#39;</span><span class="p">:</span> <span class="n">Beta_DS1</span><span class="p">,</span>
    <span class="s1">&#39;Beta_DS2&#39;</span><span class="p">:</span> <span class="n">Beta_DS2</span><span class="p">,</span>
    <span class="s1">&#39;Beta_DS3&#39;</span><span class="p">:</span> <span class="n">Beta_DS3</span> <span class="p">,</span>   
    <span class="s1">&#39;Beta_DS4&#39;</span><span class="p">:</span> <span class="n">Beta_DS4</span>
<span class="p">})</span>

<span class="n">IM</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<p>Calculate damage index</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">calculate_log_normal_distribution</span><span class="p">(</span><span class="n">beta</span><span class="p">,</span> <span class="n">scale</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Creates a log-normal distribution using the given beta and scale parameters.</span>
<span class="sd">    </span>
<span class="sd">    Parameters:</span>
<span class="sd">    - beta: Beta parameter (shape) for the log-normal distribution.</span>
<span class="sd">    - scale: Scale parameter for the log-normal distribution (IM value).</span>
<span class="sd">    </span>
<span class="sd">    Returns:</span>
<span class="sd">    - dist: A log-normal distribution object.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">lognorm</span><span class="p">(</span><span class="n">s</span><span class="o">=</span><span class="n">beta</span><span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="n">scale</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">get_beta_values</span><span class="p">(</span><span class="n">typology</span><span class="p">,</span> <span class="n">im_row</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Determines beta values based on typology. Adjusts beta values if the typology contains &#39;Precast&#39;.</span>
<span class="sd">    </span>
<span class="sd">    Parameters:</span>
<span class="sd">    - typology: The building typology.</span>
<span class="sd">    - im_row: The current row from the IM DataFrame.</span>
<span class="sd">    </span>
<span class="sd">    Returns:</span>
<span class="sd">    - Tuple of beta values for DS1, DS2, DS3, and DS4.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="s1">&#39;Precast&#39;</span> <span class="ow">in</span> <span class="n">typology</span><span class="p">:</span>
        <span class="n">beta_dist1</span> <span class="o">=</span> <span class="n">im_row</span><span class="p">[</span><span class="s1">&#39;Beta_DS1&#39;</span><span class="p">]</span> <span class="k">if</span> <span class="n">pd</span><span class="o">.</span><span class="n">notna</span><span class="p">(</span><span class="n">im_row</span><span class="p">[</span><span class="s1">&#39;Beta_DS1&#39;</span><span class="p">])</span> <span class="k">else</span> <span class="n">im_row</span><span class="p">[</span><span class="s1">&#39;Beta_DS1&#39;</span><span class="p">]</span>
        <span class="n">beta_dist2</span> <span class="o">=</span> <span class="n">im_row</span><span class="p">[</span><span class="s1">&#39;Beta_DS2&#39;</span><span class="p">]</span> <span class="k">if</span> <span class="n">pd</span><span class="o">.</span><span class="n">notna</span><span class="p">(</span><span class="n">im_row</span><span class="p">[</span><span class="s1">&#39;Beta_DS2&#39;</span><span class="p">])</span> <span class="k">else</span> <span class="n">im_row</span><span class="p">[</span><span class="s1">&#39;Beta_DS1&#39;</span><span class="p">]</span>
        <span class="n">beta_dist3</span> <span class="o">=</span> <span class="n">im_row</span><span class="p">[</span><span class="s1">&#39;Beta_DS3&#39;</span><span class="p">]</span> <span class="k">if</span> <span class="n">pd</span><span class="o">.</span><span class="n">notna</span><span class="p">(</span><span class="n">im_row</span><span class="p">[</span><span class="s1">&#39;Beta_DS3&#39;</span><span class="p">])</span> <span class="k">else</span> <span class="n">im_row</span><span class="p">[</span><span class="s1">&#39;Beta_DS1&#39;</span><span class="p">]</span>
        <span class="n">beta_dist4</span> <span class="o">=</span> <span class="n">im_row</span><span class="p">[</span><span class="s1">&#39;Beta_DS4&#39;</span><span class="p">]</span> <span class="k">if</span> <span class="n">pd</span><span class="o">.</span><span class="n">notna</span><span class="p">(</span><span class="n">im_row</span><span class="p">[</span><span class="s1">&#39;Beta_DS4&#39;</span><span class="p">])</span> <span class="k">else</span> <span class="n">im_row</span><span class="p">[</span><span class="s1">&#39;Beta_DS1&#39;</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">beta_dist1</span> <span class="o">=</span> <span class="n">im_row</span><span class="p">[</span><span class="s1">&#39;Beta_DS1&#39;</span><span class="p">]</span>
        <span class="n">beta_dist2</span> <span class="o">=</span> <span class="n">im_row</span><span class="p">[</span><span class="s1">&#39;Beta_DS1&#39;</span><span class="p">]</span>
        <span class="n">beta_dist3</span> <span class="o">=</span> <span class="n">im_row</span><span class="p">[</span><span class="s1">&#39;Beta_DS1&#39;</span><span class="p">]</span>
        <span class="n">beta_dist4</span> <span class="o">=</span> <span class="n">im_row</span><span class="p">[</span><span class="s1">&#39;Beta_DS1&#39;</span><span class="p">]</span>
    
    <span class="k">return</span> <span class="n">beta_dist1</span><span class="p">,</span> <span class="n">beta_dist2</span><span class="p">,</span> <span class="n">beta_dist3</span><span class="p">,</span> <span class="n">beta_dist4</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">compute_cdf_values</span><span class="p">(</span><span class="n">row</span><span class="p">,</span> <span class="n">intensity_column_map</span><span class="p">,</span> <span class="n">im_row</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Computes CDF values based on the intensity and IM row data.</span>
<span class="sd">    </span>
<span class="sd">    Parameters:</span>
<span class="sd">    - row: A row from the input DataFrame.</span>
<span class="sd">    - intensity_column_map: A map that links intensity types to column names.</span>
<span class="sd">    - im_row: A row from the IM DataFrame containing beta and IM values.</span>
<span class="sd">    </span>
<span class="sd">    Returns:</span>
<span class="sd">    - A tuple of computed CDF values (cdf1, cdf2, cdf3, cdf4).</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Get the intensity type and column name for current row</span>
    <span class="n">intensity_type</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="s2">&quot;Intensity&quot;</span><span class="p">]</span>
    <span class="n">column_name</span> <span class="o">=</span> <span class="n">intensity_column_map</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">intensity_type</span><span class="p">)</span>
    <span class="n">x_value</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="n">column_name</span><span class="p">]</span> <span class="k">if</span> <span class="n">column_name</span> <span class="k">else</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>

    <span class="c1"># Calculate log-normal distributions</span>
    <span class="n">beta_dist1</span><span class="p">,</span> <span class="n">beta_dist2</span><span class="p">,</span> <span class="n">beta_dist3</span><span class="p">,</span> <span class="n">beta_dist4</span> <span class="o">=</span> <span class="n">get_beta_values</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;Typology&#39;</span><span class="p">],</span> <span class="n">im_row</span><span class="p">)</span>
    
    <span class="n">dist1</span> <span class="o">=</span> <span class="n">calculate_log_normal_distribution</span><span class="p">(</span><span class="n">beta_dist1</span><span class="p">,</span> <span class="n">im_row</span><span class="p">[</span><span class="s2">&quot;IM1&quot;</span><span class="p">])</span>
    <span class="n">dist2</span> <span class="o">=</span> <span class="n">calculate_log_normal_distribution</span><span class="p">(</span><span class="n">beta_dist2</span><span class="p">,</span> <span class="n">im_row</span><span class="p">[</span><span class="s2">&quot;IM2&quot;</span><span class="p">])</span>
    <span class="n">dist3</span> <span class="o">=</span> <span class="n">calculate_log_normal_distribution</span><span class="p">(</span><span class="n">beta_dist3</span><span class="p">,</span> <span class="n">im_row</span><span class="p">[</span><span class="s2">&quot;IM3&quot;</span><span class="p">])</span>
    <span class="n">dist4</span> <span class="o">=</span> <span class="n">calculate_log_normal_distribution</span><span class="p">(</span><span class="n">beta_dist4</span><span class="p">,</span> <span class="n">im_row</span><span class="p">[</span><span class="s2">&quot;IM4&quot;</span><span class="p">])</span>
    
    <span class="c1"># Compute CDF values</span>
    <span class="k">return</span> <span class="n">dist1</span><span class="o">.</span><span class="n">cdf</span><span class="p">(</span><span class="n">x_value</span><span class="p">),</span> <span class="n">dist2</span><span class="o">.</span><span class="n">cdf</span><span class="p">(</span><span class="n">x_value</span><span class="p">),</span> <span class="n">dist3</span><span class="o">.</span><span class="n">cdf</span><span class="p">(</span><span class="n">x_value</span><span class="p">),</span> <span class="n">dist4</span><span class="o">.</span><span class="n">cdf</span><span class="p">(</span><span class="n">x_value</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Create a dictionary to store DataFrames from each scenario by their years_value</span>
<span class="n">cdf_dict</span> <span class="o">=</span> <span class="p">{}</span>

<span class="c1"># Iterate over each seismic scenario</span>
<span class="k">for</span> <span class="n">index_scen</span><span class="p">,</span> <span class="n">scen_row</span> <span class="ow">in</span> <span class="n">Scenaria</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>
    <span class="c1"># Variables to store CDF results and intensity values</span>
    <span class="n">cdf1</span><span class="p">,</span> <span class="n">cdf2</span><span class="p">,</span> <span class="n">cdf3</span><span class="p">,</span> <span class="n">cdf4</span> <span class="o">=</span> <span class="p">[],</span> <span class="p">[],</span> <span class="p">[],</span> <span class="p">[]</span>
    
    <span class="c1"># Scenario parameters</span>
    <span class="n">years_value</span> <span class="o">=</span> <span class="n">scen_row</span><span class="p">[</span><span class="s1">&#39;1/years&#39;</span><span class="p">]</span>
    <span class="n">scenario_no</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">scen_row</span><span class="p">[</span><span class="s1">&#39;No&#39;</span><span class="p">])</span>
    <span class="n">return_period</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">scen_row</span><span class="p">[</span><span class="s1">&#39;Return_Period&#39;</span><span class="p">])</span>

    <span class="c1"># Generate intensity column map for the current scenario</span>
    <span class="n">intensity_column_map</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;PGA&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;PGA-</span><span class="si">{</span><span class="n">years_value</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
        <span class="s2">&quot;SA(0.3)&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;SA(0.3)-</span><span class="si">{</span><span class="n">years_value</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
        <span class="s2">&quot;SA(0.6)&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;SA(0.6)-</span><span class="si">{</span><span class="n">years_value</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
        <span class="s2">&quot;SA(1.0)&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;SA(1.0)-</span><span class="si">{</span><span class="n">years_value</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
        <span class="s2">&quot;SA(1.5)&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;SA(1.5)-</span><span class="si">{</span><span class="n">years_value</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
    <span class="p">}</span>

    <span class="c1"># Iterate over each row in the DataFrame df</span>
    <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>
        <span class="n">im_row</span> <span class="o">=</span> <span class="n">IM</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">index</span><span class="p">]</span>  <span class="c1"># Corresponding IM DataFrame row</span>
    
        <span class="c1"># Compute CDF values</span>
        <span class="n">cdf1_val</span><span class="p">,</span> <span class="n">cdf2_val</span><span class="p">,</span> <span class="n">cdf3_val</span><span class="p">,</span> <span class="n">cdf4_val</span> <span class="o">=</span> <span class="n">compute_cdf_values</span><span class="p">(</span><span class="n">row</span><span class="p">,</span> <span class="n">intensity_column_map</span><span class="p">,</span> <span class="n">im_row</span><span class="p">)</span>
        <span class="n">cdf1</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">cdf1_val</span><span class="p">)</span>
        <span class="n">cdf2</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">cdf2_val</span><span class="p">)</span>
        <span class="n">cdf3</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">cdf3_val</span><span class="p">)</span>
        <span class="n">cdf4</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">cdf4_val</span><span class="p">)</span>
    
    <span class="c1"># Create DataFrame to store CDF values for the current scenario</span>
    <span class="n">CDF</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span>
        <span class="sa">f</span><span class="s2">&quot;CDF1-</span><span class="si">{</span><span class="n">years_value</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">:</span> <span class="n">cdf1</span><span class="p">,</span>
        <span class="sa">f</span><span class="s2">&quot;CDF2-</span><span class="si">{</span><span class="n">years_value</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">:</span> <span class="n">cdf2</span><span class="p">,</span>
        <span class="sa">f</span><span class="s2">&quot;CDF3-</span><span class="si">{</span><span class="n">years_value</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">:</span> <span class="n">cdf3</span><span class="p">,</span>
        <span class="sa">f</span><span class="s2">&quot;CDF4-</span><span class="si">{</span><span class="n">years_value</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">:</span> <span class="n">cdf4</span>
    <span class="p">})</span>
    
    <span class="c1"># Calculate probabilities of occurrence for each damage state</span>
    <span class="n">CDF</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;P_DS1-</span><span class="si">{</span><span class="n">years_value</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">CDF</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;CDF1-</span><span class="si">{</span><span class="n">years_value</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]</span> <span class="o">-</span> <span class="n">CDF</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;CDF2-</span><span class="si">{</span><span class="n">years_value</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]</span>
    <span class="n">CDF</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;P_DS2-</span><span class="si">{</span><span class="n">years_value</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">CDF</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;CDF2-</span><span class="si">{</span><span class="n">years_value</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]</span> <span class="o">-</span> <span class="n">CDF</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;CDF3-</span><span class="si">{</span><span class="n">years_value</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]</span>
    <span class="n">CDF</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;P_DS3-</span><span class="si">{</span><span class="n">years_value</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">CDF</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;CDF3-</span><span class="si">{</span><span class="n">years_value</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]</span> <span class="o">-</span> <span class="n">CDF</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;CDF4-</span><span class="si">{</span><span class="n">years_value</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]</span>
    <span class="n">CDF</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;P_DS4-</span><span class="si">{</span><span class="n">years_value</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">CDF</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;CDF4-</span><span class="si">{</span><span class="n">years_value</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]</span>

    <span class="c1"># Initialize the list for Damage Index (DI) values</span>
    <span class="n">DI_values</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="c1"># Loop over the rows again to calculate the DI for each row</span>
    <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>
        <span class="c1"># Check Material type and calculate DI accordingly</span>
        <span class="k">if</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;Material&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;Precast&#39;</span><span class="p">:</span>
            <span class="n">DI_value</span> <span class="o">=</span> <span class="p">(</span>
                <span class="n">CDF</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">index</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;P_DS1-</span><span class="si">{</span><span class="n">years_value</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="mf">0.05</span> <span class="o">+</span>
                <span class="n">CDF</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">index</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;P_DS2-</span><span class="si">{</span><span class="n">years_value</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="mf">0.30</span> <span class="o">+</span>
                <span class="n">CDF</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">index</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;P_DS3-</span><span class="si">{</span><span class="n">years_value</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="mf">0.70</span> <span class="o">+</span>
                <span class="n">CDF</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">index</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;P_DS4-</span><span class="si">{</span><span class="n">years_value</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="mi">1</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">DI_value</span> <span class="o">=</span> <span class="p">(</span>
                <span class="n">CDF</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">index</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;P_DS1-</span><span class="si">{</span><span class="n">years_value</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="mf">0.05</span> <span class="o">+</span>
                <span class="n">CDF</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">index</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;P_DS2-</span><span class="si">{</span><span class="n">years_value</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="mf">0.15</span> <span class="o">+</span>
                <span class="n">CDF</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">index</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;P_DS3-</span><span class="si">{</span><span class="n">years_value</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="mf">0.60</span> <span class="o">+</span>
                <span class="n">CDF</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">index</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;P_DS4-</span><span class="si">{</span><span class="n">years_value</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="mi">1</span>
            <span class="p">)</span>
        
        <span class="c1"># Append the calculated DI to the list</span>
        <span class="n">DI_values</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">DI_value</span><span class="p">)</span>

    <span class="c1"># Add the calculated DI values to the DataFrame</span>
    <span class="n">CDF</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;DI-</span><span class="si">{</span><span class="n">years_value</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">DI_values</span>
    
    <span class="c1"># Reset the index to align all data</span>
    <span class="n">CDF</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    
    <span class="c1"># Store the DataFrame for the current scenario in a dictionary</span>
    <span class="n">cdf_dict</span><span class="p">[</span><span class="n">years_value</span><span class="p">]</span> <span class="o">=</span> <span class="n">CDF</span>

<span class="c1"># Concatenate all the DataFrames horizontally (axis=1)</span>
<span class="n">DI_seismic</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="n">cdf_dict</span><span class="o">.</span><span class="n">values</span><span class="p">(),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

<span class="c1"># Drop duplicate &#39;Longitude&#39; and &#39;Latitude&#39; columns, keeping only the first occurrence</span>
<span class="n">DI_seismic</span> <span class="o">=</span> <span class="n">DI_seismic</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="o">~</span><span class="n">DI_seismic</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">duplicated</span><span class="p">()]</span>
</pre></div>
</div>
</div>
</div>
<p>Calculate annual collapse probability based on strest methodology</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Define return periods</span>
<span class="n">Periods</span> <span class="o">=</span> <span class="p">[</span><span class="mi">5</span><span class="p">,</span><span class="mi">73</span><span class="p">,</span><span class="mi">102</span><span class="p">,</span><span class="mi">475</span><span class="p">,</span><span class="mi">1000</span><span class="p">,</span><span class="mi">2500</span><span class="p">,</span><span class="mi">5000</span><span class="p">,</span><span class="mi">10000</span><span class="p">]</span>

<span class="n">lamda1</span><span class="o">=</span><span class="p">[</span><span class="mf">0.9999</span><span class="p">,</span><span class="mf">0.5</span><span class="p">,</span><span class="mf">0.39</span><span class="p">,</span><span class="mf">0.1</span><span class="p">,</span><span class="mf">0.05</span><span class="p">,</span><span class="mf">0.02</span><span class="p">,</span><span class="mf">0.01</span><span class="p">,</span><span class="mf">0.005</span><span class="p">]</span>

<span class="c1"># Compute λ values</span>
<span class="n">lambda_values</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span> <span class="o">/</span> <span class="p">(</span><span class="o">-</span><span class="mi">50</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">l</span><span class="p">))</span> <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="n">lamda1</span><span class="p">]</span>


<span class="c1"># Compute P[IM_i] using the given formula</span>
<span class="n">P_IM</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">lambda_values</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>  <span class="c1"># Avoid first and last index</span>
    <span class="n">P_IM_i</span> <span class="o">=</span> <span class="p">(</span><span class="n">lambda_values</span><span class="p">[</span><span class="n">t</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">lambda_values</span><span class="p">[</span><span class="n">t</span> <span class="o">+</span> <span class="mi">1</span><span class="p">])</span> <span class="o">/</span> <span class="mi">2</span>
    <span class="n">P_IM</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">P_IM_i</span><span class="p">)</span>

<span class="c1"># Create a dictionary mapping return periods to P[IM_i]</span>
<span class="n">P_IM_dict</span> <span class="o">=</span> <span class="p">{</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;1/years&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">]:</span> <span class="n">P_IM</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">P_IM</span><span class="p">))}</span>

<span class="c1"># Multiply each &quot;CDF4-{r}&quot; column by the corresponding P[IM_i]</span>
<span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;1/years&#39;</span><span class="p">]:</span>  <span class="c1"># Exclude first and last periods as they lack P[IM_i]</span>
    <span class="n">column_name</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;CDF4-</span><span class="si">{</span><span class="n">r</span><span class="si">}</span><span class="s2">&quot;</span>
    <span class="n">new_column_name</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">column_name</span><span class="si">}</span><span class="s2">*P[IM_i]&quot;</span>

    <span class="k">if</span> <span class="n">column_name</span> <span class="ow">in</span> <span class="n">DI_seismic</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>  
        <span class="n">DI_seismic</span><span class="p">[</span><span class="n">new_column_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">DI_seismic</span><span class="p">[</span><span class="n">column_name</span><span class="p">]</span> <span class="o">*</span> <span class="n">P_IM_dict</span><span class="p">[</span><span class="n">r</span><span class="p">]</span>

<span class="c1"># Add a new column that sums all the new columns</span>
<span class="n">new_columns</span> <span class="o">=</span> <span class="p">[</span><span class="sa">f</span><span class="s2">&quot;CDF4-</span><span class="si">{</span><span class="n">r</span><span class="si">}</span><span class="s2">*P[IM_i]&quot;</span> <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;1/years&#39;</span><span class="p">]</span> <span class="k">if</span> <span class="sa">f</span><span class="s2">&quot;CDF4-</span><span class="si">{</span><span class="n">r</span><span class="si">}</span><span class="s2">&quot;</span> <span class="ow">in</span> <span class="n">DI_seismic</span><span class="o">.</span><span class="n">columns</span><span class="p">]</span>

<span class="c1"># Create a new column &quot;Sum_of_new_columns&quot; by summing across the new columns</span>
<span class="n">DI_seismic</span><span class="p">[</span><span class="s2">&quot;Annual Collapse Probability&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">DI_seismic</span><span class="p">[</span><span class="n">new_columns</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Create and save the final DataFrame containing the damage index (loss ratio) for different return periods along with the annual probability of collapse for each exposure point.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Concatenate df and IM horizontally, aligning by their index</span>
<span class="n">common_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">df</span><span class="p">,</span> <span class="n">IM</span><span class="p">,</span> <span class="n">DI_seismic</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

<span class="c1"># Define the path first</span>
<span class="n">seismic_file_path</span> <span class="o">=</span> <span class="n">savepath</span> <span class="o">/</span> <span class="sa">f</span><span class="s2">&quot;Single-Hazard/Earthquakes/DI_Earthquakes_ESRM20_</span><span class="si">{</span><span class="n">asset</span><span class="si">}</span><span class="s2">.csv&quot;</span>

<span class="c1"># Ensure the directory exists</span>
<span class="n">seismic_file_path</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">parents</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="c1"># Save the DataFrame to CSV</span>
<span class="n">common_df</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">seismic_file_path</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Visualise loss ratio map for a return period of 1000 years</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">common_df</span><span class="p">[</span><span class="s1">&#39;geometry&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">common_df</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">row</span><span class="p">:</span> <span class="n">Point</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;Longitude&#39;</span><span class="p">],</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;Latitude&#39;</span><span class="p">]),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

<span class="c1"># Convert to GeoDataFrame</span>
<span class="n">seismic_gdf</span> <span class="o">=</span> <span class="n">gpd</span><span class="o">.</span><span class="n">GeoDataFrame</span><span class="p">(</span><span class="n">common_df</span><span class="p">,</span> <span class="n">geometry</span><span class="o">=</span><span class="s1">&#39;geometry&#39;</span><span class="p">,</span> <span class="n">crs</span><span class="o">=</span><span class="s2">&quot;EPSG:4326&quot;</span><span class="p">)</span>

<span class="c1"># Create bins for the DI-0.001 column</span>
<span class="n">bins</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.25</span><span class="p">,</span> <span class="mf">0.4</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>  <span class="c1"># Define the bin ranges</span>
<span class="n">labels</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;0-0.1&#39;</span><span class="p">,</span> <span class="s1">&#39;0.1-0.25&#39;</span><span class="p">,</span> <span class="s1">&#39;0.25-0.4&#39;</span><span class="p">,</span> <span class="s1">&#39;0.4-1&#39;</span><span class="p">]</span>  <span class="c1"># Labels for the bins</span>

<span class="c1"># Assign bin values based on &#39;DI-0.001&#39;</span>
<span class="n">seismic_gdf</span><span class="p">[</span><span class="s1">&#39;DI_binned&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">cut</span><span class="p">(</span><span class="n">seismic_gdf</span><span class="p">[</span><span class="s1">&#39;DI-0.001&#39;</span><span class="p">],</span> <span class="n">bins</span><span class="o">=</span><span class="n">bins</span><span class="p">,</span> <span class="n">labels</span><span class="o">=</span><span class="n">labels</span><span class="p">,</span> <span class="n">right</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>


<span class="c1"># Interactive map with 4 bins and custom colors</span>
<span class="n">seismic_gdf</span><span class="o">.</span><span class="n">explore</span><span class="p">(</span>
    <span class="n">column</span><span class="o">=</span><span class="s2">&quot;DI_binned&quot;</span><span class="p">,</span>  <span class="c1"># Use the binned DI-0.001 column for coloring</span>
    <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;OrRd&#39;</span><span class="p">,</span>         <span class="c1"># Optional colormap, we are using custom colors</span>
    <span class="n">stroke</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>         <span class="c1"># Add stroke (outline) around markers</span>
    <span class="n">line_color</span><span class="o">=</span><span class="s2">&quot;black&quot;</span><span class="p">,</span>  <span class="c1"># Set the stroke color to black</span>
    <span class="n">legend</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>         <span class="c1"># Show the legend</span>
    <span class="n">legend_kwds</span><span class="o">=</span><span class="p">{</span>
        <span class="s1">&#39;caption&#39;</span><span class="p">:</span> <span class="s1">&#39;Loss ratio (T=1000 years)&#39;</span><span class="p">,</span>  <span class="c1"># Legend caption</span>
        <span class="s1">&#39;orientation&#39;</span><span class="p">:</span> <span class="s1">&#39;horizontal&#39;</span>             <span class="c1"># Horizontal legend</span>
    <span class="p">},</span>
    <span class="n">marker_kwds</span><span class="o">=</span><span class="p">{</span>
        <span class="s1">&#39;radius&#39;</span><span class="p">:</span> <span class="mi">5</span><span class="p">,</span>   <span class="c1"># Set marker size (adjust as needed)</span>
        <span class="s1">&#39;fill&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>   <span class="c1"># Fill the markers with color</span>
    <span class="p">},</span>
    <span class="n">tooltip</span><span class="o">=</span><span class="s2">&quot;DI-0.001&quot;</span><span class="p">,</span>  <span class="c1"># Show the DI-0.001 value in the tooltip</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Compute human and economic losses based on ESRM20 methodology</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Load your reference data (Excel with probabilities)</span>
<span class="n">reference</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_excel</span><span class="p">(</span><span class="n">data_path</span> <span class="o">/</span> <span class="s2">&quot;fatality_damage_model_ESRM20.xlsx&quot;</span><span class="p">)</span>

<span class="c1"># Create empty lists to store the values</span>
<span class="n">P_lethal_DS4</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">Collapse_factor</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">P_entrap_day</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">P_entrap_night</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">P_loss_life</span> <span class="o">=</span> <span class="p">[]</span>

<span class="c1"># For each row in common_df, look up values based on Typology</span>
<span class="k">for</span> <span class="n">taxonomy</span> <span class="ow">in</span> <span class="n">common_df</span><span class="p">[</span><span class="s1">&#39;Typology&#39;</span><span class="p">]:</span>
    <span class="n">match</span> <span class="o">=</span> <span class="n">reference</span><span class="p">[</span><span class="n">reference</span><span class="p">[</span><span class="s1">&#39;Typology&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">taxonomy</span><span class="p">]</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">match</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
        <span class="n">P_lethal_DS4</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">match</span><span class="p">[</span><span class="s1">&#39;P_lethal-building | DS4&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">Collapse_factor</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">match</span><span class="p">[</span><span class="s1">&#39;Collapse_factor&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">P_entrap_day</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">match</span><span class="p">[</span><span class="s1">&#39;P_entrapment_day&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">P_entrap_night</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">match</span><span class="p">[</span><span class="s1">&#39;P_entrapment_night&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">P_loss_life</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">match</span><span class="p">[</span><span class="s1">&#39;P_loss-life | entrapment&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># If not found, append None or a default</span>
        <span class="n">P_lethal_DS4</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>
        <span class="n">Collapse_factor</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>
        <span class="n">P_entrap_day</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>
        <span class="n">P_entrap_night</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>
        <span class="n">P_loss_life</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>

<span class="c1"># Add the new columns to your DataFrame</span>
<span class="n">common_df</span><span class="p">[</span><span class="s1">&#39;P_lethal-building | DS4&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">P_lethal_DS4</span>
<span class="n">common_df</span><span class="p">[</span><span class="s1">&#39;Collapse_factor&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">Collapse_factor</span>
<span class="n">common_df</span><span class="p">[</span><span class="s1">&#39;P_entrapment_day&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">P_entrap_day</span>
<span class="n">common_df</span><span class="p">[</span><span class="s1">&#39;P_entrapment_night&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">P_entrap_night</span>
<span class="n">common_df</span><span class="p">[</span><span class="s1">&#39;P_loss-life | entrapment&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">P_loss_life</span>

<span class="c1"># Iterate through each return period in the Scenaria DataFrame</span>
<span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">Scenaria</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>
    <span class="n">return_period</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;1/years&#39;</span><span class="p">]</span>  <span class="c1"># Get the &#39;1/years&#39; value</span>

    <span class="c1"># Create the new column name dynamically, e.g., &quot;new_column_0.0137&quot; for the first return period</span>
    <span class="n">new_column_name</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Fatality_damage_</span><span class="si">{</span><span class="n">return_period</span><span class="si">}</span><span class="s2">&quot;</span>

    <span class="c1"># Calculate the new column for each row in common_df</span>
    <span class="n">common_df</span><span class="p">[</span><span class="n">new_column_name</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">common_df</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;P_DS4-</span><span class="si">{</span><span class="n">return_period</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="n">common_df</span><span class="p">[</span><span class="s1">&#39;P_lethal-building | DS4&#39;</span><span class="p">]</span> <span class="o">*</span> 
        <span class="n">common_df</span><span class="p">[</span><span class="s1">&#39;Collapse_factor&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">common_df</span><span class="p">[</span><span class="s1">&#39;P_loss-life | entrapment&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">common_df</span><span class="p">[</span><span class="s1">&#39;Area&#39;</span><span class="p">]</span> <span class="o">/</span> <span class="mi">3</span>
    <span class="p">)</span>

    <span class="n">common_df</span><span class="p">[</span><span class="n">new_column_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">common_df</span><span class="p">[</span><span class="n">new_column_name</span><span class="p">]</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

<span class="c1"># Iterate through each return period in the Scenaria DataFrame</span>
<span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">Scenaria</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>
    <span class="n">return_period</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;1/years&#39;</span><span class="p">]</span>  <span class="c1"># Get the &#39;1/years&#39; value</span>

    <span class="c1"># Create the new column name dynamically, e.g., &quot;new_column_0.0137&quot; for the first return period</span>
    <span class="n">new_column_name</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Economic_Losses_</span><span class="si">{</span><span class="n">return_period</span><span class="si">}</span><span class="s2">&quot;</span>

    <span class="c1"># Calculate the new column for each row in common_df</span>
    <span class="n">common_df</span><span class="p">[</span><span class="n">new_column_name</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">common_df</span><span class="p">[</span><span class="s1">&#39;Area&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="mi">2000</span> <span class="o">*</span> <span class="n">common_df</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;DI-</span><span class="si">{</span><span class="n">return_period</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">])</span>

<span class="c1"># Save the updated common_df with the new columns</span>
<span class="n">common_df</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">seismic_file_path</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Visualise economic and human losses for a return period of 1000 years aggragated per municipality</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">common_df</span><span class="p">[</span><span class="s1">&#39;geometry&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">common_df</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">row</span><span class="p">:</span> <span class="n">Point</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;Longitude&#39;</span><span class="p">],</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;Latitude&#39;</span><span class="p">]),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

<span class="c1"># Convert to GeoDataFrame</span>
<span class="n">seismic_gdf</span> <span class="o">=</span> <span class="n">gpd</span><span class="o">.</span><span class="n">GeoDataFrame</span><span class="p">(</span><span class="n">common_df</span><span class="p">,</span> <span class="n">geometry</span><span class="o">=</span><span class="s1">&#39;geometry&#39;</span><span class="p">,</span> <span class="n">crs</span><span class="o">=</span><span class="s2">&quot;EPSG:4326&quot;</span><span class="p">)</span>


<span class="n">municipalities_gdf</span> <span class="o">=</span> <span class="n">gpd</span><span class="o">.</span><span class="n">read_file</span><span class="p">(</span><span class="n">data_path</span> <span class="o">/</span> <span class="s2">&quot;oria_dimon.shp&quot;</span><span class="p">)</span>


<span class="c1"># Ensure both datasets are in the same CRS</span>
<span class="k">if</span> <span class="n">seismic_gdf</span><span class="o">.</span><span class="n">crs</span> <span class="o">!=</span> <span class="n">municipalities_gdf</span><span class="o">.</span><span class="n">crs</span><span class="p">:</span>
    <span class="n">seismic_gdf</span> <span class="o">=</span> <span class="n">seismic_gdf</span><span class="o">.</span><span class="n">to_crs</span><span class="p">(</span><span class="n">municipalities_gdf</span><span class="o">.</span><span class="n">crs</span><span class="p">)</span>

<span class="c1"># Remove conflicting columns if they exist</span>
<span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;index_left&#39;</span><span class="p">,</span> <span class="s1">&#39;index_right&#39;</span><span class="p">]:</span>
    <span class="k">if</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">seismic_gdf</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
        <span class="n">seismic_gdf</span> <span class="o">=</span> <span class="n">seismic_gdf</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="n">col</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">municipalities_gdf</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
        <span class="n">municipalities_gdf</span> <span class="o">=</span> <span class="n">municipalities_gdf</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="n">col</span><span class="p">)</span>

<span class="c1"># Step 2: Perform spatial join — assign each point in seismic_gdf to a municipality</span>
<span class="n">joined</span> <span class="o">=</span> <span class="n">gpd</span><span class="o">.</span><span class="n">sjoin</span><span class="p">(</span><span class="n">seismic_gdf</span><span class="p">,</span> <span class="n">municipalities_gdf</span><span class="p">,</span> <span class="n">how</span><span class="o">=</span><span class="s2">&quot;left&quot;</span><span class="p">,</span> <span class="n">predicate</span><span class="o">=</span><span class="s2">&quot;within&quot;</span><span class="p">)</span>

<span class="c1"># Step 3: Aggregate — Sum Economic Losses and Fatality (Human) Losses per municipality</span>
<span class="n">agg</span> <span class="o">=</span> <span class="n">joined</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;index_right&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">agg</span><span class="p">({</span>
    <span class="s1">&#39;Economic_Losses_0.001&#39;</span><span class="p">:</span> <span class="s1">&#39;sum&#39;</span><span class="p">,</span>  <span class="c1"># Sum the Economic Losses for each municipality</span>
    <span class="s1">&#39;Fatality_damage_0.001&#39;</span><span class="p">:</span> <span class="s1">&#39;sum&#39;</span>   <span class="c1"># Sum Human Losses for each municipality</span>
<span class="p">})</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span>
    <span class="s1">&#39;Economic_Losses_0.001&#39;</span><span class="p">:</span> <span class="s1">&#39;Economic_Losses&#39;</span><span class="p">,</span>
    <span class="s1">&#39;Fatality_damage_0.001&#39;</span><span class="p">:</span> <span class="s1">&#39;Human Losses&#39;</span>
<span class="p">})</span>

<span class="c1"># Step 4: Join the aggregated data back to the municipalities</span>
<span class="n">municipalities_gdf</span> <span class="o">=</span> <span class="n">municipalities_gdf</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">agg</span><span class="p">)</span>

<span class="c1"># Step 5: Apply binning for **Economic Losses**</span>
<span class="n">economic_bins</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">400000</span><span class="p">,</span> <span class="mi">3430000</span><span class="p">,</span> <span class="mi">6000000</span><span class="p">,</span> <span class="mi">8098000</span><span class="p">,</span> <span class="mi">124540000</span><span class="p">]</span>  <span class="c1"># Define custom bins</span>
<span class="n">economic_labels</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;0-400K&#39;</span><span class="p">,</span> <span class="s1">&#39;400K-3.4M&#39;</span><span class="p">,</span> <span class="s1">&#39;3.4M-6M&#39;</span><span class="p">,</span> <span class="s1">&#39;6M-8M&#39;</span><span class="p">,</span> <span class="s1">&#39;8M+&#39;</span><span class="p">]</span>  <span class="c1"># Labels for the bins</span>

<span class="c1"># Create a new column with binned values for Economic Losses</span>
<span class="n">municipalities_gdf</span><span class="p">[</span><span class="s1">&#39;Economic_Losses_binned&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">cut</span><span class="p">(</span><span class="n">municipalities_gdf</span><span class="p">[</span><span class="s1">&#39;Economic_Losses&#39;</span><span class="p">],</span> <span class="n">bins</span><span class="o">=</span><span class="n">economic_bins</span><span class="p">,</span> <span class="n">labels</span><span class="o">=</span><span class="n">economic_labels</span><span class="p">,</span> <span class="n">right</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

<span class="c1"># Step 6: Apply binning for **Human Losses** with explicit inclusion of zero in the bins</span>
<span class="n">human_bins</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">]</span>  <span class="c1"># Bins for Human Losses (0-1, 1-2, etc.)</span>
<span class="n">human_labels</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;0-1&#39;</span><span class="p">,</span> <span class="s1">&#39;1-2&#39;</span><span class="p">,</span> <span class="s1">&#39;2-4&#39;</span><span class="p">,</span> <span class="s1">&#39;4-7&#39;</span><span class="p">,</span> <span class="s1">&#39;7+&#39;</span><span class="p">]</span>  <span class="c1"># Labels for the bins</span>

<span class="c1"># Create a new column with binned values for Human Losses (ensure &#39;0&#39; is included in the first bin)</span>
<span class="n">municipalities_gdf</span><span class="p">[</span><span class="s1">&#39;Fatality_binned&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">cut</span><span class="p">(</span><span class="n">municipalities_gdf</span><span class="p">[</span><span class="s1">&#39;Human Losses&#39;</span><span class="p">],</span> <span class="n">bins</span><span class="o">=</span><span class="n">human_bins</span><span class="p">,</span> <span class="n">labels</span><span class="o">=</span><span class="n">human_labels</span><span class="p">,</span> <span class="n">right</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Plot Economic Losses</span>
<span class="n">municipalities_gdf</span><span class="o">.</span><span class="n">explore</span><span class="p">(</span>
    <span class="n">column</span><span class="o">=</span><span class="s1">&#39;Economic_Losses_binned&#39;</span><span class="p">,</span>
    <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;Spectral_r&#39;</span><span class="p">,</span>
    <span class="n">legend</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">legend_kwds</span><span class="o">=</span><span class="p">{</span>
        <span class="s1">&#39;caption&#39;</span><span class="p">:</span> <span class="s1">&#39;Economic Losses € (T=1000 years)&#39;</span><span class="p">,</span>
        <span class="s1">&#39;orientation&#39;</span><span class="p">:</span> <span class="s1">&#39;horizontal&#39;</span>
    <span class="p">},</span>
    <span class="n">tooltip</span><span class="o">=</span><span class="s1">&#39;Economic_Losses&#39;</span>  <span class="c1"># Display the binned categories in the polygons</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Plot Human Losses</span>
<span class="n">municipalities_gdf</span><span class="o">.</span><span class="n">explore</span><span class="p">(</span>
    <span class="n">column</span><span class="o">=</span><span class="s1">&#39;Fatality_binned&#39;</span><span class="p">,</span>
    <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;Spectral_r&#39;</span><span class="p">,</span>
    <span class="n">legend</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">legend_kwds</span><span class="o">=</span><span class="p">{</span>
        <span class="s1">&#39;caption&#39;</span><span class="p">:</span> <span class="s1">&#39;Human Losses (T=1000 years)&#39;</span><span class="p">,</span>
        <span class="s1">&#39;orientation&#39;</span><span class="p">:</span> <span class="s1">&#39;horizontal&#39;</span>
    <span class="p">},</span>
    <span class="n">tooltip</span><span class="o">=</span><span class="s1">&#39;Human Losses&#39;</span>  <span class="c1"># Display the binned categories in the polygons</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="multi-hazard-earthquake-triggered-landslide">
<h2>Multi hazard - Earthquake triggered landslide<a class="headerlink" href="#multi-hazard-earthquake-triggered-landslide" title="Link to this heading">#</a></h2>
<ul class="simple">
<li><p>Seismic hazard assessment: use of the newly developed open-access European Seismic Hazard maps (ESHM20, Danciu, et al., 2021) which provide PGA and spectral accelerations at different periods at bedrock for six different return periods derived from probabilistic seismic hazard analysis</p></li>
<li><p>Estimate PGA at the ground surface for different return periods considering a detailed site model using Openquake engine</p></li>
<li><p>Relate ELSUSv2 susceptibility classes (Wilde et al. 2018) with yield acceleration ratio (ky) values based on FEMA (2022) and expert judgement</p></li>
<li><p>Assume that the frequency of exceedance of the earthquake induced landslide will be the same as the one of the earthquake itself (a rather conservative assumption) or assess the probability that the landslide will occur given the occurrence of the earthquake.</p></li>
<li><p>Estimate Permanent ground displacement (PGD) of (earthquake induced) landsliding using different analytical expressions (e.g., Fotopoulou and Pitilakis 2015; Rathje and Antonakos 2011) that relate the PGD with PGA and yield coefficient (ky).</p></li>
<li><p>Use of appropriate fragility curves for schools and hospitals due to ground shaking (e.g., ESRM20) and landslide (FEMA, 2022)</p></li>
<li><p>Estimate the compound damages due to ground shaking and ground failure due to landsliding by combining the damage state probabilities for the different hazards (Fotopoulou and Pitilakis 2017, FEMA 2022). The combined probability (PCOMB) of exceeding a given limit state i is given as: PCOMB[LS ≥ LSi] =  PGS[ LS ≥ LSi] +Plandslide· PL[ LS ≥ LSi] - PGS[ LS ≥ LSi] · Plandslide ·PL[ LS ≥ LSi] where Plandslide is the probability of landslide occurrence given the earthquake.</p></li>
<li><p>A loss ratio will be finally computed that will be based on the two intensity measures (PGA and PGD).</p></li>
<li><p>The results will be given in terms of (economic and human) loss maps for the different return periods</p></li>
</ul>
<p>Calculate yield acceleration ratio (ky)</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Define a function to apply the logic</span>
<span class="k">def</span><span class="w"> </span><span class="nf">calculate_value</span><span class="p">(</span><span class="n">sample</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">sample</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="k">return</span> <span class="mf">0.4</span>
    <span class="k">elif</span> <span class="n">sample</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
        <span class="k">return</span> <span class="mf">0.3</span>
    <span class="k">elif</span> <span class="n">sample</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
        <span class="k">return</span> <span class="mf">0.2</span>
    <span class="k">elif</span> <span class="n">sample</span> <span class="o">==</span> <span class="mi">4</span><span class="p">:</span>
        <span class="k">return</span> <span class="mf">0.15</span>
    <span class="k">elif</span> <span class="n">sample</span> <span class="o">==</span> <span class="mi">5</span><span class="p">:</span>
        <span class="k">return</span> <span class="mf">0.1</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="mi">0</span>  <span class="c1"># default value when CW is not 1, 2, 3, 4, or 5</span>

<span class="c1"># Apply the calculation and create a new dataframe</span>
<span class="n">ky_new</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;ky&#39;</span><span class="p">:</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;SAMPLE_1&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">calculate_value</span><span class="p">(</span><span class="n">x</span><span class="p">)),</span>
<span class="p">}</span>

<span class="n">ky</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">ky_new</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Calculate Permanent ground displacement (PGD) of (earthquake induced) landsliding by using an analytical expression that relates the PGD with PGA: $<span class="math notranslate nohighlight">\(PGD = \exp(a + b \cdot \ln(\text{PGA}) - c \cdot k_y + 0.535 \cdot d)\)</span>$</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">calculate_PGD</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">PGA_column</span><span class="p">,</span> <span class="n">return_period</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This function calculates Permanent Ground Displacement (PGD) for a given return period using</span>
<span class="sd">    the specified Peak Ground Acceleration (PGA) data.</span>
<span class="sd">    </span>
<span class="sd">    Parameters:</span>
<span class="sd">    df (pd.DataFrame): The input DataFrame containing PGA values and other relevant data.</span>
<span class="sd">    PGA_column (str): The name of the column in the DataFrame that contains the PGA values.</span>
<span class="sd">    return_period (int): The return period in years, which determines the value of constant &#39;d&#39; used in the calculation.</span>

<span class="sd">    Returns:</span>
<span class="sd">    pd.Series: A Series containing the calculated PGD values for the specified return period.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Constants for the calculation</span>
    <span class="n">a</span> <span class="o">=</span> <span class="o">-</span><span class="mf">2.965</span>
    <span class="n">b</span> <span class="o">=</span> <span class="mf">2.127</span>
    <span class="n">c</span> <span class="o">=</span> <span class="mf">6.583</span>
    <span class="k">if</span> <span class="n">return_period</span> <span class="o">==</span> <span class="mi">73</span> <span class="ow">or</span> <span class="n">return_period</span> <span class="o">==</span> <span class="mi">102</span><span class="p">:</span>
        <span class="n">d</span> <span class="o">=</span> <span class="mi">5</span>
    <span class="k">elif</span> <span class="n">return_period</span> <span class="o">==</span> <span class="mi">475</span><span class="p">:</span>
        <span class="n">d</span> <span class="o">=</span> <span class="mi">6</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">d</span> <span class="o">=</span> <span class="mi">7</span>

    <span class="c1"># Calculate PGD</span>
    <span class="n">PGD</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">a</span> <span class="o">+</span> <span class="n">b</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="n">PGA_column</span><span class="p">])</span> <span class="o">-</span> <span class="n">c</span> <span class="o">*</span> <span class="n">ky</span><span class="p">[</span><span class="s2">&quot;ky&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="mf">0.535</span> <span class="o">*</span> <span class="n">d</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">PGD</span>  <span class="c1"># Return as a Series instead of a DataFrame</span>

<span class="c1"># Define return periods and corresponding PGA columns</span>
<span class="n">return_periods</span> <span class="o">=</span> <span class="p">[</span><span class="mi">73</span><span class="p">,</span> <span class="mi">102</span><span class="p">,</span> <span class="mi">475</span><span class="p">,</span> <span class="mi">1000</span><span class="p">,</span> <span class="mi">2500</span><span class="p">,</span> <span class="mi">5000</span><span class="p">]</span>
<span class="n">PGA_columns</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;PGA-0.0137&#39;</span><span class="p">,</span> <span class="s1">&#39;PGA-0.0098&#39;</span><span class="p">,</span> <span class="s1">&#39;PGA-0.0021&#39;</span><span class="p">,</span> <span class="s1">&#39;PGA-0.001&#39;</span><span class="p">,</span> <span class="s1">&#39;PGA-0.0003&#39;</span><span class="p">,</span> <span class="s1">&#39;PGA-0.0001&#39;</span><span class="p">]</span>

<span class="c1"># Create a DataFrame to store all PGD results</span>
<span class="n">PGD</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>

<span class="c1"># Loop through each return period and PGA column</span>
<span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">Scenaria</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>
    <span class="n">return_period</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;Return_Period&#39;</span><span class="p">]</span>
    <span class="n">PGA_column</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;PGA-</span><span class="si">{</span><span class="n">row</span><span class="p">[</span><span class="s2">&quot;1/years&quot;</span><span class="p">]</span><span class="si">}</span><span class="s1">&#39;</span>  <span class="c1"># Construct the corresponding PGA column name</span>
    <span class="n">PGD_value</span> <span class="o">=</span> <span class="n">calculate_PGD</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">PGA_column</span><span class="p">,</span> <span class="n">return_period</span><span class="p">)</span>
    <span class="n">PGD</span><span class="p">[</span><span class="sa">f</span><span class="s1">&#39;PGD-</span><span class="si">{</span><span class="n">row</span><span class="p">[</span><span class="s2">&quot;1/years&quot;</span><span class="p">]</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">PGD_value</span>  <span class="c1"># Add the PGD values to the DataFrame</span>

<span class="n">PGD</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Calculate the probability of the occurrence of the earthquake induced landslide</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Extract years_values from the Scenaria DataFrame</span>
<span class="n">years_values</span> <span class="o">=</span> <span class="n">Scenaria</span><span class="p">[</span><span class="s1">&#39;1/years&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>  <span class="c1"># Use the annual probabilities as years values</span>

<span class="c1"># Create a list to store Planaslide DataFrames for each years_value</span>
<span class="n">plandslide_df_list</span> <span class="o">=</span> <span class="p">[]</span>

<span class="c1"># Function to assign Planaslide values based on PGA and Sample</span>
<span class="k">def</span><span class="w"> </span><span class="nf">assign_plandslide_values</span><span class="p">(</span><span class="n">sample</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">sample</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="k">return</span> <span class="mf">0.000</span>
    <span class="k">elif</span> <span class="n">sample</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
        <span class="k">return</span> <span class="mf">0.010</span>
    <span class="k">elif</span> <span class="n">sample</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
        <span class="k">return</span> <span class="mf">0.050</span>
    <span class="k">elif</span> <span class="n">sample</span> <span class="o">==</span> <span class="mi">4</span><span class="p">:</span>
        <span class="k">return</span> <span class="mf">0.100</span>
    <span class="k">elif</span> <span class="n">sample</span> <span class="o">==</span> <span class="mi">5</span><span class="p">:</span>
        <span class="k">return</span> <span class="mf">0.400</span>

<span class="c1"># Initialize a list to store the DataFrames for each year</span>
<span class="n">plandslide_df_list</span> <span class="o">=</span> <span class="p">[]</span>

<span class="c1"># Iterate over each years_value</span>
<span class="k">for</span> <span class="n">years_value</span> <span class="ow">in</span> <span class="n">years_values</span><span class="p">:</span>
    <span class="c1"># List to store Planaslide data for this specific years_value</span>
    <span class="n">plandslide_data</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="c1"># Iterate over rows in the existing df DataFrame</span>
    <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>
        <span class="n">pga_value</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;PGA-</span><span class="si">{</span><span class="n">years_value</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]</span>  <span class="c1"># Access the PGA value using dynamic column name</span>
        <span class="n">sample_value</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;SAMPLE_1&#39;</span><span class="p">]</span>  <span class="c1"># Get the Sample value</span>
        <span class="n">plandslide1</span> <span class="o">=</span> <span class="n">assign_plandslide_values</span><span class="p">(</span><span class="n">sample_value</span><span class="p">)</span>  <span class="c1"># Get Planaslide value</span>

        <span class="c1"># Store results in a dictionary</span>
        <span class="n">plandslide_data</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
            <span class="sa">f</span><span class="s1">&#39;Plandslide-</span><span class="si">{</span><span class="n">years_value</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">plandslide1</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>  <span class="c1"># Unique column for each year</span>
        <span class="p">})</span>

    <span class="c1"># Create a new DataFrame for this specific years_value</span>
    <span class="n">plandslide_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">plandslide_data</span><span class="p">)</span>


    <span class="n">plandslide_df_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">plandslide_df</span><span class="p">)</span>

<span class="c1"># Concatenate all DataFrames into one common DataFrame along columns (axis=1)</span>
<span class="n">Plandslide_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="n">plandslide_df_list</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

<span class="n">Plandslide_df</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">compute_landcdf_values</span><span class="p">(</span><span class="n">row</span><span class="p">,</span> <span class="n">years_value</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Computes CDF values based on the PGD values.</span>
<span class="sd">    </span>
<span class="sd">    Parameters:</span>
<span class="sd">    - row: A row from the input DataFrame containing PGD values.</span>
<span class="sd">    - years_value: The years value to access the correct PGD column.</span>
<span class="sd">    </span>
<span class="sd">    Returns:</span>
<span class="sd">    - A tuple of computed CDF values (cdf1, cdf2, cdf3, cdf4).</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Access the PGD value from the dynamic column</span>
    <span class="n">pga_column_name</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;PGD-</span><span class="si">{</span><span class="n">years_value</span><span class="si">}</span><span class="s2">&quot;</span>  <span class="c1"># Create the column name based on years_value</span>
    <span class="n">pgd_value</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="n">pga_column_name</span><span class="p">]</span>  <span class="c1"># Access the PGD value</span>

    <span class="c1"># Fixed beta and scale values</span>
    <span class="n">beta</span> <span class="o">=</span> <span class="mf">1.2</span>
    <span class="n">scale_values</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.254</span><span class="p">]</span> <span class="o">*</span> <span class="mi">5</span>  <span class="c1"># Four IM values, all set to 0.254</span>

    <span class="c1"># Calculate log-normal distributions with fixed values</span>
    <span class="n">dist1</span> <span class="o">=</span> <span class="n">calculate_log_normal_distribution</span><span class="p">(</span><span class="n">beta</span><span class="p">,</span> <span class="n">scale_values</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="n">dist2</span> <span class="o">=</span> <span class="n">calculate_log_normal_distribution</span><span class="p">(</span><span class="n">beta</span><span class="p">,</span> <span class="n">scale_values</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
    <span class="n">dist3</span> <span class="o">=</span> <span class="n">calculate_log_normal_distribution</span><span class="p">(</span><span class="n">beta</span><span class="p">,</span> <span class="n">scale_values</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
    <span class="n">dist4</span> <span class="o">=</span> <span class="n">calculate_log_normal_distribution</span><span class="p">(</span><span class="n">beta</span><span class="p">,</span> <span class="n">scale_values</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span>

    <span class="c1"># Compute CDF values using PGD as the x_value</span>
    <span class="n">landcdf1</span> <span class="o">=</span> <span class="n">dist1</span><span class="o">.</span><span class="n">cdf</span><span class="p">(</span><span class="n">pgd_value</span><span class="p">)</span> <span class="k">if</span> <span class="n">pd</span><span class="o">.</span><span class="n">notnull</span><span class="p">(</span><span class="n">pgd_value</span><span class="p">)</span> <span class="k">else</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
    <span class="n">landcdf2</span> <span class="o">=</span> <span class="n">dist2</span><span class="o">.</span><span class="n">cdf</span><span class="p">(</span><span class="n">pgd_value</span><span class="p">)</span> <span class="k">if</span> <span class="n">pd</span><span class="o">.</span><span class="n">notnull</span><span class="p">(</span><span class="n">pgd_value</span><span class="p">)</span> <span class="k">else</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
    <span class="n">landcdf3</span> <span class="o">=</span> <span class="n">dist3</span><span class="o">.</span><span class="n">cdf</span><span class="p">(</span><span class="n">pgd_value</span><span class="p">)</span> <span class="k">if</span> <span class="n">pd</span><span class="o">.</span><span class="n">notnull</span><span class="p">(</span><span class="n">pgd_value</span><span class="p">)</span> <span class="k">else</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
    <span class="n">landcdf4</span> <span class="o">=</span> <span class="n">dist4</span><span class="o">.</span><span class="n">cdf</span><span class="p">(</span><span class="n">pgd_value</span><span class="p">)</span> <span class="k">if</span> <span class="n">pd</span><span class="o">.</span><span class="n">notnull</span><span class="p">(</span><span class="n">pgd_value</span><span class="p">)</span> <span class="k">else</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>

    <span class="k">return</span> <span class="n">landcdf1</span><span class="p">,</span> <span class="n">landcdf2</span><span class="p">,</span> <span class="n">landcdf3</span><span class="p">,</span> <span class="n">landcdf4</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Create a DataFrame to store the final results</span>
<span class="n">Landcdf</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>

<span class="c1"># Iterate over each return period in the Scenaria DataFrame</span>
<span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">Scenaria</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>
    <span class="n">years_value</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;1/years&#39;</span><span class="p">]</span>  <span class="c1"># Get the years value from the current row</span>
    <span class="n">cdf_results</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="c1"># Compute CDF values for each row in the PGD DataFrame</span>
    <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">pgd_row</span> <span class="ow">in</span> <span class="n">PGD</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>
        <span class="n">cdf_values</span> <span class="o">=</span> <span class="n">compute_landcdf_values</span><span class="p">(</span><span class="n">pgd_row</span><span class="p">,</span> <span class="n">years_value</span><span class="p">)</span>
        <span class="n">cdf_results</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">cdf_values</span><span class="p">)</span>

    <span class="c1"># Convert the results to a DataFrame</span>
    <span class="n">cdf_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">cdf_results</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="sa">f</span><span class="s1">&#39;LandDS1-</span><span class="si">{</span><span class="n">years_value</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;LandDS2-</span><span class="si">{</span><span class="n">years_value</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;LandDS3-</span><span class="si">{</span><span class="n">years_value</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;LandDS4-</span><span class="si">{</span><span class="n">years_value</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">])</span>
    
    <span class="c1"># Concatenate the results to the main landcdf DataFrame</span>
    <span class="n">Landcdf</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">Landcdf</span><span class="p">,</span> <span class="n">cdf_df</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<section id="pl-1-0">
<h3>PL = 1.0<a class="headerlink" href="#pl-1-0" title="Link to this heading">#</a></h3>
<p>Calculate the damage index (loss ratio) assuming that the probability of an earthquake-induced landslide is equal to the probability of the earthquake itself (i.e., <span class="math notranslate nohighlight">\(P_L = 1.0\)</span>), meaning the landslide will certainly occur given that the earthquake occurs.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Convert relevant columns to numeric if they are not already</span>
<span class="n">DI_seismic</span> <span class="o">=</span> <span class="n">DI_seismic</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">to_numeric</span><span class="p">,</span> <span class="n">errors</span><span class="o">=</span><span class="s1">&#39;coerce&#39;</span><span class="p">)</span>
<span class="n">Landcdf</span> <span class="o">=</span> <span class="n">Landcdf</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">to_numeric</span><span class="p">,</span> <span class="n">errors</span><span class="o">=</span><span class="s1">&#39;coerce&#39;</span><span class="p">)</span>

<span class="c1"># Extract years_values from the Scenaria DataFrame</span>
<span class="n">years_values</span> <span class="o">=</span> <span class="n">Scenaria</span><span class="p">[</span><span class="s1">&#39;1/years&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>  <span class="c1"># Use the annual probabilities as years values</span>

<span class="c1"># Initialize a new DataFrame for combined results</span>
<span class="n">DI_combined_P1</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span>
<span class="p">})</span>

<span class="c1"># List of dataset names (DS1, DS2, DS3, DS4.ds5)</span>
<span class="n">datasets</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">]</span>

<span class="c1"># Loop through each years_value and perform the calculations for each dataset</span>
<span class="k">for</span> <span class="n">years_value</span> <span class="ow">in</span> <span class="n">years_values</span><span class="p">:</span>
    <span class="k">for</span> <span class="n">dataset</span> <span class="ow">in</span> <span class="n">datasets</span><span class="p">:</span>
        <span class="n">combined_value</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">DI_seismic</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;CDF</span><span class="si">{</span><span class="n">dataset</span><span class="si">}</span><span class="s2">-</span><span class="si">{</span><span class="n">years_value</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]</span> <span class="o">+</span> 
            <span class="mi">1</span> <span class="o">*</span> <span class="n">Landcdf</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;LandDS</span><span class="si">{</span><span class="n">dataset</span><span class="si">}</span><span class="s2">-</span><span class="si">{</span><span class="n">years_value</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]</span> <span class="o">-</span>
            <span class="n">DI_seismic</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;CDF</span><span class="si">{</span><span class="n">dataset</span><span class="si">}</span><span class="s2">-</span><span class="si">{</span><span class="n">years_value</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="mi">1</span> <span class="o">*</span> <span class="n">Landcdf</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;LandDS</span><span class="si">{</span><span class="n">dataset</span><span class="si">}</span><span class="s2">-</span><span class="si">{</span><span class="n">years_value</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]</span>
        <span class="p">)</span>
        
        <span class="c1"># Store the results in the new DataFrame</span>
        <span class="n">DI_combined_P1</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;CombDS</span><span class="si">{</span><span class="n">dataset</span><span class="si">}</span><span class="s2">-</span><span class="si">{</span><span class="n">years_value</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">combined_value</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Loop through each years_value and perform the calculations for each dataset</span>
<span class="k">for</span> <span class="n">years_value</span> <span class="ow">in</span> <span class="n">years_values</span><span class="p">:</span>
    <span class="c1"># Calculate probabilities of occurrence for each damage state</span>
    <span class="n">DI_combined_P1</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;P_DS1-</span><span class="si">{</span><span class="n">years_value</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">DI_combined_P1</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;CombDS1-</span><span class="si">{</span><span class="n">years_value</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]</span> <span class="o">-</span> <span class="n">DI_combined_P1</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;CombDS2-</span><span class="si">{</span><span class="n">years_value</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]</span>
    <span class="n">DI_combined_P1</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;P_DS2-</span><span class="si">{</span><span class="n">years_value</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">DI_combined_P1</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;CombDS2-</span><span class="si">{</span><span class="n">years_value</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]</span> <span class="o">-</span> <span class="n">DI_combined_P1</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;CombDS3-</span><span class="si">{</span><span class="n">years_value</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]</span>
    <span class="n">DI_combined_P1</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;P_DS3-</span><span class="si">{</span><span class="n">years_value</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">DI_combined_P1</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;CombDS3-</span><span class="si">{</span><span class="n">years_value</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]</span> <span class="o">-</span> <span class="n">DI_combined_P1</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;CombDS4-</span><span class="si">{</span><span class="n">years_value</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]</span>
    <span class="n">DI_combined_P1</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;P_DS4-</span><span class="si">{</span><span class="n">years_value</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">DI_combined_P1</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;CombDS4-</span><span class="si">{</span><span class="n">years_value</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]</span>

    <span class="c1"># Calculate damage index for the scenario based on Typology</span>
    <span class="k">for</span> <span class="n">index</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">DI_combined_P1</span><span class="p">)):</span>
        <span class="k">if</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;Material&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;Precast&#39;</span><span class="p">:</span>
            <span class="n">DI_combined_P1</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">index</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;DI-</span><span class="si">{</span><span class="n">years_value</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
                <span class="n">DI_combined_P1</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">index</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;P_DS1-</span><span class="si">{</span><span class="n">years_value</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="mf">0.05</span> <span class="o">+</span>
                <span class="n">DI_combined_P1</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">index</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;P_DS2-</span><span class="si">{</span><span class="n">years_value</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="mf">0.30</span> <span class="o">+</span>
                <span class="n">DI_combined_P1</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">index</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;P_DS3-</span><span class="si">{</span><span class="n">years_value</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="mf">0.70</span> <span class="o">+</span>
                <span class="n">DI_combined_P1</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">index</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;P_DS4-</span><span class="si">{</span><span class="n">years_value</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="mi">1</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">DI_combined_P1</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">index</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;DI-</span><span class="si">{</span><span class="n">years_value</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
                <span class="n">DI_combined_P1</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">index</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;P_DS1-</span><span class="si">{</span><span class="n">years_value</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="mf">0.05</span> <span class="o">+</span>
                <span class="n">DI_combined_P1</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">index</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;P_DS2-</span><span class="si">{</span><span class="n">years_value</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="mf">0.15</span> <span class="o">+</span>
                <span class="n">DI_combined_P1</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">index</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;P_DS3-</span><span class="si">{</span><span class="n">years_value</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="mf">0.60</span> <span class="o">+</span>
                <span class="n">DI_combined_P1</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">index</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;P_DS4-</span><span class="si">{</span><span class="n">years_value</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="mi">1</span>
            <span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Calculate annual collapse probability based on strest methodology</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Define return periods</span>
<span class="n">Periods</span> <span class="o">=</span> <span class="p">[</span><span class="mi">5</span><span class="p">,</span><span class="mi">73</span><span class="p">,</span><span class="mi">102</span><span class="p">,</span><span class="mi">475</span><span class="p">,</span><span class="mi">1000</span><span class="p">,</span><span class="mi">2500</span><span class="p">,</span><span class="mi">5000</span><span class="p">,</span><span class="mi">10000</span><span class="p">]</span>

<span class="n">lamda1</span><span class="o">=</span><span class="p">[</span><span class="mf">0.9999</span><span class="p">,</span><span class="mf">0.5</span><span class="p">,</span><span class="mf">0.39</span><span class="p">,</span><span class="mf">0.1</span><span class="p">,</span><span class="mf">0.05</span><span class="p">,</span><span class="mf">0.02</span><span class="p">,</span><span class="mf">0.01</span><span class="p">,</span><span class="mf">0.005</span><span class="p">]</span>

<span class="c1"># Compute λ values</span>
<span class="n">lambda_values</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span> <span class="o">/</span> <span class="p">(</span><span class="o">-</span><span class="mi">50</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">l</span><span class="p">))</span> <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="n">lamda1</span><span class="p">]</span>

<span class="c1"># Compute P[IM_i] using the given formula</span>
<span class="n">P_IM</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">lambda_values</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>  <span class="c1"># Avoid first and last index</span>
    <span class="n">P_IM_i</span> <span class="o">=</span> <span class="p">(</span><span class="n">lambda_values</span><span class="p">[</span><span class="n">t</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">lambda_values</span><span class="p">[</span><span class="n">t</span> <span class="o">+</span> <span class="mi">1</span><span class="p">])</span> <span class="o">/</span> <span class="mi">2</span>
    <span class="n">P_IM</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">P_IM_i</span><span class="p">)</span>


<span class="c1"># Create a dictionary mapping return periods to P[IM_i]</span>
<span class="n">P_IM_dict</span> <span class="o">=</span> <span class="p">{</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;1/years&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">]:</span> <span class="n">P_IM</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">P_IM</span><span class="p">))}</span>

<span class="c1"># Multiply each &quot;CDF4-{r}&quot; column by the corresponding P[IM_i]</span>
<span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;1/years&#39;</span><span class="p">]:</span>  <span class="c1"># Exclude first and last periods as they lack P[IM_i]</span>
    <span class="n">column_name</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;CombDS4-</span><span class="si">{</span><span class="n">r</span><span class="si">}</span><span class="s2">&quot;</span>
    <span class="n">new_column_name</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">column_name</span><span class="si">}</span><span class="s2">*P[IM_i]&quot;</span>

    <span class="k">if</span> <span class="n">column_name</span> <span class="ow">in</span> <span class="n">DI_combined_P1</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>  
        <span class="n">DI_combined_P1</span><span class="p">[</span><span class="n">new_column_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">DI_combined_P1</span><span class="p">[</span><span class="n">column_name</span><span class="p">]</span> <span class="o">*</span> <span class="n">P_IM_dict</span><span class="p">[</span><span class="n">r</span><span class="p">]</span>

<span class="c1"># Add a new column that sums all the new columns</span>
<span class="n">new_columns</span> <span class="o">=</span> <span class="p">[</span><span class="sa">f</span><span class="s2">&quot;CombDS4-</span><span class="si">{</span><span class="n">r</span><span class="si">}</span><span class="s2">*P[IM_i]&quot;</span> <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;1/years&#39;</span><span class="p">]</span> <span class="k">if</span> <span class="sa">f</span><span class="s2">&quot;CombDS4-</span><span class="si">{</span><span class="n">r</span><span class="si">}</span><span class="s2">&quot;</span> <span class="ow">in</span> <span class="n">DI_combined_P1</span><span class="o">.</span><span class="n">columns</span><span class="p">]</span>

<span class="c1"># Create a new column &quot;Sum_of_new_columns&quot; by summing across the new columns</span>
<span class="n">DI_combined_P1</span><span class="p">[</span><span class="s2">&quot;Annual Collapse Probability&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">DI_combined_P1</span><span class="p">[</span><span class="n">new_columns</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Create and save the final DataFrame containing the damage index (loss ratio) for different return periods along with the annual probability of collapse for each exposure point.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Concatenate df and IM horizontally, aligning by their index</span>
<span class="n">common_df_combined_P1</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">df</span><span class="p">,</span> <span class="n">IM</span><span class="p">,</span> <span class="n">ky</span><span class="p">,</span> <span class="n">PGD</span><span class="p">,</span> <span class="n">Landcdf</span><span class="p">,</span> <span class="n">DI_combined_P1</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

<span class="c1"># Define the path first</span>
<span class="n">seimsic_landslide_P1_file_path</span> <span class="o">=</span> <span class="n">savepath</span> <span class="o">/</span> <span class="sa">f</span><span class="s2">&quot;Multi-Hazard/Earthquakes &amp; Landslides/DI_Earthquakes_&amp;_Landslides_P1_ESRM20_</span><span class="si">{</span><span class="n">asset</span><span class="si">}</span><span class="s2">.csv&quot;</span>

<span class="c1"># Ensure the directory exists</span>
<span class="n">seimsic_landslide_P1_file_path</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">parents</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="c1"># Save the DataFrame to CSV</span>
<span class="n">common_df_combined_P1</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">seimsic_landslide_P1_file_path</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Visualise loss ratio map for a return period of 1000 years</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">common_df_combined_P1</span><span class="p">[</span><span class="s1">&#39;geometry&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">common_df_combined_P1</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">row</span><span class="p">:</span> <span class="n">Point</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;Longitude&#39;</span><span class="p">],</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;Latitude&#39;</span><span class="p">]),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

<span class="c1"># Convert to GeoDataFrame</span>
<span class="n">combined_P1_gdf</span> <span class="o">=</span> <span class="n">gpd</span><span class="o">.</span><span class="n">GeoDataFrame</span><span class="p">(</span><span class="n">common_df_combined_P1</span><span class="p">,</span> <span class="n">geometry</span><span class="o">=</span><span class="s1">&#39;geometry&#39;</span><span class="p">,</span> <span class="n">crs</span><span class="o">=</span><span class="s2">&quot;EPSG:4326&quot;</span><span class="p">)</span>

<span class="c1"># Create bins for the DI-0.001 column</span>
<span class="n">bins</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.25</span><span class="p">,</span> <span class="mf">0.4</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>  <span class="c1"># Define the bin ranges</span>
<span class="n">labels</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;0-0.1&#39;</span><span class="p">,</span> <span class="s1">&#39;0.1-0.25&#39;</span><span class="p">,</span> <span class="s1">&#39;0.25-0.4&#39;</span><span class="p">,</span> <span class="s1">&#39;0.4-1&#39;</span><span class="p">]</span>  <span class="c1"># Labels for the bins</span>

<span class="c1"># Assign bin values based on &#39;DI-0.001&#39;</span>
<span class="n">combined_P1_gdf</span><span class="p">[</span><span class="s1">&#39;DI_binned&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">cut</span><span class="p">(</span><span class="n">combined_P1_gdf</span><span class="p">[</span><span class="s1">&#39;DI-0.001&#39;</span><span class="p">],</span> <span class="n">bins</span><span class="o">=</span><span class="n">bins</span><span class="p">,</span> <span class="n">labels</span><span class="o">=</span><span class="n">labels</span><span class="p">,</span> <span class="n">right</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>


<span class="c1"># Interactive map with 4 bins and custom colors</span>
<span class="n">combined_P1_gdf</span><span class="o">.</span><span class="n">explore</span><span class="p">(</span>
    <span class="n">column</span><span class="o">=</span><span class="s2">&quot;DI_binned&quot;</span><span class="p">,</span>  <span class="c1"># Use the binned DI-0.001 column for coloring</span>
    <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;OrRd&#39;</span><span class="p">,</span>         <span class="c1"># Optional colormap, we are using custom colors</span>
    <span class="n">stroke</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>         <span class="c1"># Add stroke (outline) around markers</span>
    <span class="n">line_color</span><span class="o">=</span><span class="s2">&quot;black&quot;</span><span class="p">,</span>  <span class="c1"># Set the stroke color to black</span>
    <span class="n">legend</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>         <span class="c1"># Show the legend</span>
    <span class="n">legend_kwds</span><span class="o">=</span><span class="p">{</span>
        <span class="s1">&#39;caption&#39;</span><span class="p">:</span> <span class="s1">&#39;Loss ratio (T=1000 years)&#39;</span><span class="p">,</span>  <span class="c1"># Legend caption</span>
        <span class="s1">&#39;orientation&#39;</span><span class="p">:</span> <span class="s1">&#39;horizontal&#39;</span>             <span class="c1"># Horizontal legend</span>
    <span class="p">},</span>
    <span class="n">marker_kwds</span><span class="o">=</span><span class="p">{</span>
        <span class="s1">&#39;radius&#39;</span><span class="p">:</span> <span class="mi">5</span><span class="p">,</span>   <span class="c1"># Set marker size (adjust as needed)</span>
        <span class="s1">&#39;fill&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>   <span class="c1"># Fill the markers with color</span>
    <span class="p">},</span>
    <span class="n">tooltip</span><span class="o">=</span><span class="s2">&quot;DI-0.001&quot;</span><span class="p">,</span>  <span class="c1"># Show the DI-0.001 value in the tooltip</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="id1">
<h3>PL &lt; 1.0<a class="headerlink" href="#id1" title="Link to this heading">#</a></h3>
<p>Calculate the damage index (loss ratio) assuming that the probability of an earthquake-induced landslide is equal to the probability of the earthquake itself (i.e., <span class="math notranslate nohighlight">\(P_L = 1.0\)</span>), meaning the landslide will certainly occur given that the earthquake occurs.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Convert relevant columns to numeric if they are not already</span>
<span class="n">DI_seismic</span> <span class="o">=</span> <span class="n">DI_seismic</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">to_numeric</span><span class="p">,</span> <span class="n">errors</span><span class="o">=</span><span class="s1">&#39;coerce&#39;</span><span class="p">)</span>
<span class="n">Landcdf</span> <span class="o">=</span> <span class="n">Landcdf</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">to_numeric</span><span class="p">,</span> <span class="n">errors</span><span class="o">=</span><span class="s1">&#39;coerce&#39;</span><span class="p">)</span>
<span class="n">Plandslide_df</span> <span class="o">=</span> <span class="n">Plandslide_df</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">to_numeric</span><span class="p">,</span> <span class="n">errors</span><span class="o">=</span><span class="s1">&#39;coerce&#39;</span><span class="p">)</span>

<span class="c1"># Extract years_values from the Scenaria DataFrame</span>
<span class="n">years_values</span> <span class="o">=</span> <span class="n">Scenaria</span><span class="p">[</span><span class="s1">&#39;1/years&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>  <span class="c1"># Use the annual probabilities as years values</span>


<span class="c1"># Initialize a new DataFrame for combined results</span>
<span class="n">DI_combined</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span>
<span class="p">})</span>

<span class="c1"># List of dataset names (DS1, DS2, DS3, DS4)</span>
<span class="n">datasets</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">]</span>

<span class="c1"># Loop through each years_value and perform the calculations for each dataset</span>
<span class="k">for</span> <span class="n">years_value</span> <span class="ow">in</span> <span class="n">years_values</span><span class="p">:</span>
    <span class="k">for</span> <span class="n">dataset</span> <span class="ow">in</span> <span class="n">datasets</span><span class="p">:</span>
        <span class="n">combined_value</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">DI_seismic</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;CDF</span><span class="si">{</span><span class="n">dataset</span><span class="si">}</span><span class="s2">-</span><span class="si">{</span><span class="n">years_value</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]</span> <span class="o">+</span> 
            <span class="n">Plandslide_df</span><span class="p">[</span><span class="sa">f</span><span class="s1">&#39;Plandslide-</span><span class="si">{</span><span class="n">years_value</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">Landcdf</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;LandDS</span><span class="si">{</span><span class="n">dataset</span><span class="si">}</span><span class="s2">-</span><span class="si">{</span><span class="n">years_value</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]</span> <span class="o">-</span>
            <span class="n">DI_seismic</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;CDF</span><span class="si">{</span><span class="n">dataset</span><span class="si">}</span><span class="s2">-</span><span class="si">{</span><span class="n">years_value</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="n">Plandslide_df</span><span class="p">[</span><span class="sa">f</span><span class="s1">&#39;Plandslide-</span><span class="si">{</span><span class="n">years_value</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">Landcdf</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;LandDS</span><span class="si">{</span><span class="n">dataset</span><span class="si">}</span><span class="s2">-</span><span class="si">{</span><span class="n">years_value</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]</span>
        <span class="p">)</span>
        
        <span class="c1"># Store the results in the new DataFrame</span>
        <span class="n">DI_combined</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;CombDS</span><span class="si">{</span><span class="n">dataset</span><span class="si">}</span><span class="s2">-</span><span class="si">{</span><span class="n">years_value</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">combined_value</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Loop through each years_value and perform the calculations for each dataset</span>
<span class="k">for</span> <span class="n">years_value</span> <span class="ow">in</span> <span class="n">years_values</span><span class="p">:</span>

    <span class="c1"># Calculate probabilities of occurrence for each damage state</span>
    <span class="n">DI_combined</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;P_DS1-</span><span class="si">{</span><span class="n">years_value</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">DI_combined</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;CombDS1-</span><span class="si">{</span><span class="n">years_value</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]</span> <span class="o">-</span> <span class="n">DI_combined</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;CombDS2-</span><span class="si">{</span><span class="n">years_value</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]</span>
    <span class="n">DI_combined</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;P_DS2-</span><span class="si">{</span><span class="n">years_value</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">DI_combined</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;CombDS2-</span><span class="si">{</span><span class="n">years_value</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]</span> <span class="o">-</span> <span class="n">DI_combined</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;CombDS3-</span><span class="si">{</span><span class="n">years_value</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]</span>
    <span class="n">DI_combined</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;P_DS3-</span><span class="si">{</span><span class="n">years_value</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">DI_combined</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;CombDS3-</span><span class="si">{</span><span class="n">years_value</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]</span> <span class="o">-</span> <span class="n">DI_combined</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;CombDS4-</span><span class="si">{</span><span class="n">years_value</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]</span>
    <span class="n">DI_combined</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;P_DS4-</span><span class="si">{</span><span class="n">years_value</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">DI_combined</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;CombDS4-</span><span class="si">{</span><span class="n">years_value</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]</span>

    <span class="c1"># Calculate damage index for the scenario based on Material</span>
    <span class="c1"># This assumes you want to check the Material for each row</span>
    <span class="k">for</span> <span class="n">index</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">DI_combined</span><span class="p">)):</span>
        <span class="k">if</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;Material&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;Precast&#39;</span><span class="p">:</span>
            <span class="n">DI_combined</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">index</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;DI-</span><span class="si">{</span><span class="n">years_value</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
                <span class="n">DI_combined</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">index</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;P_DS1-</span><span class="si">{</span><span class="n">years_value</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="mf">0.05</span> <span class="o">+</span>
                <span class="n">DI_combined</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">index</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;P_DS2-</span><span class="si">{</span><span class="n">years_value</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="mf">0.30</span> <span class="o">+</span>
                <span class="n">DI_combined</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">index</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;P_DS3-</span><span class="si">{</span><span class="n">years_value</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="mf">0.70</span> <span class="o">+</span>
                <span class="n">DI_combined</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">index</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;P_DS4-</span><span class="si">{</span><span class="n">years_value</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="mi">1</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">DI_combined</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">index</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;DI-</span><span class="si">{</span><span class="n">years_value</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
                <span class="n">DI_combined</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">index</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;P_DS1-</span><span class="si">{</span><span class="n">years_value</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="mf">0.05</span> <span class="o">+</span>
                <span class="n">DI_combined</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">index</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;P_DS2-</span><span class="si">{</span><span class="n">years_value</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="mf">0.15</span> <span class="o">+</span>
                <span class="n">DI_combined</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">index</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;P_DS3-</span><span class="si">{</span><span class="n">years_value</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="mf">0.60</span> <span class="o">+</span>
                <span class="n">DI_combined</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">index</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;P_DS4-</span><span class="si">{</span><span class="n">years_value</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="mi">1</span>
            <span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Calculate annual collapse probability based on strest methodology</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Define return periods</span>
<span class="n">Periods</span> <span class="o">=</span> <span class="p">[</span><span class="mi">5</span><span class="p">,</span><span class="mi">73</span><span class="p">,</span><span class="mi">102</span><span class="p">,</span><span class="mi">475</span><span class="p">,</span><span class="mi">1000</span><span class="p">,</span><span class="mi">2500</span><span class="p">,</span><span class="mi">5000</span><span class="p">,</span><span class="mi">10000</span><span class="p">]</span>

<span class="n">lamda1</span><span class="o">=</span><span class="p">[</span><span class="mf">0.9999</span><span class="p">,</span><span class="mf">0.5</span><span class="p">,</span><span class="mf">0.39</span><span class="p">,</span><span class="mf">0.1</span><span class="p">,</span><span class="mf">0.05</span><span class="p">,</span><span class="mf">0.02</span><span class="p">,</span><span class="mf">0.01</span><span class="p">,</span><span class="mf">0.005</span><span class="p">]</span>

<span class="c1"># Compute λ values</span>
<span class="n">lambda_values</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span> <span class="o">/</span> <span class="p">(</span><span class="o">-</span><span class="mi">50</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">l</span><span class="p">))</span> <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="n">lamda1</span><span class="p">]</span>

<span class="c1"># Compute P[IM_i] using the given formula</span>
<span class="n">P_IM</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">lambda_values</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>  <span class="c1"># Avoid first and last index</span>
    <span class="n">P_IM_i</span> <span class="o">=</span> <span class="p">(</span><span class="n">lambda_values</span><span class="p">[</span><span class="n">t</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">lambda_values</span><span class="p">[</span><span class="n">t</span> <span class="o">+</span> <span class="mi">1</span><span class="p">])</span> <span class="o">/</span> <span class="mi">2</span>
    <span class="n">P_IM</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">P_IM_i</span><span class="p">)</span>


<span class="c1"># Create a dictionary mapping return periods to P[IM_i]</span>
<span class="n">P_IM_dict</span> <span class="o">=</span> <span class="p">{</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;1/years&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">]:</span> <span class="n">P_IM</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">P_IM</span><span class="p">))}</span>

<span class="c1"># Multiply each &quot;CDF4-{r}&quot; column by the corresponding P[IM_i]</span>
<span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;1/years&#39;</span><span class="p">]:</span>  <span class="c1"># Exclude first and last periods as they lack P[IM_i]</span>
    <span class="n">column_name</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;CombDS4-</span><span class="si">{</span><span class="n">r</span><span class="si">}</span><span class="s2">&quot;</span>
    <span class="n">new_column_name</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">column_name</span><span class="si">}</span><span class="s2">*P[IM_i]&quot;</span>

    <span class="k">if</span> <span class="n">column_name</span> <span class="ow">in</span> <span class="n">DI_combined</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>  
        <span class="n">DI_combined</span><span class="p">[</span><span class="n">new_column_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">DI_combined</span><span class="p">[</span><span class="n">column_name</span><span class="p">]</span> <span class="o">*</span> <span class="n">P_IM_dict</span><span class="p">[</span><span class="n">r</span><span class="p">]</span>

<span class="c1"># Add a new column that sums all the new columns</span>
<span class="n">new_columns</span> <span class="o">=</span> <span class="p">[</span><span class="sa">f</span><span class="s2">&quot;CombDS4-</span><span class="si">{</span><span class="n">r</span><span class="si">}</span><span class="s2">*P[IM_i]&quot;</span> <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;1/years&#39;</span><span class="p">]</span> <span class="k">if</span> <span class="sa">f</span><span class="s2">&quot;CombDS4-</span><span class="si">{</span><span class="n">r</span><span class="si">}</span><span class="s2">&quot;</span> <span class="ow">in</span> <span class="n">DI_combined</span><span class="o">.</span><span class="n">columns</span><span class="p">]</span>

<span class="c1"># Create a new column &quot;Sum_of_new_columns&quot; by summing across the new columns</span>
<span class="n">DI_combined</span><span class="p">[</span><span class="s2">&quot;Annual Collapse Probability&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">DI_combined</span><span class="p">[</span><span class="n">new_columns</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Create and save the final DataFrame containing the damage index (loss ratio) for different return periods along with the annual probability of collapse for each exposure point.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Concatenate df and IM horizontally, aligning by their index</span>
<span class="n">common_df_combined</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">df</span><span class="p">,</span> <span class="n">IM</span><span class="p">,</span> <span class="n">ky</span><span class="p">,</span> <span class="n">PGD</span><span class="p">,</span> <span class="n">Landcdf</span><span class="p">,</span> <span class="n">DI_combined</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

<span class="c1"># Define the path first</span>
<span class="n">seimsic_landslide_file_path</span> <span class="o">=</span> <span class="n">savepath</span> <span class="o">/</span> <span class="sa">f</span><span class="s2">&quot;Multi-Hazard/Earthquakes &amp; Landslides/DI_Earthquakes_&amp;_Landslides_Plandslide_ESRM20_</span><span class="si">{</span><span class="n">asset</span><span class="si">}</span><span class="s2">.csv&quot;</span>

<span class="c1"># Ensure the directory exists</span>
<span class="n">seimsic_landslide_file_path</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">parents</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="c1"># Save the DataFrame to CSV</span>
<span class="n">common_df_combined</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">seimsic_landslide_file_path</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Visualise loss ratio map for a return period of 1000 years</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">common_df_combined</span><span class="p">[</span><span class="s1">&#39;geometry&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">common_df_combined</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">row</span><span class="p">:</span> <span class="n">Point</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;Longitude&#39;</span><span class="p">],</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;Latitude&#39;</span><span class="p">]),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

<span class="c1"># Convert to GeoDataFrame</span>
<span class="n">combined_gdf</span> <span class="o">=</span> <span class="n">gpd</span><span class="o">.</span><span class="n">GeoDataFrame</span><span class="p">(</span><span class="n">common_df_combined</span><span class="p">,</span> <span class="n">geometry</span><span class="o">=</span><span class="s1">&#39;geometry&#39;</span><span class="p">,</span> <span class="n">crs</span><span class="o">=</span><span class="s2">&quot;EPSG:4326&quot;</span><span class="p">)</span>

<span class="c1"># Create bins for the DI-0.001 column</span>
<span class="n">bins</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.25</span><span class="p">,</span> <span class="mf">0.4</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>  <span class="c1"># Define the bin ranges</span>
<span class="n">labels</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;0-0.1&#39;</span><span class="p">,</span> <span class="s1">&#39;0.1-0.25&#39;</span><span class="p">,</span> <span class="s1">&#39;0.25-0.4&#39;</span><span class="p">,</span> <span class="s1">&#39;0.4-1&#39;</span><span class="p">]</span>  <span class="c1"># Labels for the bins</span>

<span class="c1"># Assign bin values based on &#39;DI-0.001&#39;</span>
<span class="n">combined_gdf</span><span class="p">[</span><span class="s1">&#39;DI_binned&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">cut</span><span class="p">(</span><span class="n">combined_gdf</span><span class="p">[</span><span class="s1">&#39;DI-0.001&#39;</span><span class="p">],</span> <span class="n">bins</span><span class="o">=</span><span class="n">bins</span><span class="p">,</span> <span class="n">labels</span><span class="o">=</span><span class="n">labels</span><span class="p">,</span> <span class="n">right</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>


<span class="c1"># Interactive map with 4 bins and custom colors</span>
<span class="n">combined_gdf</span><span class="o">.</span><span class="n">explore</span><span class="p">(</span>
    <span class="n">column</span><span class="o">=</span><span class="s2">&quot;DI_binned&quot;</span><span class="p">,</span>  <span class="c1"># Use the binned DI-0.001 column for coloring</span>
    <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;OrRd&#39;</span><span class="p">,</span>         <span class="c1"># Optional colormap, we are using custom colors</span>
    <span class="n">stroke</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>         <span class="c1"># Add stroke (outline) around markers</span>
    <span class="n">line_color</span><span class="o">=</span><span class="s2">&quot;black&quot;</span><span class="p">,</span>  <span class="c1"># Set the stroke color to black</span>
    <span class="n">legend</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>         <span class="c1"># Show the legend</span>
    <span class="n">legend_kwds</span><span class="o">=</span><span class="p">{</span>
        <span class="s1">&#39;caption&#39;</span><span class="p">:</span> <span class="s1">&#39;Loss ratio (T=1000 years)&#39;</span><span class="p">,</span>  <span class="c1"># Legend caption</span>
        <span class="s1">&#39;orientation&#39;</span><span class="p">:</span> <span class="s1">&#39;horizontal&#39;</span>             <span class="c1"># Horizontal legend</span>
    <span class="p">},</span>
    <span class="n">marker_kwds</span><span class="o">=</span><span class="p">{</span>
        <span class="s1">&#39;radius&#39;</span><span class="p">:</span> <span class="mi">5</span><span class="p">,</span>   <span class="c1"># Set marker size (adjust as needed)</span>
        <span class="s1">&#39;fill&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>   <span class="c1"># Fill the markers with color</span>
    <span class="p">},</span>
    <span class="n">tooltip</span><span class="o">=</span><span class="s2">&quot;DI-0.001&quot;</span><span class="p">,</span>  <span class="c1"># Show the DI-0.001 value in the tooltip</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "miraca"
        },
        kernelOptions: {
            name: "miraca",
            path: "./usecases/UC4/book"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'miraca'</script>

                </article>
              

              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="../../UC3/book/Use_Case_template.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">Use case 3 - Flooding in Zuid-Holland</p>
      </div>
    </a>
    <a class="right-next"
       href="../../UC5/Use_Case_5_v1.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Use Case 5 - Energy</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <dialog id="pst-secondary-sidebar-modal"></dialog>
                <div id="pst-secondary-sidebar" class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#single-hazard-seismic-risk-assessment">Single hazard - Seismic risk assessment</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#multi-hazard-earthquake-triggered-landslide">Multi hazard - Earthquake triggered landslide</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#pl-1-0">PL = 1.0</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id1">PL &lt; 1.0</a></li>
</ul>
</li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By MIRACA
</p>

  </div>
  
  <div class="footer-item">
    

  <p class="copyright">
    
      © Copyright 2023.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script defer src="../../../_static/scripts/bootstrap.js?digest=8878045cc6db502f8baf"></script>
<script defer src="../../../_static/scripts/pydata-sphinx-theme.js?digest=8878045cc6db502f8baf"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>