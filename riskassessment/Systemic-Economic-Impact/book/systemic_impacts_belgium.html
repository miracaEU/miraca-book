
<!DOCTYPE html>


<html lang="en" data-content_root="../../../" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Systemic economic impacts of a transportation corridor failure &#8212; MIRACA Technical Workbench</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  <!--
    this give us a css class that will be invisible only if js is disabled
  -->
  <noscript>
    <style>
      .pst-js-only { display: none !important; }

    </style>
  </noscript>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../../../_static/styles/theme.css?digest=8878045cc6db502f8baf" rel="stylesheet" />
<link href="../../../_static/styles/pydata-sphinx-theme.css?digest=8878045cc6db502f8baf" rel="stylesheet" />

    <link rel="stylesheet" type="text/css" href="../../../_static/pygments.css?v=03e43079" />
    <link rel="stylesheet" type="text/css" href="../../../_static/styles/sphinx-book-theme.css?v=eba8b062" />
    <link rel="stylesheet" type="text/css" href="../../../_static/togglebutton.css?v=13237357" />
    <link rel="stylesheet" type="text/css" href="../../../_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="../../../_static/mystnb.8ecb98da25f57f5357bf6f572d296f466b2cfe2517ffebfabe82451661e28f02.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/sphinx-thebe.css?v=4fa983c6" />
    <link rel="stylesheet" type="text/css" href="../../../_static/sphinx-design.min.css?v=95c83b7e" />
  
  <!-- So that users can add custom icons -->
  <script src="../../../_static/scripts/fontawesome.js?digest=8878045cc6db502f8baf"></script>
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../../../_static/scripts/bootstrap.js?digest=8878045cc6db502f8baf" />
<link rel="preload" as="script" href="../../../_static/scripts/pydata-sphinx-theme.js?digest=8878045cc6db502f8baf" />

    <script src="../../../_static/documentation_options.js?v=9eb32ce0"></script>
    <script src="../../../_static/doctools.js?v=9a2dae69"></script>
    <script src="../../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../../_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="../../../_static/copybutton.js?v=f281be69"></script>
    <script src="../../../_static/scripts/sphinx-book-theme.js?v=887ef09a"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../../../_static/togglebutton.js?v=4a39c7ea"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="../../../_static/design-tabs.js?v=f930bc37"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script async="async" src="../../../_static/sphinx-thebe.js?v=c100c467"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'riskassessment/Systemic-Economic-Impact/book/systemic_impacts_belgium';</script>
    <link rel="author" title="About these documents" href="../../../about.html" />
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
    <link rel="next" title="Introduction to the Use Cases" href="../../../usecases/introduction.html" />
    <link rel="prev" title="Climate risk assessment for transport infrastructure" href="../../AssetRiskModelling/book/risk_assessment_belgium.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  <meta name="docsearch:version" content="" />
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <dialog id="pst-search-dialog">
    
<form class="bd-search d-flex align-items-center"
      action="../../../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form>
  </dialog>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <dialog id="pst-primary-sidebar-modal"></dialog>
      <div id="pst-primary-sidebar" class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">

  
    
  

<a class="navbar-brand logo" href="../../../intro.html">
  
  
  
  
  
    
    
      
    
    
    <img src="../../../_static/logo.png" class="logo__image only-light" alt="MIRACA Technical Workbench - Home"/>
    <img src="../../../_static/logo.png" class="logo__image only-dark pst-js-only" alt="MIRACA Technical Workbench - Home"/>
  
  
</a></div>
        <div class="sidebar-primary-item">

<button class="btn search-button-field search-button__button pst-js-only" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
 <i class="fa-solid fa-magnifying-glass"></i>
 <span class="search-button__default-text">Search</span>
 <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
</button></div>
        <div class="sidebar-primary-item"><nav class="bd-links bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="../../../intro.html">
                    Welcome to the Miraca Book
                </a>
            </li>
        </ul>
        <p aria-level="2" class="caption" role="heading"><span class="caption-text">The Miraca approach</span></p>
<ul class="current nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../../miraca_approach.html">Description of the framework</a></li>
<li class="toctree-l1 current active has-children"><a class="reference internal" href="../../example.html">Example: Belgium road infrastructure</a><details open="open"><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../../AssetRiskModelling/book/risk_assessment_belgium.html">Climate Risk Assessment</a></li>
<li class="toctree-l2 current active"><a class="current reference internal" href="#">Systemic Economic impacts</a></li>
</ul>
</details></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Use Cases</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../../../usecases/introduction.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../usecases/UC1_intro.html">Use Case 1 - Flooding and windstorms in the TEN-T corridor (Coming soon)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../usecases/UC2/book/Use_Case_2.html">Use Case 2 - Wildfires in Catalonia</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../usecases/UC3/book/Use_Case_template.html">Use case 3 - Flooding in Zuid-Holland</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../usecases/UC4/book/E_E%2BL_ESRM20%2BElsus_new.html">Use Case 4 - Landslides &amp; Earthquake in Greece</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../usecases/UC5/Use_Case_5_v1.html">Use Case 5 - Flooding and landslides in Slovenia</a></li>


</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Technical background</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1 has-children"><a class="reference internal" href="../../../background/Exposure_Miraca/book/intro.html">Exposure database</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../background/Exposure_Miraca/book/Exposure_Miraca.html">Exploring the Critical Infrastructure Exposure Database</a></li>
</ul>
</details></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../../background/Vulnerability/book/intro.html">Vulnerability Database</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../background/Vulnerability/book/Vulnerability_workbench.html">Explore the Vulnerability database</a></li>
</ul>
</details></li>
<li class="toctree-l1"><a class="reference internal" href="../../../background/RoadFlowModelling/book/miraca_roads.html">Network modelling</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../background/CBAmodelling/book/miraca_cba.html">Cost-benefit analysis</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../../background/Transport-Flows-Allocation/book/intro.html">Transport and Flow Allocation model</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../background/Transport-Flows-Allocation/book/Air_Flow_Assignment.html">Air Flow Visualization by Country</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../background/Transport-Flows-Allocation/book/IWW_Flow_Assignment.html">Inland Waterways Flow Visualization by Country</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../background/Transport-Flows-Allocation/book/Maritime_Flow_Assignment.html">Maritime Flow Visualization by Country</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../background/Transport-Flows-Allocation/book/Rail_Flow_Assignment.html">Railway Flow Visualization by Country</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../background/Transport-Flows-Allocation/book/Road_Flow_Assignment.html">Road Flow Visualization by Country</a></li>
</ul>
</details></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../../background/AdaptationModelling/book/introduction.html">Adaptation strategies to Critical Infrastructure</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../background/AdaptationModelling/book/01_direct_damages_baseline.html">Direct damages</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../background/AdaptationModelling/book/02_indirect_damages_baseline.html">Indirect Losses</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../background/AdaptationModelling/book/03_batch_process_adaptations.html">Costs of adaptation strategies</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../background/AdaptationModelling/book/04_results_summary.html">Avoided damages and adaptation costs</a></li>
</ul>
</details></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">About</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../../../about.html">About Miraca</a></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
      <div class="sidebar-primary-item">
<div id="ethical-ad-placement"
      class="flat"
      data-ea-publisher="readthedocs"
      data-ea-type="readthedocs-sidebar"
      data-ea-manual="true">
</div></div>
  </div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><button class="sidebar-toggle primary-toggle btn btn-sm" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</button></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-source-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Source repositories">
    <i class="fab fa-github"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://github.com/miracaEU/miraca-book" target="_blank"
   class="btn btn-sm btn-source-repository-button dropdown-item"
   title="Source repository"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="btn__text-container">Repository</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/miracaEU/miraca-book/issues/new?title=Issue%20on%20page%20%2Friskassessment/Systemic-Economic-Impact/book/systemic_impacts_belgium.html&body=Your%20issue%20content%20here." target="_blank"
   class="btn btn-sm btn-source-issues-button dropdown-item"
   title="Open an issue"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="btn__text-container">Open issue</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="../../../_sources/riskassessment/Systemic-Economic-Impact/book/systemic_impacts_belgium.ipynb" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.ipynb</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button pst-js-only" aria-label="Color mode" data-bs-title="Color mode"  data-bs-placement="bottom" data-bs-toggle="tooltip">
  <i class="theme-switch fa-solid fa-sun                fa-lg" data-mode="light" title="Light"></i>
  <i class="theme-switch fa-solid fa-moon               fa-lg" data-mode="dark"  title="Dark"></i>
  <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"  title="System Settings"></i>
</button>


<button class="btn btn-sm pst-navbar-icon search-button search-button__button pst-js-only" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
</button>
<button class="sidebar-toggle secondary-toggle btn btn-sm" title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</button>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Systemic economic impacts of a transportation corridor failure</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#loading-the-required-packages-and-path-directories">1. Loading the required Packages and path directories</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#loading-the-data">2. Loading the Data</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#visualising-the-nuts-2-belgium-regions">Visualising the NUTS-2 Belgium regions</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#creating-a-points-dataframe">Creating a points dataframe</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#build-a-network-graph-of-the-roads">3. Build a network graph of the roads</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#plotting-the-road-network-of-belgium">4. Plotting the road network of belgium</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#baseline-distance-between-the-regions">5. Baseline distance between the regions</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#plotting-a-heatmap-of-distances-b-w-the-regions">Plotting a heatmap of distances b/w the regions</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#distance-between-the-regions-under-disruption">6. Distance between the regions under disruption</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#visualising-the-failed-corridor">Visualising the failed corridor</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#plotting-a-heatmap-of-increased-distance-between-the-regions">Plotting a heatmap of increased distance between the regions</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#input-output-table-aggregation">7. Input-Output table aggregation</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#system-level-economic-effects">8. System-level economic effects</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#results-visualisation">Results visualisation</a></li>
</ul>
</li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section class="tex2jax_ignore mathjax_ignore" id="systemic-economic-impacts-of-a-transportation-corridor-failure">
<h1>Systemic economic impacts of a transportation corridor failure<a class="headerlink" href="#systemic-economic-impacts-of-a-transportation-corridor-failure" title="Link to this heading">#</a></h1>
<p>This notebook presents an example to demonstarte the systemic economic effects of a transportation corridor (road) failure in Belgium. We will follow the steps outlined below:</p>
<ol class="arabic simple">
<li><p><strong>Data preparation:</strong><br />
We will first download and create a network graph of the road network of Belgium. Next, we idealise the network into 11 nodes (corresponding to 11-NUTS-2 regions of Belgium) and 20 corridors b/w them.</p></li>
<li><p><strong>Baseline distance b/w the regions:</strong><br />
We estimate the distances between the nodes using shortest-path under a no disruption scenario.</p></li>
<li><p><strong>Distance b/w the regions under disruption:</strong><br />
For this example, we assume the road between Limburg-BE (BE-22) and Liege (BE-33) is disrupted. Now we estimate the additional distances travelled b/w regions because of the disrupted corridor.</p></li>
<li><p><strong>Input-Output Table aggregation:</strong><br />
Next, we read the input-output table for belgium and aggregate land-transportation sector into a value-added category. Also, we perform a basic input-output check.</p></li>
<li><p><strong>System-level economic effects:</strong><br />
We use a cost-push IO model (price model) to estimate the increased prices of goods which further leads to decreased consumption. Then, we employ a conventional leontief I-O (quantity model) to estimate the reduced production (output) across regions.</p></li>
<li><p><strong>Results visualisation:</strong><br />
Finally, we visualise the regional production losses across different NUTS-2 regions of Belgium</p></li>
</ol>
<section id="loading-the-required-packages-and-path-directories">
<h2>1. Loading the required Packages and path directories<a class="headerlink" href="#loading-the-required-packages-and-path-directories" title="Link to this heading">#</a></h2>
<div class="cell tag_hide-input docutils container">
<details class="admonition hide above-input">
<summary aria-label="Toggle hidden content">
<p class="collapsed admonition-title">Show code cell source</p>
<p class="expanded admonition-title">Hide code cell source</p>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># HIDE CODE</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">geopandas</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">gpd</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">pandas</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">pd</span>
<span class="n">pd</span><span class="o">.</span><span class="n">set_option</span><span class="p">(</span><span class="s1">&#39;future.no_silent_downcasting&#39;</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">damagescanner.download</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">download</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">osmnx</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">ox</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">networkx</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">nx</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">shapely.ops</span><span class="w"> </span><span class="kn">import</span> <span class="n">unary_union</span><span class="p">,</span> <span class="n">linemerge</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">shapely.geometry</span><span class="w"> </span><span class="kn">import</span> <span class="n">Point</span>


<span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.pyplot</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">plt</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">contextily</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">cx</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">seaborn</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">sns</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">mpl</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">pathlib</span><span class="w"> </span><span class="kn">import</span> <span class="n">Path</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">os</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">pyarrow</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">openpyxl</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">tqdm</span><span class="w"> </span><span class="kn">import</span> <span class="n">tqdm</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">warnings</span>
<span class="n">warnings</span><span class="o">.</span><span class="n">filterwarnings</span><span class="p">(</span><span class="s2">&quot;ignore&quot;</span><span class="p">,</span> <span class="n">message</span><span class="o">=</span><span class="s2">&quot;Geometry is in a geographic CRS&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</details>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>C:\Users\sva100\AppData\Local\miniforge3\envs\mria\Lib\site-packages\xarray\backends\scipy_.py:39: UserWarning: A NumPy version &gt;=1.22.4 and &lt;2.3.0 is required for this version of SciPy (detected version 2.4.2)
  from scipy.io import netcdf_file as netcdf_file_base
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">base_path</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">())</span> <span class="o">+</span> <span class="s2">&quot;/data&quot;</span><span class="p">)</span>
<span class="n">outpath</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">())</span> <span class="o">+</span> <span class="s2">&quot;/output&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="loading-the-data">
<h2>2. Loading the Data<a class="headerlink" href="#loading-the-data" title="Link to this heading">#</a></h2>
<p>For the development of this notebook, we consider Belgium as the country of interest and roads for the Critical Infrastructure</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># NUTS 2016 Classification EU level</span>
<span class="n">nuts_eu</span> <span class="o">=</span> <span class="n">gpd</span><span class="o">.</span><span class="n">read_file</span><span class="p">(</span><span class="n">base_path</span> <span class="o">/</span> <span class="s1">&#39;NUTS_RG_03M_2016_4326.gpkg&#39;</span><span class="p">)</span>

<span class="c1"># NUTS-2 Regions of Belgium</span>
<span class="n">nuts_be</span> <span class="o">=</span> <span class="n">nuts_eu</span><span class="p">[(</span><span class="n">nuts_eu</span><span class="p">[</span><span class="s1">&#39;LEVL_CODE&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">2</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">nuts_eu</span><span class="p">[</span><span class="s1">&#39;CNTR_CODE&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;BE&#39;</span><span class="p">)]</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<section id="visualising-the-nuts-2-belgium-regions">
<h3>Visualising the NUTS-2 Belgium regions<a class="headerlink" href="#visualising-the-nuts-2-belgium-regions" title="Link to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Plotting</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span><span class="mi">6</span><span class="p">))</span>
<span class="n">nuts_be</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;#9A7AA0&#39;</span><span class="p">,</span>  <span class="n">edgecolor</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="n">alpha</span> <span class="o">=</span> <span class="mf">0.5</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s1">&#39;off&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../../_images/c931f05ec7f44712cb28eb8d3de16649c27ae510b1f9da04f16df4acb6581659.png" src="../../../_images/c931f05ec7f44712cb28eb8d3de16649c27ae510b1f9da04f16df4acb6581659.png" />
</div>
</div>
</section>
<section id="creating-a-points-dataframe">
<h3>Creating a points dataframe<a class="headerlink" href="#creating-a-points-dataframe" title="Link to this heading">#</a></h3>
<p>This will be usedful in the later part of the notebook, where the points are assumed as nodes of the network</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Point dataframe of NUTS-2 region of Netherlands</span>
<span class="n">nuts_be_point</span> <span class="o">=</span> <span class="n">nuts_be</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="n">nuts_be_point</span><span class="p">[</span><span class="s1">&#39;geometry&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">nuts_be</span><span class="o">.</span><span class="n">centroid</span>
</pre></div>
</div>
</div>
</div>
<p>Downloading the roads of Belgium using damagescanner</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Downlaoding the openstreetmap data for the country of belgium</span>
<span class="c1"># The path contains the location of the downloaded pbf file</span>
<span class="n">infrastructure_path</span> <span class="o">=</span> <span class="n">download</span><span class="o">.</span><span class="n">get_country_geofabrik</span><span class="p">(</span><span class="s1">&#39;BEL&#39;</span><span class="p">)</span> 
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%time</span>

<span class="c1"># Filtering the line types</span>
<span class="n">roads</span> <span class="o">=</span> <span class="n">gpd</span><span class="o">.</span><span class="n">read_file</span><span class="p">(</span><span class="n">infrastructure_path</span><span class="p">,</span> <span class="n">layer</span><span class="o">=</span><span class="s2">&quot;lines&quot;</span><span class="p">)</span>

<span class="c1"># Filtering the dataframe such that the highway columns is not None</span>
<span class="n">roads</span> <span class="o">=</span> <span class="n">roads</span><span class="p">[</span><span class="n">roads</span><span class="p">[</span><span class="s2">&quot;highway&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>CPU times: total: 1min 21s
Wall time: 1min 10s
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">roads</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>osm_id</th>
      <th>name</th>
      <th>highway</th>
      <th>waterway</th>
      <th>aerialway</th>
      <th>barrier</th>
      <th>man_made</th>
      <th>railway</th>
      <th>z_order</th>
      <th>other_tags</th>
      <th>geometry</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>75146</td>
      <td>Rue de Thiribut</td>
      <td>residential</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>3</td>
      <td>None</td>
      <td>LINESTRING (5.00314 50.57241, 5.0032 50.57244,...</td>
    </tr>
    <tr>
      <th>1</th>
      <td>195145</td>
      <td>None</td>
      <td>motorway_link</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>9</td>
      <td>"destination"=&gt;"Andenne;Bierwart;Mécalys;Ciney...</td>
      <td>LINESTRING (5.06149 50.53069, 5.0604 50.53082,...</td>
    </tr>
    <tr>
      <th>2</th>
      <td>195314</td>
      <td>None</td>
      <td>motorway_link</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>9</td>
      <td>"destination"=&gt;"Hannut;Hingeon","destination:r...</td>
      <td>LINESTRING (5.00917 50.53085, 5.01038 50.53093...</td>
    </tr>
    <tr>
      <th>3</th>
      <td>197574</td>
      <td>None</td>
      <td>trunk</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>8</td>
      <td>"junction"=&gt;"roundabout","lanes"=&gt;"3","lit"=&gt;"...</td>
      <td>LINESTRING (4.52797 50.45663, 4.52794 50.45655...</td>
    </tr>
    <tr>
      <th>4</th>
      <td>197576</td>
      <td>Rue du Bois des Loges</td>
      <td>residential</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>3</td>
      <td>"lanes"=&gt;"2","lit"=&gt;"yes","maxspeed"=&gt;"30","su...</td>
      <td>LINESTRING (4.96795 50.33742, 4.96782 50.33746...</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
</section>
</section>
<section id="build-a-network-graph-of-the-roads">
<h2>3. Build a network graph of the roads<a class="headerlink" href="#build-a-network-graph-of-the-roads" title="Link to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">build_graph</span><span class="p">(</span><span class="n">roads</span><span class="p">):</span>

<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Function to create a network graph i.e., a network of nodes and edges from a dataframe of roads</span>
<span class="sd">    ----------</span>
<span class="sd">    roads : geodataframe with lines as geometries</span>
<span class="sd">    </span>
<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    G : network-x graph</span>
<span class="sd">        A graph of nodes and edges. The edges are the linestrings in the roads geodataframe</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">roads</span> <span class="o">=</span> <span class="n">roads</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
    <span class="n">roads</span><span class="p">[</span><span class="s2">&quot;length_m&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">roads</span><span class="o">.</span><span class="n">to_crs</span><span class="p">(</span><span class="s2">&quot;EPSG:31370&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">geometry</span><span class="o">.</span><span class="n">length</span>

    <span class="c1"># Creating osmid column</span>
    <span class="k">if</span> <span class="s2">&quot;osm_id&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">roads</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
        <span class="n">roads</span><span class="p">[</span><span class="s2">&quot;osm_id&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">roads</span><span class="p">))</span>
        
    <span class="c1"># Initiate a network x graph</span>
    <span class="n">G</span> <span class="o">=</span> <span class="n">nx</span><span class="o">.</span><span class="n">Graph</span><span class="p">()</span>
    
    <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">tqdm</span><span class="p">(</span><span class="n">roads</span><span class="o">.</span><span class="n">iterrows</span><span class="p">(),</span> <span class="n">total</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">roads</span><span class="p">),</span> <span class="n">desc</span> <span class="o">=</span> <span class="s1">&#39;Building road graph&#39;</span><span class="p">):</span>
        <span class="n">start</span> <span class="o">=</span> <span class="n">row</span><span class="o">.</span><span class="n">geometry</span><span class="o">.</span><span class="n">coords</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">end</span>   <span class="o">=</span> <span class="n">row</span><span class="o">.</span><span class="n">geometry</span><span class="o">.</span><span class="n">coords</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        
        <span class="c1"># Adding edge to the graph</span>
        <span class="n">G</span><span class="o">.</span><span class="n">add_edge</span><span class="p">(</span><span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">,</span><span class="n">osmid</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="s2">&quot;osm_id&quot;</span><span class="p">],</span> <span class="n">length_m</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="s2">&quot;length_m&quot;</span><span class="p">],</span> <span class="n">geometry</span> <span class="o">=</span> <span class="n">row</span><span class="o">.</span><span class="n">geometry</span><span class="p">)</span>
        
    <span class="c1"># Only using the largest connected component </span>
    <span class="n">largest</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">nx</span><span class="o">.</span><span class="n">connected_components</span><span class="p">(</span><span class="n">G</span><span class="p">),</span> <span class="n">key</span><span class="o">=</span><span class="nb">len</span><span class="p">)</span>
    <span class="n">G</span> <span class="o">=</span> <span class="n">G</span><span class="o">.</span><span class="n">subgraph</span><span class="p">(</span><span class="n">largest</span><span class="p">)</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
    <span class="n">G</span><span class="o">.</span><span class="n">graph</span><span class="p">[</span><span class="s2">&quot;crs&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;EPSG:4326&quot;</span>
    
    <span class="k">return</span> <span class="n">G</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">G</span> <span class="o">=</span> <span class="n">build_graph</span><span class="p">(</span><span class="n">roads</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Building road graph: 100%|███████████████████████████████████████████████████████| 1451857/1451857 [01:26&lt;00:00, 16692.55it/s]
</pre></div>
</div>
</div>
</div>
</section>
<section id="plotting-the-road-network-of-belgium">
<h2>4. Plotting the road network of belgium<a class="headerlink" href="#plotting-the-road-network-of-belgium" title="Link to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Nodes: </span><span class="si">{</span><span class="n">G</span><span class="o">.</span><span class="n">number_of_nodes</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Edges: </span><span class="si">{</span><span class="n">G</span><span class="o">.</span><span class="n">number_of_edges</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="c1"># Plotting</span>

<span class="c1"># Extracting edges and creating a geodataframe</span>
<span class="n">edges</span> <span class="o">=</span> <span class="p">[(</span><span class="n">G</span><span class="p">[</span><span class="n">u</span><span class="p">][</span><span class="n">v</span><span class="p">][</span><span class="s2">&quot;geometry&quot;</span><span class="p">])</span> <span class="k">for</span> <span class="n">u</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">G</span><span class="o">.</span><span class="n">edges</span><span class="p">()]</span>
<span class="n">edge_gdf</span> <span class="o">=</span> <span class="n">gpd</span><span class="o">.</span><span class="n">GeoDataFrame</span><span class="p">({</span><span class="s2">&quot;geometry&quot;</span><span class="p">:</span> <span class="n">edges</span><span class="p">},</span> <span class="n">crs</span><span class="o">=</span><span class="s2">&quot;EPSG:4326&quot;</span><span class="p">)</span>

<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
<span class="n">nuts_be</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;#9A7AA0&#39;</span><span class="p">,</span>  <span class="n">edgecolor</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">alpha</span> <span class="o">=</span> <span class="mf">0.5</span><span class="p">)</span>
<span class="n">edge_gdf</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;white&quot;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">alpha</span> <span class="o">=</span> <span class="mf">0.5</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s1">&#39;off&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Nodes: 600064
Edges: 710151
</pre></div>
</div>
<img alt="../../../_images/0776718375a614e0f2c358fb044c7a02230e5892856abb8d761b55928e0714ba.png" src="../../../_images/0776718375a614e0f2c358fb044c7a02230e5892856abb8d761b55928e0714ba.png" />
</div>
</div>
<p>Next, we create a stylised representation of the road network between NUTS-2 regions of Belgium</p>
<p>Adjaceny matrices are square matrices of size equal to the number of nodes. Here, we consider the NUTS-2 regions as nodes. They contain the connectivity information between the regions. adj(i,j) = 1 if i and j has an edge between them; else 0.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Adjacenct matrix for the network</span>
<span class="n">adj_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_excel</span><span class="p">(</span><span class="n">base_path</span> <span class="o">/</span><span class="s1">&#39;adj_matrix.xlsx&#39;</span><span class="p">,</span> <span class="n">index_col</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Plotting the stylised road network of Belgium</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">points</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="n">pt</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">pt</span><span class="o">.</span><span class="n">y</span><span class="p">]</span> <span class="k">for</span> <span class="n">pt</span> <span class="ow">in</span> <span class="n">nuts_be_point</span><span class="o">.</span><span class="n">geometry</span><span class="p">])</span>
<span class="n">nuts_ids</span> <span class="o">=</span> <span class="n">nuts_be_point</span><span class="p">[</span><span class="s2">&quot;NUTS_ID&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>

<span class="c1"># Build a mapping from NUTS_ID to index</span>
<span class="n">nuts_to_idx</span> <span class="o">=</span> <span class="p">{</span><span class="n">nid</span><span class="p">:</span> <span class="n">i</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">nid</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">nuts_ids</span><span class="p">)}</span>

<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span><span class="mi">6</span><span class="p">))</span>

<span class="c1"># Plot the points</span>
<span class="n">nuts_be</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;#9A7AA0&#39;</span><span class="p">,</span>  <span class="n">edgecolor</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span>  <span class="n">alpha</span> <span class="o">=</span> <span class="mf">0.5</span><span class="p">)</span>
<span class="n">nuts_be_point</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="n">markersize</span><span class="o">=</span><span class="mi">50</span><span class="p">)</span>

<span class="c1"># Plot edges from adjacency DataFrame</span>
<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">start</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">adj_df</span><span class="o">.</span><span class="n">index</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">j</span><span class="p">,</span> <span class="n">end</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">adj_df</span><span class="o">.</span><span class="n">columns</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">adj_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">and</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">j</span><span class="p">:</span>  <span class="c1"># avoid double plotting</span>
            <span class="n">x</span> <span class="o">=</span> <span class="p">[</span><span class="n">points</span><span class="p">[</span><span class="n">nuts_to_idx</span><span class="p">[</span><span class="n">start</span><span class="p">],</span> <span class="mi">0</span><span class="p">],</span> <span class="n">points</span><span class="p">[</span><span class="n">nuts_to_idx</span><span class="p">[</span><span class="n">end</span><span class="p">],</span> <span class="mi">0</span><span class="p">]]</span>
            <span class="n">y</span> <span class="o">=</span> <span class="p">[</span><span class="n">points</span><span class="p">[</span><span class="n">nuts_to_idx</span><span class="p">[</span><span class="n">start</span><span class="p">],</span> <span class="mi">1</span><span class="p">],</span> <span class="n">points</span><span class="p">[</span><span class="n">nuts_to_idx</span><span class="p">[</span><span class="n">end</span><span class="p">],</span> <span class="mi">1</span><span class="p">]]</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;white&#39;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
            
<span class="n">ax</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s1">&#39;off&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../../_images/0f335d006af98b639a2a6ee8624680ea03281e932009f6c5c26b918dee72d5fe.png" src="../../../_images/0f335d006af98b639a2a6ee8624680ea03281e932009f6c5c26b918dee72d5fe.png" />
</div>
</div>
<p>Now, we replace the straight lines with actual roads from the previously generated network graph</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">nearest_node</span><span class="p">(</span><span class="n">G</span><span class="p">,</span> <span class="n">lon</span><span class="p">,</span> <span class="n">lat</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Function to identify the closest node in a graph to the coordinates of interest</span>
<span class="sd">    ----------</span>
<span class="sd">    G : network-x graph</span>
<span class="sd">    lon: longitude of the coordinate of interest</span>
<span class="sd">    lat: latitude of the coordinate of interest</span>
<span class="sd">    </span>
<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    The closest node to the coordinates of interest</span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="n">nodes</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">G</span><span class="o">.</span><span class="n">nodes</span><span class="p">)</span>
    <span class="n">nodes_arr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">nodes</span><span class="p">)</span>
    <span class="n">dists</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hypot</span><span class="p">(</span><span class="n">nodes_arr</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">lon</span><span class="p">,</span> <span class="n">nodes_arr</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">lat</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">nodes</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">argmin</span><span class="p">(</span><span class="n">dists</span><span class="p">)]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Using points dataframe to extract latitude and longitude</span>
<span class="n">nuts_be_point</span><span class="p">[</span><span class="s1">&#39;x&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">nuts_be_point</span><span class="o">.</span><span class="n">geometry</span><span class="o">.</span><span class="n">x</span>
<span class="n">nuts_be_point</span><span class="p">[</span><span class="s1">&#39;y&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">nuts_be_point</span><span class="o">.</span><span class="n">geometry</span><span class="o">.</span><span class="n">y</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">records</span> <span class="o">=</span> <span class="p">[]</span>


<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">nuts_be_point</span><span class="p">)):</span>
    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">nuts_be_point</span><span class="p">)):</span>

        <span class="n">nutsid_1</span> <span class="o">=</span> <span class="n">nuts_be_point</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="s1">&#39;NUTS_ID&#39;</span><span class="p">]</span>
        <span class="n">nutsid_2</span> <span class="o">=</span> <span class="n">nuts_be_point</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">j</span><span class="p">,</span> <span class="s1">&#39;NUTS_ID&#39;</span><span class="p">]</span>

        <span class="n">connection</span> <span class="o">=</span> <span class="n">adj_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">nutsid_1</span><span class="p">,</span> <span class="n">nutsid_2</span><span class="p">]</span>

        <span class="k">if</span> <span class="n">connection</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            
            <span class="n">node_a</span> <span class="o">=</span> <span class="n">nearest_node</span><span class="p">(</span><span class="n">G</span><span class="p">,</span> <span class="n">lon</span><span class="o">=</span><span class="n">nuts_be_point</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="s1">&#39;x&#39;</span><span class="p">],</span>   <span class="n">lat</span><span class="o">=</span><span class="n">nuts_be_point</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="s1">&#39;y&#39;</span><span class="p">])</span>
            <span class="n">node_b</span> <span class="o">=</span> <span class="n">nearest_node</span><span class="p">(</span><span class="n">G</span><span class="p">,</span> <span class="n">lon</span><span class="o">=</span><span class="n">nuts_be_point</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">j</span><span class="p">,</span><span class="s1">&#39;x&#39;</span><span class="p">],</span>   <span class="n">lat</span><span class="o">=</span><span class="n">nuts_be_point</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">j</span><span class="p">,</span><span class="s1">&#39;y&#39;</span><span class="p">])</span>

            <span class="c1"># Identifying the shorteest path</span>
            <span class="n">path</span> <span class="o">=</span> <span class="n">nx</span><span class="o">.</span><span class="n">shortest_path</span><span class="p">(</span><span class="n">G</span><span class="p">,</span> <span class="n">node_a</span><span class="p">,</span> <span class="n">node_b</span><span class="p">,</span> <span class="n">weight</span><span class="o">=</span><span class="s2">&quot;length_m&quot;</span><span class="p">)</span>

            <span class="c1"># Converting multiple linestrings into a single line</span>
            <span class="n">path_geoms</span> <span class="o">=</span> <span class="p">[</span><span class="n">G</span><span class="p">[</span><span class="n">u</span><span class="p">][</span><span class="n">v</span><span class="p">][</span><span class="s2">&quot;geometry&quot;</span><span class="p">]</span> <span class="k">for</span> <span class="n">u</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">path</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">path</span><span class="p">[</span><span class="mi">1</span><span class="p">:])]</span>
            <span class="n">single_line</span> <span class="o">=</span> <span class="n">linemerge</span><span class="p">(</span><span class="n">path_geoms</span><span class="p">)</span>

            <span class="c1">#  Appending to the list that stores the start, end and the adge information</span>
            <span class="n">records</span><span class="o">.</span><span class="n">append</span><span class="p">({</span><span class="s2">&quot;nutsid_1&quot;</span><span class="p">:</span> <span class="n">nutsid_1</span><span class="p">,</span> <span class="s2">&quot;nutsid_2&quot;</span><span class="p">:</span> <span class="n">nutsid_2</span><span class="p">,</span> <span class="s2">&quot;geometry&quot;</span><span class="p">:</span> <span class="n">single_line</span><span class="p">})</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Converting the edges to the dataframe</span>
<span class="n">roads_nuts2</span> <span class="o">=</span> <span class="n">gpd</span><span class="o">.</span><span class="n">GeoDataFrame</span><span class="p">(</span><span class="n">records</span><span class="p">,</span> <span class="n">geometry</span><span class="o">=</span><span class="s2">&quot;geometry&quot;</span><span class="p">,</span> <span class="n">crs</span><span class="o">=</span><span class="n">nuts_be_point</span><span class="o">.</span><span class="n">crs</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Creating a new graph with only NUTS-2 regions as nodes and the actual shortest path b/w them as edges</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">G_nuts</span> <span class="o">=</span> <span class="n">build_graph</span><span class="p">(</span><span class="n">roads_nuts2</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Building road graph: 100%|██████████████████████████████████████████████████████████████████| 40/40 [00:00&lt;00:00, 6830.00it/s]
</pre></div>
</div>
</div>
</div>
<p>Visualising the stylised network with actual roads</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span><span class="mi">6</span><span class="p">))</span>

<span class="c1"># NUTS-2 polygons</span>
<span class="n">nuts_be</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;#9A7AA0&#39;</span><span class="p">,</span>  <span class="n">edgecolor</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="n">zorder</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">alpha</span> <span class="o">=</span> <span class="mf">0.5</span><span class="p">)</span>\

<span class="c1"># NUTS-2 points</span>
<span class="n">nuts_be_point</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="n">markersize</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span> <span class="n">zorder</span> <span class="o">=</span> <span class="mi">3</span><span class="p">)</span>

<span class="c1"># Roads</span>
<span class="n">edges_nuts</span> <span class="o">=</span> <span class="p">[(</span><span class="n">G_nuts</span><span class="p">[</span><span class="n">u</span><span class="p">][</span><span class="n">v</span><span class="p">][</span><span class="s2">&quot;geometry&quot;</span><span class="p">])</span> <span class="k">for</span> <span class="n">u</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">G_nuts</span><span class="o">.</span><span class="n">edges</span><span class="p">()]</span>
<span class="n">edge_gdf_nuts</span> <span class="o">=</span> <span class="n">gpd</span><span class="o">.</span><span class="n">GeoDataFrame</span><span class="p">({</span><span class="s2">&quot;geometry&quot;</span><span class="p">:</span> <span class="n">edges_nuts</span><span class="p">},</span> <span class="n">crs</span><span class="o">=</span><span class="s2">&quot;EPSG:4326&quot;</span><span class="p">)</span>
<span class="n">edge_gdf_nuts</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;white&quot;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">alpha</span> <span class="o">=</span> <span class="mf">0.8</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s2">&quot;-&quot;</span><span class="p">,</span> <span class="n">zorder</span> <span class="o">=</span> <span class="mi">2</span><span class="p">)</span>
<span class="n">cx</span><span class="o">.</span><span class="n">add_basemap</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">source</span><span class="o">=</span><span class="n">cx</span><span class="o">.</span><span class="n">providers</span><span class="o">.</span><span class="n">CartoDB</span><span class="o">.</span><span class="n">Positron</span><span class="p">,</span> <span class="n">crs</span><span class="o">=</span><span class="n">nuts_be</span><span class="o">.</span><span class="n">crs</span><span class="p">)</span>

<span class="n">ax</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s1">&#39;off&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../../_images/2a260f903050a681bfc9c44cd4fac0d9fa45d7080d80ce625766e9d8ac29e5b6.png" src="../../../_images/2a260f903050a681bfc9c44cd4fac0d9fa45d7080d80ce625766e9d8ac29e5b6.png" />
</div>
</div>
</section>
<section id="baseline-distance-between-the-regions">
<h2>5. Baseline distance between the regions<a class="headerlink" href="#baseline-distance-between-the-regions" title="Link to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># An empty dataframe of size regions x regions to store the distance b/w them</span>
<span class="n">distance_base</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">index</span> <span class="o">=</span> <span class="n">nuts_ids</span><span class="p">,</span> <span class="n">columns</span> <span class="o">=</span> <span class="n">nuts_ids</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">nuts_be_point</span><span class="p">)):</span>
    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">nuts_be_point</span><span class="p">)):</span>

        <span class="c1"># NUTS-IDs</span>
        <span class="n">nutsid_1</span> <span class="o">=</span> <span class="n">nuts_be_point</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="s1">&#39;NUTS_ID&#39;</span><span class="p">]</span>
        <span class="n">nutsid_2</span> <span class="o">=</span> <span class="n">nuts_be_point</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">j</span><span class="p">,</span> <span class="s1">&#39;NUTS_ID&#39;</span><span class="p">]</span>

        <span class="c1"># Identifying the closest points in the graph</span>
        <span class="n">node_a</span> <span class="o">=</span> <span class="n">nearest_node</span><span class="p">(</span><span class="n">G_nuts</span><span class="p">,</span> <span class="n">lon</span><span class="o">=</span><span class="n">nuts_be_point</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="s1">&#39;x&#39;</span><span class="p">],</span>   <span class="n">lat</span><span class="o">=</span><span class="n">nuts_be_point</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="s1">&#39;y&#39;</span><span class="p">])</span>
        <span class="n">node_b</span> <span class="o">=</span> <span class="n">nearest_node</span><span class="p">(</span><span class="n">G_nuts</span><span class="p">,</span> <span class="n">lon</span><span class="o">=</span><span class="n">nuts_be_point</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">j</span><span class="p">,</span><span class="s1">&#39;x&#39;</span><span class="p">],</span>   <span class="n">lat</span><span class="o">=</span><span class="n">nuts_be_point</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">j</span><span class="p">,</span><span class="s1">&#39;y&#39;</span><span class="p">])</span>

        <span class="c1"># Distance in km</span>
        <span class="n">dist_km</span> <span class="o">=</span> <span class="n">nx</span><span class="o">.</span><span class="n">shortest_path_length</span><span class="p">(</span><span class="n">G_nuts</span><span class="p">,</span> <span class="n">node_a</span><span class="p">,</span> <span class="n">node_b</span><span class="p">,</span> <span class="n">weight</span><span class="o">=</span><span class="s2">&quot;length_m&quot;</span><span class="p">)</span><span class="o">/</span><span class="mi">1000</span>
        <span class="n">distance_base</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">nutsid_1</span><span class="p">,</span> <span class="n">nutsid_2</span><span class="p">]</span> <span class="o">=</span> <span class="n">dist_km</span>
        
</pre></div>
</div>
</div>
</div>
<section id="plotting-a-heatmap-of-distances-b-w-the-regions">
<h3>Plotting a heatmap of distances b/w the regions<a class="headerlink" href="#plotting-a-heatmap-of-distances-b-w-the-regions" title="Link to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>

<span class="n">distance_base</span> <span class="o">=</span> <span class="n">distance_base</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span>

<span class="n">ax</span> <span class="o">=</span> <span class="n">sns</span><span class="o">.</span><span class="n">heatmap</span><span class="p">(</span>
    <span class="n">distance_base</span><span class="p">,</span>
    <span class="n">cmap</span><span class="o">=</span><span class="s2">&quot;Blues&quot;</span><span class="p">,</span>
    <span class="n">vmin</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
    <span class="n">vmax</span><span class="o">=</span><span class="mi">300</span><span class="p">,</span>
    <span class="n">square</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">cbar_kws</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;label&quot;</span><span class="p">:</span> <span class="s2">&quot;Distance (km)&quot;</span><span class="p">,</span> <span class="s2">&quot;orientation&quot;</span><span class="p">:</span> <span class="s2">&quot;horizontal&quot;</span><span class="p">,</span><span class="s2">&quot;pad&quot;</span><span class="p">:</span> <span class="mf">0.2</span><span class="p">,</span><span class="s2">&quot;fraction&quot;</span><span class="p">:</span> <span class="mf">0.04</span><span class="p">})</span>

<span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;Baseline distance b/w Belgium NUTS-2 regions&quot;</span><span class="p">,</span> <span class="n">fontsize</span> <span class="o">=</span> <span class="mi">10</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../../_images/8ccbd6db412b90700e4db4f581269920fc576bb70558070a7493c5ee46666363.png" src="../../../_images/8ccbd6db412b90700e4db4f581269920fc576bb70558070a7493c5ee46666363.png" />
</div>
</div>
</section>
</section>
<section id="distance-between-the-regions-under-disruption">
<h2>6. Distance between the regions under disruption<a class="headerlink" href="#distance-between-the-regions-under-disruption" title="Link to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># The NUTS-2 IDs representing the start and end node of the failed corridor</span>
<span class="n">province1</span> <span class="o">=</span> <span class="s1">&#39;BE22&#39;</span>
<span class="n">province2</span> <span class="o">=</span> <span class="s1">&#39;BE33&#39;</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">edge_removed_graph</span><span class="p">(</span><span class="n">G_fn</span><span class="p">,</span> <span class="n">province1</span><span class="p">,</span> <span class="n">province2</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Function to create a new network graph by removing the edge b/w two NUTS-2 regions</span>
<span class="sd">    ----------</span>
<span class="sd">    G_fn : network-x graph with all roads</span>
<span class="sd">    province1: The NUTS-2 IDs representing the start node of the failed corridor</span>
<span class="sd">    province2: The NUTS-2 IDs representing the end node of the failed corridor</span>
<span class="sd">    </span>
<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    an updated network graph with the edge b/w the nodes of interest removed</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">G_new</span> <span class="o">=</span> <span class="n">G_fn</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
    
    <span class="c1"># The nearest nodes in the network</span>
    <span class="n">node_a</span> <span class="o">=</span> <span class="n">nearest_node</span><span class="p">(</span><span class="n">G_new</span><span class="p">,</span> <span class="n">lon</span><span class="o">=</span><span class="n">nuts_be_point</span><span class="p">[</span><span class="n">nuts_be_point</span><span class="p">[</span><span class="s1">&#39;NUTS_ID&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">province1</span><span class="p">]</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="s1">&#39;x&#39;</span><span class="p">],</span>   <span class="n">lat</span><span class="o">=</span><span class="n">nuts_be_point</span><span class="p">[</span><span class="n">nuts_be_point</span><span class="p">[</span><span class="s1">&#39;NUTS_ID&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">province1</span><span class="p">]</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="s1">&#39;y&#39;</span><span class="p">])</span>
    <span class="n">node_b</span> <span class="o">=</span> <span class="n">nearest_node</span><span class="p">(</span><span class="n">G_new</span><span class="p">,</span> <span class="n">lon</span><span class="o">=</span><span class="n">nuts_be_point</span><span class="p">[</span><span class="n">nuts_be_point</span><span class="p">[</span><span class="s1">&#39;NUTS_ID&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">province2</span><span class="p">]</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="s1">&#39;x&#39;</span><span class="p">],</span>   <span class="n">lat</span><span class="o">=</span><span class="n">nuts_be_point</span><span class="p">[</span><span class="n">nuts_be_point</span><span class="p">[</span><span class="s1">&#39;NUTS_ID&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">province2</span><span class="p">]</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="s1">&#39;y&#39;</span><span class="p">])</span>

    <span class="c1"># Remove the edge</span>
    <span class="n">G_new</span><span class="o">.</span><span class="n">remove_edge</span><span class="p">(</span><span class="n">node_a</span><span class="p">,</span> <span class="n">node_b</span><span class="p">)</span>
    
    <span class="k">return</span> <span class="n">G_new</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Revised graph with failed edge removed</span>
<span class="n">G_nuts_disrupt</span> <span class="o">=</span> <span class="n">edge_removed_graph</span><span class="p">(</span><span class="n">G_nuts</span><span class="p">,</span> <span class="n">province1</span><span class="p">,</span> <span class="n">province2</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<section id="visualising-the-failed-corridor">
<h3>Visualising the failed corridor<a class="headerlink" href="#visualising-the-failed-corridor" title="Link to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span><span class="mi">6</span><span class="p">))</span>

<span class="c1"># Plot the points</span>

<span class="n">nuts_be</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;#9A7AA0&#39;</span><span class="p">,</span>  <span class="n">edgecolor</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="n">zorder</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">alpha</span> <span class="o">=</span> <span class="mf">0.5</span><span class="p">)</span>
<span class="n">nuts_be_point</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="n">markersize</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span> <span class="n">zorder</span> <span class="o">=</span> <span class="mi">4</span><span class="p">)</span>

<span class="c1"># plot it</span>
<span class="n">edges_nuts</span> <span class="o">=</span> <span class="p">[(</span><span class="n">G_nuts</span><span class="p">[</span><span class="n">u</span><span class="p">][</span><span class="n">v</span><span class="p">][</span><span class="s2">&quot;geometry&quot;</span><span class="p">])</span> <span class="k">for</span> <span class="n">u</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">G_nuts</span><span class="o">.</span><span class="n">edges</span><span class="p">()]</span>
<span class="n">edge_gdf_nuts</span> <span class="o">=</span> <span class="n">gpd</span><span class="o">.</span><span class="n">GeoDataFrame</span><span class="p">({</span><span class="s2">&quot;geometry&quot;</span><span class="p">:</span> <span class="n">edges_nuts</span><span class="p">},</span> <span class="n">crs</span><span class="o">=</span><span class="s2">&quot;EPSG:4326&quot;</span><span class="p">)</span>
<span class="n">edge_gdf_nuts</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;r&quot;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">alpha</span> <span class="o">=</span> <span class="mf">0.8</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s2">&quot;-&quot;</span><span class="p">,</span> <span class="n">zorder</span> <span class="o">=</span> <span class="mi">2</span><span class="p">)</span>

<span class="n">edges_nuts_d</span> <span class="o">=</span> <span class="p">[(</span><span class="n">G_nuts_disrupt</span><span class="p">[</span><span class="n">u</span><span class="p">][</span><span class="n">v</span><span class="p">][</span><span class="s2">&quot;geometry&quot;</span><span class="p">])</span> <span class="k">for</span> <span class="n">u</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">G_nuts_disrupt</span><span class="o">.</span><span class="n">edges</span><span class="p">()]</span>
<span class="n">edge_gdf_nuts_d</span> <span class="o">=</span> <span class="n">gpd</span><span class="o">.</span><span class="n">GeoDataFrame</span><span class="p">({</span><span class="s2">&quot;geometry&quot;</span><span class="p">:</span> <span class="n">edges_nuts_d</span><span class="p">},</span> <span class="n">crs</span><span class="o">=</span><span class="s2">&quot;EPSG:4326&quot;</span><span class="p">)</span>
<span class="n">edge_gdf_nuts_d</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;white&quot;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">alpha</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s2">&quot;-&quot;</span><span class="p">,</span> <span class="n">zorder</span> <span class="o">=</span> <span class="mi">3</span><span class="p">)</span>


<span class="n">cx</span><span class="o">.</span><span class="n">add_basemap</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">source</span><span class="o">=</span><span class="n">cx</span><span class="o">.</span><span class="n">providers</span><span class="o">.</span><span class="n">CartoDB</span><span class="o">.</span><span class="n">Positron</span><span class="p">,</span> <span class="n">crs</span><span class="o">=</span><span class="n">nuts_be</span><span class="o">.</span><span class="n">crs</span><span class="p">)</span>

<span class="n">ax</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s1">&#39;off&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../../_images/f95538fe983ec399f9f8fe3132835262819e55df393648db2b88d9bfe7acb5ae.png" src="../../../_images/f95538fe983ec399f9f8fe3132835262819e55df393648db2b88d9bfe7acb5ae.png" />
</div>
</div>
<p>Since a corrdior is removed, the shortest distance b/w some of the regions might increase. Next, we estimate the increased distances b/w the regions.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># An empty dataframe to hold the distance b/w regions after disruption</span>
<span class="n">distance_disrupt</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">index</span> <span class="o">=</span> <span class="n">nuts_ids</span><span class="p">,</span> <span class="n">columns</span> <span class="o">=</span> <span class="n">nuts_ids</span><span class="p">)</span>

<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">nuts_be_point</span><span class="p">)):</span>
    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">nuts_be_point</span><span class="p">)):</span>

        <span class="c1"># NUTS-ID</span>
        <span class="n">nutsid_1</span> <span class="o">=</span> <span class="n">nuts_be_point</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="s1">&#39;NUTS_ID&#39;</span><span class="p">]</span>
        <span class="n">nutsid_2</span> <span class="o">=</span> <span class="n">nuts_be_point</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">j</span><span class="p">,</span> <span class="s1">&#39;NUTS_ID&#39;</span><span class="p">]</span>

        <span class="c1"># Nearest nodes in the network graph</span>
        <span class="n">node_a</span> <span class="o">=</span> <span class="n">nearest_node</span><span class="p">(</span><span class="n">G_nuts_disrupt</span><span class="p">,</span> <span class="n">lon</span><span class="o">=</span><span class="n">nuts_be_point</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="s1">&#39;x&#39;</span><span class="p">],</span>   <span class="n">lat</span><span class="o">=</span><span class="n">nuts_be_point</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="s1">&#39;y&#39;</span><span class="p">])</span>
        <span class="n">node_b</span> <span class="o">=</span> <span class="n">nearest_node</span><span class="p">(</span><span class="n">G_nuts_disrupt</span><span class="p">,</span> <span class="n">lon</span><span class="o">=</span><span class="n">nuts_be_point</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">j</span><span class="p">,</span><span class="s1">&#39;x&#39;</span><span class="p">],</span>   <span class="n">lat</span><span class="o">=</span><span class="n">nuts_be_point</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">j</span><span class="p">,</span><span class="s1">&#39;y&#39;</span><span class="p">])</span>

        <span class="c1"># Distance in km</span>
        <span class="n">dist_km</span> <span class="o">=</span> <span class="n">nx</span><span class="o">.</span><span class="n">shortest_path_length</span><span class="p">(</span><span class="n">G_nuts_disrupt</span><span class="p">,</span> <span class="n">node_a</span><span class="p">,</span> <span class="n">node_b</span><span class="p">,</span> <span class="n">weight</span><span class="o">=</span><span class="s2">&quot;length_m&quot;</span><span class="p">)</span><span class="o">/</span><span class="mi">1000</span>
        <span class="n">distance_disrupt</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">nutsid_1</span><span class="p">,</span> <span class="n">nutsid_2</span><span class="p">]</span> <span class="o">=</span> <span class="n">dist_km</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Increased distance between regions</span>
<span class="n">delta_distance</span> <span class="o">=</span> <span class="n">distance_disrupt</span> <span class="o">-</span> <span class="n">distance_base</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="plotting-a-heatmap-of-increased-distance-between-the-regions">
<h3>Plotting a heatmap of increased distance between the regions<a class="headerlink" href="#plotting-a-heatmap-of-increased-distance-between-the-regions" title="Link to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>

<span class="n">delta_distance</span> <span class="o">=</span> <span class="n">delta_distance</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span>

<span class="n">ax</span> <span class="o">=</span> <span class="n">sns</span><span class="o">.</span><span class="n">heatmap</span><span class="p">(</span>
    <span class="n">delta_distance</span><span class="p">,</span>
    <span class="n">cmap</span><span class="o">=</span><span class="s2">&quot;Blues&quot;</span><span class="p">,</span>
    <span class="n">vmin</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
    <span class="n">vmax</span><span class="o">=</span><span class="mi">200</span><span class="p">,</span>
    <span class="n">square</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">cbar_kws</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;label&quot;</span><span class="p">:</span> <span class="s2">&quot;Distance (km)&quot;</span><span class="p">,</span> <span class="s2">&quot;orientation&quot;</span><span class="p">:</span> <span class="s2">&quot;horizontal&quot;</span><span class="p">,</span><span class="s2">&quot;pad&quot;</span><span class="p">:</span> <span class="mf">0.2</span><span class="p">,</span><span class="s2">&quot;fraction&quot;</span><span class="p">:</span> <span class="mf">0.04</span><span class="p">})</span>

<span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;Increased travel distances b/w Belgium </span><span class="se">\n</span><span class="s2"> NUTS-2 regions&quot;</span><span class="p">,</span> <span class="n">fontsize</span> <span class="o">=</span> <span class="mi">10</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../../_images/3542779e3fa264db9ba74b08e71f92ac53a8821fc880cd7b1b1747b073b16cee.png" src="../../../_images/3542779e3fa264db9ba74b08e71f92ac53a8821fc880cd7b1b1747b073b16cee.png" />
</div>
</div>
</section>
</section>
<section id="input-output-table-aggregation">
<h2>7. Input-Output table aggregation<a class="headerlink" href="#input-output-table-aggregation" title="Link to this heading">#</a></h2>
<p>The IO table above is an aggregated IO table for the NUTS-2 regions of Belgium
The sector ‘p’ represents products i.e., primarily sectors that produces physical goods e.g., agricultural , manufacturing, minining
The sector ‘s’ represent service based sectors
The sector ‘t’ represents the sector of land-transportation (H49 per NACE-2)</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Reading the IO table for Belgium</span>
<span class="n">io</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_excel</span><span class="p">(</span><span class="n">base_path</span> <span class="o">/</span> <span class="s1">&#39;io_belgium.xlsx&#39;</span><span class="p">,</span> <span class="n">index_col</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">],</span> <span class="n">header</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">])</span>
</pre></div>
</div>
</div>
</div>
<p>We aggregate all transporation sectors into one single row (value added by land-trasnport) and single column (final demand for land-trasnport sector)</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Transport value-added</span>
<span class="n">tva</span> <span class="o">=</span> <span class="n">io</span><span class="o">.</span><span class="n">loc</span><span class="p">[(</span> <span class="n">nuts_ids</span><span class="p">,</span><span class="s1">&#39;t&#39;</span><span class="p">),:]</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span>

<span class="c1"># Dropping all &#39;t&#39; sector rows</span>
<span class="n">io</span> <span class="o">=</span> <span class="n">io</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">index</span> <span class="o">=</span><span class="s1">&#39;t&#39;</span><span class="p">,</span> <span class="n">level</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

<span class="c1"># Adding the value-added transport column again</span>
<span class="n">io</span><span class="o">.</span><span class="n">loc</span><span class="p">[(</span><span class="s1">&#39;R&#39;</span><span class="p">,</span><span class="s1">&#39;VA_t&#39;</span><span class="p">),</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">tva</span>

<span class="c1"># Transport final demands</span>
<span class="n">tfd</span> <span class="o">=</span> <span class="n">io</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,(</span> <span class="n">nuts_ids</span><span class="p">,</span><span class="s1">&#39;t&#39;</span><span class="p">)]</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span>

<span class="c1"># Dropping all &#39;t&#39; sector columns</span>
<span class="n">io</span> <span class="o">=</span> <span class="n">io</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span> <span class="o">=</span><span class="s1">&#39;t&#39;</span><span class="p">,</span> <span class="n">level</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

<span class="c1"># Adding the value-added transport column again</span>
<span class="n">io</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="p">(</span><span class="s1">&#39;R&#39;</span><span class="p">,</span><span class="s1">&#39;FD_t&#39;</span><span class="p">)]</span> <span class="o">=</span> <span class="n">tfd</span>
</pre></div>
</div>
</div>
</div>
<p>IO check - Sum of rows (Output) equals sum of columns (Outlays)</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">io_check</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;rowsum&#39;</span><span class="p">,</span> <span class="s1">&#39;colsum&#39;</span><span class="p">])</span>

<span class="n">io_check</span><span class="p">[</span><span class="s1">&#39;rowsum&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">io</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span>
<span class="n">io_check</span><span class="p">[</span><span class="s1">&#39;colsum&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">io</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span>

<span class="n">io_check</span><span class="p">[</span><span class="s1">&#39;diff&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">io_check</span><span class="p">[</span><span class="s1">&#39;rowsum&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">io_check</span><span class="p">[</span><span class="s1">&#39;colsum&#39;</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Converting annaul IO flows to daily flows</span>
<span class="n">io_daily</span> <span class="o">=</span> <span class="n">io</span><span class="o">/</span><span class="mi">365</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="system-level-economic-effects">
<h2>8. System-level economic effects<a class="headerlink" href="#system-level-economic-effects" title="Link to this heading">#</a></h2>
<p>The increased travel distance between the origin and desinations primarily propagates into the economy via (a) Shortage effect - Products not available in time for continued production activities and (b) Price effect - The price of goods increases due to increased distances for tranporting goods from one region to other.</p>
<p>For this example, the delays caused by the corridor failure is in hours, primarily because of smaller geography and more re-reouting options available. Hence, we donot consider the shortage effects. However, shortage effects can be crucial when regions are inaccessible or delays are signifcantly large as in case of Suez canal blockage.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">io</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead tr th {
        text-align: left;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr>
      <th></th>
      <th>r</th>
      <th colspan="2" halign="left">BE10</th>
      <th colspan="2" halign="left">BE21</th>
      <th colspan="2" halign="left">BE22</th>
      <th colspan="2" halign="left">BE23</th>
      <th colspan="2" halign="left">BE24</th>
      <th>...</th>
      <th>BE32</th>
      <th colspan="2" halign="left">BE33</th>
      <th colspan="2" halign="left">BE34</th>
      <th colspan="2" halign="left">BE35</th>
      <th colspan="3" halign="left">R</th>
    </tr>
    <tr>
      <th></th>
      <th>sd</th>
      <th>p</th>
      <th>s</th>
      <th>p</th>
      <th>s</th>
      <th>p</th>
      <th>s</th>
      <th>p</th>
      <th>s</th>
      <th>p</th>
      <th>s</th>
      <th>...</th>
      <th>s</th>
      <th>p</th>
      <th>s</th>
      <th>p</th>
      <th>s</th>
      <th>p</th>
      <th>s</th>
      <th>FD</th>
      <th>exp</th>
      <th>FD_t</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th rowspan="2" valign="top">BE10</th>
      <th>p</th>
      <td>52.797997</td>
      <td>169.068634</td>
      <td>130.508057</td>
      <td>92.403465</td>
      <td>60.889435</td>
      <td>43.626633</td>
      <td>114.656288</td>
      <td>68.264587</td>
      <td>41.833893</td>
      <td>73.736481</td>
      <td>...</td>
      <td>55.379299</td>
      <td>62.748283</td>
      <td>55.710030</td>
      <td>15.259095</td>
      <td>11.886464</td>
      <td>17.164982</td>
      <td>24.522854</td>
      <td>3790.647461</td>
      <td>3332.961182</td>
      <td>62.699004</td>
    </tr>
    <tr>
      <th>s</th>
      <td>810.859680</td>
      <td>26420.080078</td>
      <td>2388.069580</td>
      <td>6036.488770</td>
      <td>309.333832</td>
      <td>1215.953979</td>
      <td>602.770935</td>
      <td>2433.725098</td>
      <td>175.310715</td>
      <td>2581.921387</td>
      <td>...</td>
      <td>2333.582031</td>
      <td>684.252686</td>
      <td>2161.123779</td>
      <td>82.515457</td>
      <td>324.608032</td>
      <td>103.369423</td>
      <td>697.338135</td>
      <td>52434.562500</td>
      <td>15736.668945</td>
      <td>1696.505419</td>
    </tr>
    <tr>
      <th rowspan="2" valign="top">BE21</th>
      <th>p</th>
      <td>762.007507</td>
      <td>1893.024658</td>
      <td>12033.195312</td>
      <td>3364.795166</td>
      <td>1763.075195</td>
      <td>811.292114</td>
      <td>3706.054443</td>
      <td>1643.714111</td>
      <td>1364.426636</td>
      <td>1704.064941</td>
      <td>...</td>
      <td>761.455383</td>
      <td>1583.401855</td>
      <td>895.615173</td>
      <td>132.257812</td>
      <td>76.832603</td>
      <td>138.379105</td>
      <td>157.111465</td>
      <td>28321.802734</td>
      <td>17103.281250</td>
      <td>1462.361204</td>
    </tr>
    <tr>
      <th>s</th>
      <td>477.225769</td>
      <td>4812.578125</td>
      <td>9982.744141</td>
      <td>18079.138672</td>
      <td>574.655457</td>
      <td>1236.322388</td>
      <td>929.046265</td>
      <td>1922.102295</td>
      <td>177.873260</td>
      <td>1763.003174</td>
      <td>...</td>
      <td>1423.620117</td>
      <td>352.594543</td>
      <td>1417.108643</td>
      <td>37.778591</td>
      <td>226.722488</td>
      <td>51.961910</td>
      <td>533.839539</td>
      <td>51692.222656</td>
      <td>4190.382812</td>
      <td>2383.296903</td>
    </tr>
    <tr>
      <th>BE22</th>
      <th>p</th>
      <td>79.502617</td>
      <td>211.340836</td>
      <td>450.302429</td>
      <td>304.396393</td>
      <td>264.505524</td>
      <td>238.780060</td>
      <td>394.414520</td>
      <td>264.914520</td>
      <td>181.066040</td>
      <td>175.944626</td>
      <td>...</td>
      <td>175.418854</td>
      <td>256.165588</td>
      <td>185.833847</td>
      <td>32.977226</td>
      <td>22.460728</td>
      <td>45.922188</td>
      <td>46.857548</td>
      <td>5869.531738</td>
      <td>6200.022949</td>
      <td>59.759147</td>
    </tr>
  </tbody>
</table>
<p>5 rows × 25 columns</p>
</div></div></div>
</div>
<p>Preparing arrays for Input-Ouput analysis</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Intermediate consumption</span>
<span class="n">Z</span> <span class="o">=</span> <span class="n">io_daily</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">io</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">get_level_values</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="o">!=</span> <span class="s1">&#39;R&#39;</span><span class="p">,</span> <span class="n">io</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">get_level_values</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="o">!=</span> <span class="s1">&#39;R&#39;</span><span class="p">]</span>

<span class="c1"># Final consumption</span>
<span class="n">fd</span> <span class="o">=</span> <span class="p">(</span><span class="n">io_daily</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">io</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">get_level_values</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="o">!=</span> <span class="s1">&#39;R&#39;</span><span class="p">,</span> <span class="n">io</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">get_level_values</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="o">==</span> <span class="s1">&#39;R&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">to_frame</span><span class="p">(</span><span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;FD&#39;</span><span class="p">))</span>

<span class="c1"># Output = Intermediate consumption + Final consumption</span>
<span class="n">x</span> <span class="o">=</span> <span class="p">(</span><span class="n">Z</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="n">fd</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">))</span><span class="o">.</span><span class="n">to_frame</span><span class="p">(</span><span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;x&#39;</span><span class="p">)</span>

<span class="c1"># Technical coefficients</span>
<span class="n">A</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">index</span> <span class="o">=</span> <span class="n">Z</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">columns</span> <span class="o">=</span> <span class="n">Z</span><span class="o">.</span><span class="n">columns</span><span class="p">,</span> <span class="n">dtype</span> <span class="o">=</span> <span class="s1">&#39;float64&#39;</span><span class="p">)</span>

<span class="c1"># Calculating technical coefficients</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">)):</span>
    <span class="n">A</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">Z</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,</span><span class="n">i</span><span class="p">]</span> <span class="o">/</span> <span class="n">x</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span>

<span class="c1"># Flattening final demand and Ouptu arrays</span>
<span class="n">fd_array</span> <span class="o">=</span><span class="n">fd</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
<span class="n">x_array</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>

<span class="c1"># Converting dataframe to numpy array</span>
<span class="n">A_array</span> <span class="o">=</span> <span class="n">A</span><span class="o">.</span><span class="n">values</span>

<span class="c1"># Value added array</span>
<span class="c1"># This is vector equals the shape number of sectors (11 regions x 2 sectors) , number of va categories</span>
<span class="c1"># We have three VA categories VA, Imports and VA by land tranport</span>

<span class="n">va</span> <span class="o">=</span> <span class="n">io_daily</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">io</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">get_level_values</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="o">==</span> <span class="s1">&#39;R&#39;</span><span class="p">,</span> <span class="n">io</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">get_level_values</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="o">!=</span> <span class="s1">&#39;R&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">T</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">()</span>

<span class="c1"># Dividing the va columns with output to determine va to output ratio for each category</span>
<span class="n">va_x</span> <span class="o">=</span> <span class="n">va</span><span class="o">/</span><span class="n">x_array</span><span class="p">[:,</span><span class="kc">None</span><span class="p">]</span>

<span class="c1"># Sum across the ratio to determine the total va to output ratio</span>
<span class="n">va_x_sum</span> <span class="o">=</span> <span class="n">va_x</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span> <span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Due to the increased travel distance between the NUTS-2 regions, the logistical costs of inputs increase.
As a result, the price of outputs produced also increase. This can be quantified using Cost-Push IO model or the Leontief price model.
Further, consumers reduce consumption due to higher prices.
Reduced consumption also leads to reduced production upstream</p>
<p>Cost-push IO model is given by prices = (leontief inverse)’ x (va/x). Refer Miller&amp;Blair(2009), Chapter 2 for more details.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#Leontief inverse</span>
<span class="n">leontief_inverse</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">inv</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">eye</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">x_array</span><span class="p">))</span> <span class="o">-</span> <span class="n">A_array</span><span class="p">)</span>

<span class="c1"># Leontief inverse transpose</span>
<span class="n">leontief_inv_trans</span> <span class="o">=</span>  <span class="n">np</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="n">leontief_inverse</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Calculating base prices i.e., unit vector check</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Base prices</span>
<span class="n">base_price</span> <span class="o">=</span> <span class="n">leontief_inv_trans</span><span class="o">@</span> <span class="n">va_x_sum</span> 
<span class="n">base_price</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([1.00000001, 1.00000003, 1.00000001, 1.00000001, 0.99999998,
       1.00000003, 0.99999995, 1.00000004, 0.99999997, 1.00000003,
       0.99999997, 0.99999998, 1.        , 1.00000003, 1.00000002,
       0.99999998, 1.        , 1.00000002, 1.00000003, 0.99999996,
       1.00000001, 0.99999998])
</pre></div>
</div>
</div>
</div>
<p>We estimate the ratio of increased distance b/w pre and post disruption across nuts-2 regions.  1 indicates the flow is unaffected by the dirsuption.
Next, we calculate the flow weighted increase of this multiplier only for the product sectors. This multipler is then used to increase the value added cost and the new prices are estimated.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Ratio of distance travelled in the disrupted scenario to the disatnce travelled in the baseline scenario</span>
<span class="n">ratio_dist_disrupt</span> <span class="o">=</span> <span class="n">distance_disrupt</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="n">distance_base</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>

<span class="c1"># product flows</span>
<span class="n">p_flow</span> <span class="o">=</span> <span class="n">io_daily</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">io</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">get_level_values</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">==</span> <span class="s1">&#39;p&#39;</span><span class="p">,</span> <span class="n">io</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">get_level_values</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">==</span> <span class="s1">&#39;p&#39;</span><span class="p">]</span>

<span class="n">p_flow</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="n">p_flow</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">droplevel</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="n">p_flow</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="n">p_flow</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">droplevel</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

<span class="c1">#### Weighted ratios</span>
<span class="n">ratio_p_weighted</span> <span class="o">=</span> <span class="n">ratio_dist_disrupt</span><span class="o">*</span><span class="n">p_flow</span>

<span class="c1">#### Divide the flows</span>
<span class="n">va_t_multiplier</span> <span class="o">=</span> <span class="p">(</span><span class="n">ratio_p_weighted</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="o">/</span> <span class="n">p_flow</span><span class="o">.</span><span class="n">sum</span><span class="p">())</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<p>We assume price shocks affect product sectors and not service secotrs. Service economic flows have less dependence on physical tranport networks compared to products.</p>
<p>Now, we estimate the increased prices</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Initialsiing a zero array to the length of all sectors</span>
<span class="n">price_shock</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">va_t_multiplier</span><span class="p">)</span><span class="o">*</span><span class="mi">2</span><span class="p">)</span>

<span class="c1"># Price shocks only to the product sector</span>
<span class="n">price_shock</span><span class="p">[::</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">va_t_multiplier</span>

<span class="c1"># Price shock is multiplied to the third column of value added which is the cost w.r.t to transport</span>
<span class="n">va_x_revised</span> <span class="o">=</span> <span class="n">va_x</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="n">va_x_revised</span><span class="p">[:,</span><span class="mi">2</span><span class="p">]</span> <span class="o">*=</span> <span class="n">price_shock</span>

<span class="c1"># Revised va_x_sum</span>
<span class="n">va_x_sum_revised</span> <span class="o">=</span> <span class="n">va_x_revised</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span> <span class="o">=</span><span class="mi">1</span><span class="p">)</span>

<span class="c1"># Increased prices</span>
<span class="n">increased_price</span> <span class="o">=</span> <span class="n">leontief_inv_trans</span><span class="o">@</span> <span class="n">va_x_sum_revised</span>
<span class="n">increased_price</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([1.00032725, 1.00006146, 1.00059645, 1.00008757, 1.00367501,
       1.00011536, 1.00040745, 1.00008718, 1.00040482, 1.00006862,
       1.00029563, 1.00009899, 1.000152  , 1.0000796 , 1.00031723,
       1.00009421, 1.00967718, 1.00012152, 1.00101725, 1.00008446,
       1.00027853, 1.00009101])
</pre></div>
</div>
</div>
</div>
<p>The increased prices are translated to corresponding reduction in consumption.  We assume that the demand curve follows dP/dQ = -1  i.e., dP increase in price will lead to dQ decrease in quantity. FD_price_effect = (FD_BASE x -dP)+FD_BASE</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># final demands corrected for price effect</span>
<span class="n">fd_price</span> <span class="o">=</span> <span class="p">(</span><span class="n">fd_array</span><span class="o">*</span><span class="p">(</span><span class="n">increased_price</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">*-</span><span class="mi">1</span><span class="p">)</span><span class="o">+</span><span class="n">fd_array</span>
</pre></div>
</div>
</div>
</div>
<p>Finally, we estimate the new production (or output) required for the reduced demand using a Leontief IO (quantity model)</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># X = L-1 x fd</span>
<span class="n">x_price</span> <span class="o">=</span> <span class="n">leontief_inverse</span><span class="nd">@fd_price</span>

<span class="c1"># Reduction in output</span>
<span class="n">del_x_price</span> <span class="o">=</span> <span class="n">x_array</span> <span class="o">-</span> <span class="n">x_price</span>

<span class="c1"># Creating a new column in the output dataframe</span>
<span class="n">x</span><span class="p">[</span><span class="s1">&#39;output_loss&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">del_x_price</span>

<span class="c1"># Aggregation regioanlly</span>
<span class="n">x_groupued</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">level</span> <span class="o">=</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>

<span class="c1"># Merging it to the geodataframe</span>
<span class="n">nuts_be_region</span> <span class="o">=</span> <span class="n">nuts_be</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s1">&#39;NUTS_ID&#39;</span><span class="p">)</span>
<span class="n">nuts_price</span> <span class="o">=</span> <span class="n">gpd</span><span class="o">.</span><span class="n">GeoDataFrame</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">x_groupued</span><span class="p">,</span> <span class="n">nuts_be_region</span> <span class="p">,</span> <span class="n">how</span> <span class="o">=</span> <span class="s1">&#39;inner&#39;</span><span class="p">,</span> <span class="n">left_index</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">right_index</span> <span class="o">=</span> <span class="kc">True</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">total_output_loss</span> <span class="o">=</span> <span class="n">nuts_price</span><span class="o">.</span><span class="n">output_loss</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<section id="results-visualisation">
<h3>Results visualisation<a class="headerlink" href="#results-visualisation" title="Link to this heading">#</a></h3>
<p>Now, we plot the production decrease in each NUTS-2 region of Belgium.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span><span class="mi">8</span><span class="p">))</span>

<span class="c1"># Plot the points</span>
<span class="n">cmap</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">Purples</span>
<span class="n">norm</span> <span class="o">=</span> <span class="n">mpl</span><span class="o">.</span><span class="n">colors</span><span class="o">.</span><span class="n">Normalize</span><span class="p">(</span><span class="n">vmin</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">vmax</span> <span class="o">=</span> <span class="n">nuts_price</span><span class="o">.</span><span class="n">output_loss</span><span class="o">.</span><span class="n">max</span><span class="p">())</span>

<span class="c1"># The nuts dataframe which also contains the information about output loss in the region</span>
<span class="n">nuts_price</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span> <span class="o">=</span> <span class="n">ax</span><span class="p">,</span> <span class="n">column</span> <span class="o">=</span> <span class="s1">&#39;output_loss&#39;</span><span class="p">,</span> <span class="n">cmap</span> <span class="o">=</span> <span class="n">cmap</span><span class="p">,</span> <span class="n">norm</span> <span class="o">=</span> <span class="n">norm</span><span class="p">)</span>
<span class="n">nuts_be_point</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="n">markersize</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span> <span class="n">zorder</span> <span class="o">=</span> <span class="mi">4</span><span class="p">)</span>

<span class="c1"># Plotting the failed raod</span>
<span class="n">edges_nuts</span> <span class="o">=</span> <span class="p">[(</span><span class="n">G_nuts</span><span class="p">[</span><span class="n">u</span><span class="p">][</span><span class="n">v</span><span class="p">][</span><span class="s2">&quot;geometry&quot;</span><span class="p">])</span> <span class="k">for</span> <span class="n">u</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">G_nuts</span><span class="o">.</span><span class="n">edges</span><span class="p">()]</span>
<span class="n">edge_gdf_nuts</span> <span class="o">=</span> <span class="n">gpd</span><span class="o">.</span><span class="n">GeoDataFrame</span><span class="p">({</span><span class="s2">&quot;geometry&quot;</span><span class="p">:</span> <span class="n">edges_nuts</span><span class="p">},</span> <span class="n">crs</span><span class="o">=</span><span class="s2">&quot;EPSG:4326&quot;</span><span class="p">)</span>
<span class="n">edge_gdf_nuts</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;r&quot;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">alpha</span> <span class="o">=</span> <span class="mf">0.8</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s2">&quot;-&quot;</span><span class="p">,</span> <span class="n">zorder</span> <span class="o">=</span> <span class="mi">2</span><span class="p">)</span>

<span class="c1"># Plotting other roads</span>
<span class="n">edges_nuts_d</span> <span class="o">=</span> <span class="p">[(</span><span class="n">G_nuts_disrupt</span><span class="p">[</span><span class="n">u</span><span class="p">][</span><span class="n">v</span><span class="p">][</span><span class="s2">&quot;geometry&quot;</span><span class="p">])</span> <span class="k">for</span> <span class="n">u</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">G_nuts_disrupt</span><span class="o">.</span><span class="n">edges</span><span class="p">()]</span>
<span class="n">edge_gdf_nuts_d</span> <span class="o">=</span> <span class="n">gpd</span><span class="o">.</span><span class="n">GeoDataFrame</span><span class="p">({</span><span class="s2">&quot;geometry&quot;</span><span class="p">:</span> <span class="n">edges_nuts_d</span><span class="p">},</span> <span class="n">crs</span><span class="o">=</span><span class="s2">&quot;EPSG:4326&quot;</span><span class="p">)</span>
<span class="n">edge_gdf_nuts_d</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;white&quot;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">alpha</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s2">&quot;-&quot;</span><span class="p">,</span> <span class="n">zorder</span> <span class="o">=</span> <span class="mi">3</span><span class="p">)</span>

<span class="c1"># A text box to indicate total loss</span>
<span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mf">0.02</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;Total output loss = </span><span class="si">{</span><span class="n">total_output_loss</span><span class="si">:</span><span class="s1">.2f</span><span class="si">}</span><span class="s1"> million € per day&#39;</span><span class="p">,</span> <span class="n">transform</span><span class="o">=</span><span class="n">ax</span><span class="o">.</span><span class="n">transAxes</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">verticalalignment</span><span class="o">=</span><span class="s1">&#39;top&#39;</span><span class="p">,</span><span class="n">zorder</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>

<span class="n">cx</span><span class="o">.</span><span class="n">add_basemap</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">source</span><span class="o">=</span><span class="n">cx</span><span class="o">.</span><span class="n">providers</span><span class="o">.</span><span class="n">CartoDB</span><span class="o">.</span><span class="n">Positron</span><span class="p">,</span> <span class="n">crs</span><span class="o">=</span><span class="n">nuts_be</span><span class="o">.</span><span class="n">crs</span><span class="p">)</span>

<span class="n">sm</span> <span class="o">=</span> <span class="n">mpl</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">ScalarMappable</span><span class="p">(</span><span class="n">norm</span><span class="o">=</span><span class="n">norm</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">cmap</span><span class="p">)</span>
<span class="n">sm</span><span class="o">.</span><span class="n">set_array</span><span class="p">([])</span>

<span class="n">cbar</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">sm</span><span class="p">,</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span><span class="n">orientation</span><span class="o">=</span><span class="s1">&#39;horizontal&#39;</span><span class="p">,</span><span class="n">fraction</span><span class="o">=</span><span class="mf">0.025</span><span class="p">,</span>   <span class="n">pad</span><span class="o">=</span><span class="mf">0.04</span><span class="p">)</span>
<span class="n">cbar</span><span class="o">.</span><span class="n">set_label</span><span class="p">(</span><span class="s1">&#39;Output Impact (in million € per day)&#39;</span><span class="p">)</span>

<span class="n">ax</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s1">&#39;off&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">outpath</span><span class="p">,</span> <span class="s2">&quot;systemic_impact.png&quot;</span><span class="p">),</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">300</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../../_images/cc3848c78704007208273b2f08a8566843252d45275ff03592c8e47418e8b37a.png" src="../../../_images/cc3848c78704007208273b2f08a8566843252d45275ff03592c8e47418e8b37a.png" />
</div>
</div>
</section>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./riskassessment/Systemic-Economic-Impact/book"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                </article>
              

              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="../../AssetRiskModelling/book/risk_assessment_belgium.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">Climate risk assessment for transport infrastructure</p>
      </div>
    </a>
    <a class="right-next"
       href="../../../usecases/introduction.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Introduction to the Use Cases</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <dialog id="pst-secondary-sidebar-modal"></dialog>
                <div id="pst-secondary-sidebar" class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#loading-the-required-packages-and-path-directories">1. Loading the required Packages and path directories</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#loading-the-data">2. Loading the Data</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#visualising-the-nuts-2-belgium-regions">Visualising the NUTS-2 Belgium regions</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#creating-a-points-dataframe">Creating a points dataframe</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#build-a-network-graph-of-the-roads">3. Build a network graph of the roads</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#plotting-the-road-network-of-belgium">4. Plotting the road network of belgium</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#baseline-distance-between-the-regions">5. Baseline distance between the regions</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#plotting-a-heatmap-of-distances-b-w-the-regions">Plotting a heatmap of distances b/w the regions</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#distance-between-the-regions-under-disruption">6. Distance between the regions under disruption</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#visualising-the-failed-corridor">Visualising the failed corridor</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#plotting-a-heatmap-of-increased-distance-between-the-regions">Plotting a heatmap of increased distance between the regions</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#input-output-table-aggregation">7. Input-Output table aggregation</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#system-level-economic-effects">8. System-level economic effects</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#results-visualisation">Results visualisation</a></li>
</ul>
</li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By MIRACA
</p>

  </div>
  
  <div class="footer-item">
    

  <p class="copyright">
    
      © Copyright 2023.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script defer src="../../../_static/scripts/bootstrap.js?digest=8878045cc6db502f8baf"></script>
<script defer src="../../../_static/scripts/pydata-sphinx-theme.js?digest=8878045cc6db502f8baf"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>