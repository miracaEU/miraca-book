
<!DOCTYPE html>


<html lang="en" data-content_root="../../../" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Adaptation of CI - A multi-level approach &#8212; MIRACA Technical Workbench</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  <!--
    this give us a css class that will be invisible only if js is disabled
  -->
  <noscript>
    <style>
      .pst-js-only { display: none !important; }

    </style>
  </noscript>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../../../_static/styles/theme.css?digest=8878045cc6db502f8baf" rel="stylesheet" />
<link href="../../../_static/styles/pydata-sphinx-theme.css?digest=8878045cc6db502f8baf" rel="stylesheet" />

    <link rel="stylesheet" type="text/css" href="../../../_static/pygments.css?v=03e43079" />
    <link rel="stylesheet" type="text/css" href="../../../_static/styles/sphinx-book-theme.css?v=eba8b062" />
    <link rel="stylesheet" type="text/css" href="../../../_static/togglebutton.css?v=13237357" />
    <link rel="stylesheet" type="text/css" href="../../../_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="../../../_static/mystnb.8ecb98da25f57f5357bf6f572d296f466b2cfe2517ffebfabe82451661e28f02.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/sphinx-thebe.css?v=4fa983c6" />
    <link rel="stylesheet" type="text/css" href="../../../_static/sphinx-design.min.css?v=95c83b7e" />
  
  <!-- So that users can add custom icons -->
  <script src="../../../_static/scripts/fontawesome.js?digest=8878045cc6db502f8baf"></script>
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../../../_static/scripts/bootstrap.js?digest=8878045cc6db502f8baf" />
<link rel="preload" as="script" href="../../../_static/scripts/pydata-sphinx-theme.js?digest=8878045cc6db502f8baf" />

    <script src="../../../_static/documentation_options.js?v=9eb32ce0"></script>
    <script src="../../../_static/doctools.js?v=9a2dae69"></script>
    <script src="../../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../../_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="../../../_static/copybutton.js?v=f281be69"></script>
    <script src="../../../_static/scripts/sphinx-book-theme.js?v=887ef09a"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../../../_static/togglebutton.js?v=4a39c7ea"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="../../../_static/design-tabs.js?v=f930bc37"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script async="async" src="../../../_static/sphinx-thebe.js?v=c100c467"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'background/AdaptationModelling/book/04_results_summary';</script>
    <link rel="author" title="About these documents" href="../../../about.html" />
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
    <link rel="next" title="About Miraca" href="../../../about.html" />
    <link rel="prev" title="Adaptation of CI - A multi-level approach" href="03_batch_process_adaptations.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  <meta name="docsearch:version" content="" />
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <dialog id="pst-search-dialog">
    
<form class="bd-search d-flex align-items-center"
      action="../../../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form>
  </dialog>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <dialog id="pst-primary-sidebar-modal"></dialog>
      <div id="pst-primary-sidebar" class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">

  
    
  

<a class="navbar-brand logo" href="../../../intro.html">
  
  
  
  
  
    
    
      
    
    
    <img src="../../../_static/logo.png" class="logo__image only-light" alt="MIRACA Technical Workbench - Home"/>
    <img src="../../../_static/logo.png" class="logo__image only-dark pst-js-only" alt="MIRACA Technical Workbench - Home"/>
  
  
</a></div>
        <div class="sidebar-primary-item">

<button class="btn search-button-field search-button__button pst-js-only" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
 <i class="fa-solid fa-magnifying-glass"></i>
 <span class="search-button__default-text">Search</span>
 <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
</button></div>
        <div class="sidebar-primary-item"><nav class="bd-links bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="../../../intro.html">
                    Welcome to the Miraca Book
                </a>
            </li>
        </ul>
        <p aria-level="2" class="caption" role="heading"><span class="caption-text">The Miraca approach</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../../../riskassessment/miraca_approach.html">Description of the framework</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../../riskassessment/example.html">Example: Belgium road infrastructure</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../riskassessment/AssetRiskModelling/book/risk_assessment_belgium.html">Climate Risk Assessment</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../riskassessment/Systemic-Economic-Impact/book/systemic_impacts_belgium.html">Systemic Economic impacts</a></li>
</ul>
</details></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Use Cases</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../../../usecases/introduction.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../placeholder1.html">Use Case 1 - Flooding and windstorms in the TEN-T corridor</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../placeholder2.html">Use Case 2 - Wildfires in Catalonia</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../usecases/UC3/book/Use_Case_template.html">Use case 3 - Flooding in Zuid-Holland</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../usecases/UC4/book/E_E%2BL_ESRM20%2BElsus.html">Use Case 4 - Landslides &amp; Earthquake in Greece</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../usecases/UC5/Use_Case_5_v1.html">Use Case 5 - Energy</a></li>




</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Technical background</span></p>
<ul class="current nav bd-sidenav">
<li class="toctree-l1 has-children"><a class="reference internal" href="../../Exposure_Miraca/book/intro.html">Exposure database</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../../Exposure_Miraca/book/Exposure_Miraca.html">Exposure database</a></li>
</ul>
</details></li>
<li class="toctree-l1"><a class="reference internal" href="../../Vulnerability/book/Vulnerability_workbench.html">Vulnerability database</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../RoadFlowModelling/book/miraca_roads.html">Network modelling</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../CBAmodelling/book/miraca_cba.html">Cost-benefit analysis</a></li>
<li class="toctree-l1 current active has-children"><a class="reference internal" href="01_direct_damages_baseline.html">Adaptation strategies to Critical Infrastructure</a><details open="open"><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="02_indirect_damages_baseline.html">Adaptation of CI - A multi-level approach</a></li>
<li class="toctree-l2"><a class="reference internal" href="03_batch_process_adaptations.html">Adaptation of CI - A multi-level approach</a></li>
<li class="toctree-l2 current active"><a class="current reference internal" href="#">Adaptation of CI - A multi-level approach</a></li>
</ul>
</details></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">About</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../../../about.html">About Miraca</a></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
      <div class="sidebar-primary-item">
<div id="ethical-ad-placement"
      class="flat"
      data-ea-publisher="readthedocs"
      data-ea-type="readthedocs-sidebar"
      data-ea-manual="true">
</div></div>
  </div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><button class="sidebar-toggle primary-toggle btn btn-sm" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</button></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-source-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Source repositories">
    <i class="fab fa-github"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://github.com/miracaEU/miraca-book" target="_blank"
   class="btn btn-sm btn-source-repository-button dropdown-item"
   title="Source repository"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="btn__text-container">Repository</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/miracaEU/miraca-book/issues/new?title=Issue%20on%20page%20%2Fbackground/AdaptationModelling/book/04_results_summary.html&body=Your%20issue%20content%20here." target="_blank"
   class="btn btn-sm btn-source-issues-button dropdown-item"
   title="Open an issue"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="btn__text-container">Open issue</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="../../../_sources/background/AdaptationModelling/book/04_results_summary.ipynb" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.ipynb</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button pst-js-only" aria-label="Color mode" data-bs-title="Color mode"  data-bs-placement="bottom" data-bs-toggle="tooltip">
  <i class="theme-switch fa-solid fa-sun                fa-lg" data-mode="light" title="Light"></i>
  <i class="theme-switch fa-solid fa-moon               fa-lg" data-mode="dark"  title="Dark"></i>
  <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"  title="System Settings"></i>
</button>


<button class="btn btn-sm pst-navbar-icon search-button search-button__button pst-js-only" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
</button>

</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Adaptation of CI - A multi-level approach</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section id="adaptation-of-ci-a-multi-level-approach">
<h1>Adaptation of CI - A multi-level approach<a class="headerlink" href="#adaptation-of-ci-a-multi-level-approach" title="Link to this heading">#</a></h1>
<p>In this example we demonstrate how adaptations of different levels (hazard-, asset-, network- and system-level) can be appraised based on their cost of adaptation, risk, and benefits of adaptation. This notebook covers the calculation of future risk and future risk discounting, adaptation maintenance costs, benefit discounting and benefit to cost ratios.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">os</span>
<span class="c1"># os.chdir(&#39;path/to/book/directory&#39;)</span>
<span class="c1"># os.chdir(&#39;..&#39;)</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">src.ci_adapt_utilities</span><span class="w"> </span><span class="kn">import</span> <span class="o">*</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.pyplot</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">plt</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">math</span> 

<span class="n">data_path</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">()</span> <span class="o">+</span> <span class="s1">&#39;/data&#39;</span><span class="p">)</span>
<span class="n">interim_data_path</span> <span class="o">=</span> <span class="n">data_path</span> <span class="o">/</span> <span class="s1">&#39;interim&#39;</span> <span class="o">/</span> <span class="s1">&#39;collected_flood_runs&#39;</span>
</pre></div>
</div>
</div>
</div>
<p>Load default configuration and model parameters</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">config_file</span><span class="o">=</span><span class="n">Path</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">()</span> <span class="o">+</span> <span class="s1">&#39;/config_ci_adapt_test.ini&#39;</span><span class="p">)</span>
<span class="n">hazard_type</span><span class="p">,</span> <span class="n">infra_type</span><span class="p">,</span> <span class="n">country_code</span><span class="p">,</span> <span class="n">country_name</span><span class="p">,</span> <span class="n">hazard_data_subfolders</span><span class="p">,</span> <span class="n">asset_data</span><span class="p">,</span> <span class="n">vulnerability_data</span> <span class="o">=</span> <span class="n">load_config</span><span class="p">(</span><span class="n">config_file</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Define paths for adaptations, basins, and region (for visualisation)</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">adaptations_df_dir</span> <span class="o">=</span> <span class="n">data_path</span> <span class="o">/</span> <span class="s1">&#39;interim&#39;</span> <span class="o">/</span> <span class="s1">&#39;adaptations&#39;</span>
<span class="n">basins_path</span> <span class="o">=</span> <span class="n">data_path</span> <span class="o">/</span> <span class="s1">&#39;Floods&#39;</span> <span class="o">/</span> <span class="s1">&#39;basins&#39;</span> <span class="o">/</span> <span class="s1">&#39;hybas_eu_lev01-12_v1c&#39;</span> <span class="o">/</span> <span class="s1">&#39;hybas_eu_lev08_v1c_valid.shp&#39;</span>
<span class="n">regions_path</span> <span class="o">=</span> <span class="n">data_path</span> <span class="o">/</span> <span class="sa">r</span><span class="s1">&#39;visualisation\rhineland_palatinate.geojson&#39;</span>

<span class="n">regions_gdf</span> <span class="o">=</span> <span class="n">gpd</span><span class="o">.</span><span class="n">read_file</span><span class="p">(</span><span class="n">regions_path</span><span class="p">)</span>
<span class="n">basins_gdf_0</span> <span class="o">=</span> <span class="n">load_basins_in_region</span><span class="p">(</span><span class="n">basins_path</span><span class="p">,</span> <span class="n">regions_path</span><span class="p">,</span> <span class="n">clipping</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">basin_list_tributaries</span><span class="p">,</span> <span class="n">basin_list_full_flood</span> <span class="o">=</span> <span class="n">find_basin_lists</span><span class="p">(</span><span class="n">basins_gdf_0</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Load asset data, adaptation cost data, and results from baseline (no adaptation) risk and adapted risk (with adaptations)</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">assets</span><span class="p">,</span> <span class="n">geom_dict</span><span class="p">,</span> <span class="n">miraca_colors</span><span class="p">,</span> <span class="n">return_period_dict</span><span class="p">,</span> <span class="n">adaptation_unit_costs</span><span class="p">,</span> <span class="n">rp_spec_priority</span><span class="p">,</span> <span class="n">average_road_cost_per_ton_km</span><span class="p">,</span> <span class="n">average_train_cost_per_ton_km</span><span class="p">,</span> <span class="n">average_train_load_tons</span> <span class="o">=</span> <span class="n">startup_ci_adapt</span><span class="p">(</span><span class="n">data_path</span><span class="p">,</span> <span class="n">config_file</span><span class="p">,</span> <span class="n">interim_data_path</span><span class="p">)</span>
<span class="n">shortest_paths</span><span class="p">,</span> <span class="n">disrupted_edges_by_basin</span><span class="p">,</span> <span class="n">graph_r0</span><span class="p">,</span> <span class="n">disrupted_shortest_paths</span><span class="p">,</span> <span class="n">event_impacts</span><span class="p">,</span> <span class="n">full_flood_event</span><span class="p">,</span> <span class="n">all_disrupted_edges</span><span class="p">,</span> <span class="n">collect_output</span> <span class="o">=</span> <span class="n">load_baseline_impact_assessment</span><span class="p">(</span><span class="n">data_path</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>675 assets loaded.
Loaded data from baseline impact assessment
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">event_impacts</span> <span class="o">=</span> <span class="p">{</span><span class="n">haz_map</span><span class="p">:</span> <span class="n">event_impacts</span><span class="p">[</span><span class="n">haz_map</span><span class="p">]</span> <span class="k">if</span> <span class="n">haz_map</span> <span class="ow">in</span> <span class="n">event_impacts</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span> <span class="k">else</span> <span class="mf">0.0</span> <span class="k">for</span> <span class="n">haz_map</span> <span class="ow">in</span> <span class="n">collect_output</span><span class="o">.</span><span class="n">keys</span><span class="p">()}</span>
<span class="n">direct_damages_baseline_sum</span> <span class="o">=</span> <span class="p">{</span><span class="n">haz_map</span><span class="p">:</span> <span class="p">(</span><span class="nb">sum</span><span class="p">(</span><span class="n">v</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">collect_output</span><span class="p">[</span><span class="n">haz_map</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">()),</span> <span class="nb">sum</span><span class="p">(</span><span class="n">v</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">collect_output</span><span class="p">[</span><span class="n">haz_map</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">()))</span> <span class="k">for</span> <span class="n">haz_map</span> <span class="ow">in</span> <span class="n">collect_output</span><span class="p">}</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Find basins that have damaged assets</span>
<span class="n">overlay_files</span> <span class="o">=</span> <span class="p">[</span><span class="n">file</span> <span class="k">for</span> <span class="n">file</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">interim_data_path</span><span class="p">)</span> <span class="k">if</span> <span class="n">file</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s1">&#39;.pkl&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">file</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;overlay&#39;</span><span class="p">)]</span>
<span class="n">basins_list</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">([</span><span class="nb">int</span><span class="p">(</span><span class="n">file</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span> <span class="k">for</span> <span class="n">file</span> <span class="ow">in</span> <span class="n">overlay_files</span><span class="p">]))</span>
</pre></div>
</div>
</div>
</div>
<p>Define some tag names for clarity in output</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">dict_tags_names</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;l1&#39;</span><span class="p">:</span> <span class="s1">&#39;L1: flood wall&#39;</span><span class="p">,</span> 
                         <span class="s1">&#39;l2&#39;</span><span class="p">:</span> <span class="s1">&#39;L2: elevate rail (viaduct)&#39;</span><span class="p">,</span> 
                         <span class="s1">&#39;l3&#39;</span><span class="p">:</span> <span class="s1">&#39;L3: build new connection&#39;</span><span class="p">,</span> 
                         <span class="s1">&#39;l4&#39;</span><span class="p">:</span> <span class="s1">&#39;L4: reduce demand&#39;</span><span class="p">,</span> 
                         <span class="s1">&#39;trib&#39;</span><span class="p">:</span> <span class="s1">&#39;Study Area 2&#39;</span><span class="p">,</span>
                         <span class="s1">&#39;rhine&#39;</span><span class="p">:</span> <span class="s1">&#39;Study Area 1&#39;</span><span class="p">,</span>
                         <span class="s1">&#39;baseline&#39;</span><span class="p">:</span> <span class="s1">&#39;No adaptation&#39;</span><span class="p">,</span>
                         <span class="s1">&#39;upper bound&#39;</span><span class="p">:</span> <span class="s1">&#39;Future C (discounted)&#39;</span><span class="p">,</span>
                         <span class="s1">&#39;lower bound&#39;</span><span class="p">:</span> <span class="s1">&#39;Future A (discounted)&#39;</span><span class="p">,</span> 
                         <span class="s1">&#39;mean&#39;</span><span class="p">:</span> <span class="s1">&#39;Future B (discounted)&#39;</span><span class="p">}</span>
</pre></div>
</div>
</div>
</div>
<p>Calculate the return period frequencies under climate change and define discount rate for future damages discounting</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">increase_factors_bounds</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;lower bound&#39;</span><span class="p">:{</span><span class="s1">&#39;_H_&#39;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;_M_&#39;</span><span class="p">:</span> <span class="mf">1.75</span><span class="p">,</span> <span class="s1">&#39;_L_&#39;</span><span class="p">:</span> <span class="mf">1.82</span><span class="p">},</span>
                            <span class="s1">&#39;mean&#39;</span><span class="p">:{</span><span class="s1">&#39;_H_&#39;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;_M_&#39;</span><span class="p">:</span> <span class="mf">4.21</span><span class="p">,</span> <span class="s1">&#39;_L_&#39;</span><span class="p">:</span> <span class="mf">5.86</span><span class="p">},</span>
                            <span class="s1">&#39;upper bound&#39;</span><span class="p">:{</span><span class="s1">&#39;_H_&#39;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;_M_&#39;</span><span class="p">:</span> <span class="mf">6.67</span><span class="p">,</span> <span class="s1">&#39;_L_&#39;</span><span class="p">:</span> <span class="mf">9.09</span><span class="p">}}</span>
<span class="n">num_years</span> <span class="o">=</span> <span class="mi">100</span>
<span class="c1"># return_period_dict = {&#39;_H_&#39;: 10,&#39;_M_&#39;: 100,&#39;_L_&#39;: 200} # initial return periods for the different hazard maps</span>
<span class="n">dynamic_rps</span><span class="o">=</span><span class="p">{</span><span class="n">inc_f</span><span class="p">:</span><span class="n">calculate_dynamic_return_periods</span><span class="p">(</span><span class="n">return_period_dict</span><span class="p">,</span> <span class="n">num_years</span><span class="p">,</span> <span class="n">increase_factors_bounds</span><span class="p">[</span><span class="n">inc_f</span><span class="p">])</span> <span class="k">for</span> <span class="n">inc_f</span> <span class="ow">in</span> <span class="n">increase_factors_bounds</span><span class="o">.</span><span class="n">keys</span><span class="p">()}</span>
<span class="n">discount_rate_percent</span> <span class="o">=</span> <span class="mi">1</span> <span class="c1"># (Define discounting rate for future benefits)</span>
</pre></div>
</div>
</div>
</div>
<p>Calculate future damages under climate change without adaptation (baseline)</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#Calculate baseline results for future conditions</span>
<span class="n">adapt_id</span><span class="o">=</span><span class="s1">&#39;baseline&#39;</span>

<span class="n">baseline_results_dict</span> <span class="o">=</span> <span class="p">{}</span>
<span class="n">eadD_bl_by_ts_basin_incf</span> <span class="o">=</span> <span class="p">{}</span>
<span class="n">eadIT_bl_by_ts_basin_incf</span> <span class="o">=</span> <span class="p">{}</span>

<span class="n">direct_damages_adapted</span><span class="p">,</span> <span class="n">indirect_damages_adapted</span><span class="p">,</span> <span class="n">indirect_damages_adapted_full</span><span class="p">,</span> <span class="n">adapted_assets</span><span class="p">,</span> <span class="n">adaptation_costs</span><span class="p">,</span> <span class="n">adaptations_df</span> <span class="o">=</span> <span class="n">load_adaptation_impacts</span><span class="p">(</span><span class="n">adapt_id</span><span class="p">,</span> <span class="n">data_path</span><span class="p">)</span>
<span class="n">total_damages_adapted_df_mill</span><span class="o">=</span><span class="n">process_raw_adaptations_output</span><span class="p">(</span><span class="n">direct_damages_baseline_sum</span><span class="p">,</span> <span class="n">direct_damages_adapted</span><span class="p">,</span> <span class="n">event_impacts</span><span class="p">,</span> <span class="n">indirect_damages_adapted</span><span class="p">,</span> <span class="n">adaptations_df</span><span class="p">)</span>

<span class="k">for</span> <span class="n">inc_f</span> <span class="ow">in</span> <span class="n">increase_factors_bounds</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
    <span class="n">return_periods</span> <span class="o">=</span> <span class="n">dynamic_rps</span><span class="p">[</span><span class="n">inc_f</span><span class="p">]</span> 

    <span class="n">ead_y0_dd_bl_all</span><span class="p">,</span> <span class="n">ead_y100_dd_bl_all</span><span class="p">,</span> <span class="n">total_dd_bl_all</span><span class="p">,</span> <span class="n">eadD_bl_by_ts_basin_incf</span><span class="p">[</span><span class="n">inc_f</span><span class="p">]</span> <span class="o">=</span> <span class="n">compile_direct_risk</span><span class="p">(</span><span class="n">inc_f</span><span class="p">,</span> <span class="n">return_periods</span><span class="p">,</span> <span class="n">basins_list</span><span class="p">,</span> <span class="n">collect_output</span><span class="p">,</span> <span class="n">total_damages_adapted_df_mill</span><span class="p">,</span> <span class="n">discount_rate_percent</span><span class="p">)</span>
    <span class="n">ead_y0_id_bl_all</span><span class="p">,</span> <span class="n">ead_y100_id_bl_all</span><span class="p">,</span> <span class="n">total_id_bl_all</span><span class="p">,</span>  <span class="n">eadIT_bl_by_ts_basin_incf</span><span class="p">[</span><span class="n">inc_f</span><span class="p">]</span> <span class="o">=</span> <span class="n">compile_indirect_risk_tributaries</span><span class="p">(</span><span class="n">inc_f</span><span class="p">,</span> <span class="n">return_periods</span><span class="p">,</span> <span class="n">basins_list</span><span class="p">,</span> <span class="n">basin_list_tributaries</span><span class="p">,</span> <span class="n">collect_output</span><span class="p">,</span> <span class="n">total_damages_adapted_df_mill</span><span class="p">,</span> <span class="n">discount_rate_percent</span><span class="p">)</span>
    <span class="n">ead_y0_id_bl_full</span><span class="p">,</span> <span class="n">ead_y100_id_bl_full</span><span class="p">,</span> <span class="n">total_id_bl_full</span> <span class="o">=</span> <span class="n">compile_indirect_risk_full_flood</span><span class="p">(</span><span class="n">return_periods</span><span class="p">,</span> <span class="n">indirect_damages_adapted_full</span><span class="p">,</span> <span class="n">discount_rate_percent</span><span class="p">)</span>

    <span class="n">baseline_results_dict</span><span class="p">[</span><span class="n">inc_f</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;ead_y0_dd_bl_all&#39;</span><span class="p">:</span> <span class="n">ead_y0_dd_bl_all</span><span class="p">,</span> <span class="s1">&#39;ead_y100_dd_bl_all&#39;</span><span class="p">:</span> <span class="n">ead_y100_dd_bl_all</span><span class="p">,</span> <span class="s1">&#39;total_dd_bl_all&#39;</span><span class="p">:</span> <span class="n">total_dd_bl_all</span><span class="p">,</span>
                                        <span class="s1">&#39;ead_y0_id_bl_all&#39;</span><span class="p">:</span> <span class="n">ead_y0_id_bl_all</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="s1">&#39;ead_y100_id_bl_all&#39;</span><span class="p">:</span> <span class="n">ead_y100_id_bl_all</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="s1">&#39;total_id_bl_all&#39;</span><span class="p">:</span> <span class="n">total_id_bl_all</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                                        <span class="s1">&#39;ead_y0_id_bl_full&#39;</span><span class="p">:</span> <span class="n">ead_y0_id_bl_full</span><span class="p">,</span> <span class="s1">&#39;ead_y100_id_bl_full&#39;</span><span class="p">:</span> <span class="n">ead_y100_id_bl_full</span><span class="p">,</span> <span class="s1">&#39;total_id_bl_full&#39;</span><span class="p">:</span> <span class="n">total_id_bl_full</span><span class="p">}</span>   
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#Baseline damages and losses by return period</span>
<span class="n">direct_damages_adapted</span><span class="p">,</span> <span class="n">indirect_damages_adapted</span><span class="p">,</span> <span class="n">indirect_damages_adapted_full</span><span class="p">,</span> <span class="n">adapted_assets</span><span class="p">,</span> <span class="n">adaptation_costs</span><span class="p">,</span> <span class="n">adaptations_df</span> <span class="o">=</span> <span class="n">load_adaptation_impacts</span><span class="p">(</span><span class="n">adapt_id</span><span class="p">,</span> <span class="n">data_path</span><span class="p">)</span>
<span class="n">total_damages_adapted_df_mill</span><span class="o">=</span><span class="n">process_raw_adaptations_output</span><span class="p">(</span><span class="n">direct_damages_baseline_sum</span><span class="p">,</span> <span class="n">direct_damages_adapted</span><span class="p">,</span> <span class="n">event_impacts</span><span class="p">,</span> <span class="n">indirect_damages_adapted</span><span class="p">,</span> <span class="n">adaptations_df</span><span class="p">)</span>

<span class="n">total_damages_adapted_df_mill</span>
<span class="n">total_damages_adapted_df_mill</span><span class="p">[</span><span class="s1">&#39;basin&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">total_damages_adapted_df_mill</span><span class="o">.</span><span class="n">index</span>
<span class="n">total_damages_adapted_df_mill</span><span class="p">[</span><span class="s1">&#39;basin&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">total_damages_adapted_df_mill</span><span class="p">[</span><span class="s1">&#39;basin&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">int</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]))</span>
<span class="n">total_damages_adapted_df_mill</span><span class="p">[</span><span class="s1">&#39;direct damage baseline avg [M€]&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">total_damages_adapted_df_mill</span><span class="p">[</span><span class="s1">&#39;direct damage baseline lower [M€]&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">total_damages_adapted_df_mill</span><span class="p">[</span><span class="s1">&#39;direct damage baseline upper [M€]&#39;</span><span class="p">])</span><span class="o">/</span><span class="mi">2</span>
<span class="n">total_damages_adapted_df_mill</span><span class="p">[</span><span class="s1">&#39;indirect damage baseline_tributaries [M€]&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">total_damages_adapted_df_mill</span><span class="p">[</span><span class="s1">&#39;basin&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">basin_list_tributaries</span><span class="p">),</span> <span class="n">total_damages_adapted_df_mill</span><span class="p">[</span><span class="s1">&#39;indirect damage baseline [M€]&#39;</span><span class="p">],</span> <span class="mi">0</span><span class="p">)</span>
<span class="n">total_damages_adapted_df_mill_sum</span> <span class="o">=</span> <span class="n">total_damages_adapted_df_mill</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">&#39;return_period&#39;</span><span class="p">],</span> <span class="n">observed</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>

<span class="c1"># keep only return_period direct damage baseline lower [M€]	direct damage baseline upper [M€]	indirect damage baseline_tributaries [M€]</span>
<span class="n">keep_cols</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;return_period&#39;</span><span class="p">,</span> <span class="s1">&#39;direct damage baseline avg [M€]&#39;</span><span class="p">,</span> <span class="s1">&#39;direct damage baseline lower [M€]&#39;</span><span class="p">,</span> <span class="s1">&#39;direct damage baseline upper [M€]&#39;</span><span class="p">,</span> <span class="s1">&#39;indirect damage baseline_tributaries [M€]&#39;</span><span class="p">]</span>
<span class="n">drop_cols</span> <span class="o">=</span> <span class="p">[</span><span class="n">col</span> <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">total_damages_adapted_df_mill_sum</span><span class="o">.</span><span class="n">columns</span>  <span class="k">if</span> <span class="n">col</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">keep_cols</span><span class="p">]</span>
<span class="n">total_damages_adapted_df_mill_sum</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="n">col</span> <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">drop_cols</span> <span class="k">if</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">total_damages_adapted_df_mill_sum</span><span class="o">.</span><span class="n">columns</span><span class="p">],</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="n">return_period_keys</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;H&#39;</span><span class="p">:</span> <span class="s1">&#39;flood_DERP_RW_H&#39;</span><span class="p">,</span> <span class="s1">&#39;M&#39;</span><span class="p">:</span> <span class="s1">&#39;flood_DERP_RW_M&#39;</span><span class="p">,</span> <span class="s1">&#39;L&#39;</span><span class="p">:</span> <span class="s1">&#39;flood_DERP_RW_L&#39;</span><span class="p">}</span>
<span class="n">total_damages_adapted_df_mill_sum</span><span class="p">[</span><span class="s1">&#39;indirect damage baseline_mainstem [M€]&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span>
    <span class="n">full_flood_event</span><span class="p">[</span><span class="n">return_period_keys</span><span class="p">[</span><span class="n">x</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]]]</span> <span class="o">/</span> <span class="mf">1e6</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">total_damages_adapted_df_mill_sum</span><span class="p">[</span><span class="s1">&#39;return_period&#39;</span><span class="p">]</span>
<span class="p">]</span>
<span class="c1"># turn all values to integers except return_period</span>
<span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">total_damages_adapted_df_mill_sum</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
    <span class="k">if</span> <span class="n">col</span> <span class="o">!=</span> <span class="s1">&#39;return_period&#39;</span><span class="p">:</span>
        <span class="n">total_damages_adapted_df_mill_sum</span><span class="p">[</span><span class="n">col</span><span class="p">]</span> <span class="o">=</span> <span class="n">total_damages_adapted_df_mill_sum</span><span class="p">[</span><span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">int</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
<p>Calculate adaptations under future conditions</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Calculate results for adapted conditions</span>
<span class="n">adaptation_files</span> <span class="o">=</span> <span class="p">[</span><span class="n">file</span> <span class="k">for</span> <span class="n">file</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">adaptations_df_dir</span><span class="p">)</span> <span class="k">if</span> <span class="n">file</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s1">&#39;.csv&#39;</span><span class="p">)]</span>
<span class="n">adapt_ids</span> <span class="o">=</span> <span class="p">[</span><span class="n">file</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;_adaptations&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">file</span> <span class="ow">in</span> <span class="n">adaptation_files</span><span class="p">]</span>

<span class="n">adapted_results_dict</span> <span class="o">=</span> <span class="p">{}</span>
<span class="n">adaptation_cost_dict</span> <span class="o">=</span> <span class="p">{}</span>
<span class="n">eadD_ad_by_ts_basin_incf</span> <span class="o">=</span> <span class="p">{}</span>
<span class="n">eadIT_ad_by_ts_basin_incf</span> <span class="o">=</span> <span class="p">{}</span>

<span class="k">for</span> <span class="n">adapt_id</span> <span class="ow">in</span> <span class="n">adapt_ids</span><span class="p">:</span>
    <span class="n">direct_damages_adapted</span><span class="p">,</span> <span class="n">indirect_damages_adapted</span><span class="p">,</span> <span class="n">indirect_damages_adapted_full</span><span class="p">,</span> <span class="n">adapted_assets</span><span class="p">,</span> <span class="n">adaptation_costs</span><span class="p">,</span> <span class="n">adaptations_df</span> <span class="o">=</span> <span class="n">load_adaptation_impacts</span><span class="p">(</span><span class="n">adapt_id</span><span class="p">,</span> <span class="n">data_path</span><span class="p">)</span>
    <span class="n">total_damages_adapted_df_mill</span><span class="o">=</span><span class="n">process_raw_adaptations_output</span><span class="p">(</span><span class="n">direct_damages_baseline_sum</span><span class="p">,</span> <span class="n">direct_damages_adapted</span><span class="p">,</span> <span class="n">event_impacts</span><span class="p">,</span> <span class="n">indirect_damages_adapted</span><span class="p">,</span> <span class="n">adaptations_df</span><span class="p">)</span>
    <span class="n">adaptation_cost_dict</span><span class="p">[</span><span class="n">adapt_id</span><span class="p">]</span> <span class="o">=</span> <span class="n">adaptation_costs</span>    
    
    <span class="k">if</span> <span class="n">adapt_id</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">adapted_results_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
        <span class="n">adapted_results_dict</span><span class="p">[</span><span class="n">adapt_id</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">eadD_ad_by_ts_basin_incf</span><span class="p">[</span><span class="n">adapt_id</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">eadIT_ad_by_ts_basin_incf</span><span class="p">[</span><span class="n">adapt_id</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">inc_f</span> <span class="ow">in</span> <span class="n">increase_factors_bounds</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
        <span class="k">if</span> <span class="n">inc_f</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">adapted_results_dict</span><span class="p">[</span><span class="n">adapt_id</span><span class="p">]:</span>
            <span class="n">adapted_results_dict</span><span class="p">[</span><span class="n">adapt_id</span><span class="p">][</span><span class="n">inc_f</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
        
        <span class="n">return_periods</span> <span class="o">=</span> <span class="n">dynamic_rps</span><span class="p">[</span><span class="n">inc_f</span><span class="p">]</span>

        <span class="nb">print</span><span class="p">(</span><span class="n">adapt_id</span><span class="p">,</span> <span class="n">inc_f</span><span class="p">)</span>

        <span class="n">ead_y0_dd_ad_all</span><span class="p">,</span> <span class="n">ead_y100_dd_ad_all</span><span class="p">,</span> <span class="n">total_dd_ad_all</span><span class="p">,</span> <span class="n">eadD_ad_by_ts_basin_incf</span><span class="p">[</span><span class="n">adapt_id</span><span class="p">][</span><span class="n">inc_f</span><span class="p">]</span>  <span class="o">=</span> <span class="n">compile_direct_risk</span><span class="p">(</span><span class="n">inc_f</span><span class="p">,</span> <span class="n">return_periods</span><span class="p">,</span> <span class="n">basins_list</span><span class="p">,</span> <span class="n">collect_output</span><span class="p">,</span> <span class="n">total_damages_adapted_df_mill</span><span class="p">,</span> <span class="n">discount_rate_percent</span><span class="o">=</span><span class="n">discount_rate_percent</span><span class="p">)</span>
        <span class="n">ead_y0_id_ad_all</span><span class="p">,</span> <span class="n">ead_y100_id_ad_all</span><span class="p">,</span> <span class="n">total_id_ad_all</span><span class="p">,</span> <span class="n">eadIT_ad_by_ts_basin_incf</span><span class="p">[</span><span class="n">adapt_id</span><span class="p">][</span><span class="n">inc_f</span><span class="p">]</span> <span class="o">=</span> <span class="n">compile_indirect_risk_tributaries</span><span class="p">(</span><span class="n">inc_f</span><span class="p">,</span> <span class="n">return_periods</span><span class="p">,</span> <span class="n">basins_list</span><span class="p">,</span> <span class="n">basin_list_tributaries</span><span class="p">,</span> <span class="n">collect_output</span><span class="p">,</span> <span class="n">total_damages_adapted_df_mill</span><span class="p">,</span> <span class="n">discount_rate_percent</span><span class="o">=</span><span class="n">discount_rate_percent</span><span class="p">)</span>
        <span class="n">ead_y0_id_ad_full</span><span class="p">,</span> <span class="n">ead_y100_id_ad_full</span><span class="p">,</span> <span class="n">total_id_ad_full</span> <span class="o">=</span> <span class="n">compile_indirect_risk_full_flood</span><span class="p">(</span><span class="n">return_periods</span><span class="p">,</span> <span class="n">indirect_damages_adapted_full</span><span class="p">,</span> <span class="n">discount_rate_percent</span><span class="o">=</span><span class="n">discount_rate_percent</span><span class="p">)</span>

        <span class="n">adapted_results_dict</span><span class="p">[</span><span class="n">adapt_id</span><span class="p">][</span><span class="n">inc_f</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;ead_y0_dd_ad_all&#39;</span><span class="p">:</span> <span class="n">ead_y0_dd_ad_all</span><span class="p">,</span> <span class="s1">&#39;ead_y100_dd_ad_all&#39;</span><span class="p">:</span> <span class="n">ead_y100_dd_ad_all</span><span class="p">,</span> <span class="s1">&#39;total_dd_ad_all&#39;</span><span class="p">:</span> <span class="n">total_dd_ad_all</span><span class="p">,</span>
                                                <span class="s1">&#39;ead_y0_id_ad_all&#39;</span><span class="p">:</span> <span class="n">ead_y0_id_ad_all</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="s1">&#39;ead_y100_id_ad_all&#39;</span><span class="p">:</span> <span class="n">ead_y100_id_ad_all</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="s1">&#39;total_id_ad_all&#39;</span><span class="p">:</span> <span class="n">total_id_ad_all</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                                                <span class="s1">&#39;ead_y0_id_ad_full&#39;</span><span class="p">:</span> <span class="n">ead_y0_id_ad_full</span><span class="p">,</span> <span class="s1">&#39;ead_y100_id_ad_full&#39;</span><span class="p">:</span> <span class="n">ead_y100_id_ad_full</span><span class="p">,</span> <span class="s1">&#39;total_id_ad_full&#39;</span><span class="p">:</span> <span class="n">total_id_ad_full</span><span class="p">}</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>baseline lower bound
baseline mean
baseline upper bound
l1_trib lower bound
l1_trib mean
l1_trib upper bound
l2_trib lower bound
l2_trib mean
l2_trib upper bound
l3_trib lower bound
l3_trib mean
l3_trib upper bound
l4_trib lower bound
l4_trib mean
l4_trib upper bound
</pre></div>
</div>
</div>
</div>
<p>Output discounted future risk</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">future_risk_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>

<span class="n">risk_components</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Direct damage [M€]&#39;</span><span class="p">,</span> <span class="s1">&#39;Indirect losses tributaries [M€]&#39;</span><span class="p">,</span> <span class="s1">&#39;Indirect losses mainstem [M€]&#39;</span><span class="p">]</span>
<span class="n">increase_factors</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;lower bound&#39;</span><span class="p">,</span> <span class="s1">&#39;mean&#39;</span><span class="p">,</span> <span class="s1">&#39;upper bound&#39;</span><span class="p">]</span>

<span class="n">future_risk_df</span><span class="p">[</span><span class="s1">&#39;Risk component&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">risk_components</span>
<span class="n">future_risk_df</span><span class="p">[</span><span class="s1">&#39;Year 0 (undiscounted)&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[(</span><span class="n">baseline_results_dict</span><span class="p">[</span><span class="s1">&#39;mean&#39;</span><span class="p">][</span><span class="s1">&#39;ead_y0_dd_bl_all&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="n">baseline_results_dict</span><span class="p">[</span><span class="s1">&#39;mean&#39;</span><span class="p">][</span><span class="s1">&#39;ead_y0_dd_bl_all&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">])</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span> <span class="n">baseline_results_dict</span><span class="p">[</span><span class="s1">&#39;mean&#39;</span><span class="p">][</span><span class="s1">&#39;ead_y0_id_bl_all&#39;</span><span class="p">],</span> <span class="n">baseline_results_dict</span><span class="p">[</span><span class="s1">&#39;mean&#39;</span><span class="p">][</span><span class="s1">&#39;ead_y0_id_bl_full&#39;</span><span class="p">]]</span>

<span class="k">for</span> <span class="n">inc_f</span> <span class="ow">in</span> <span class="n">increase_factors</span><span class="p">:</span>
    <span class="n">future_risk_df</span><span class="p">[</span><span class="n">dict_tags_names</span><span class="p">[</span><span class="n">inc_f</span><span class="p">]]</span> <span class="o">=</span> <span class="p">[(</span><span class="n">baseline_results_dict</span><span class="p">[</span><span class="n">inc_f</span><span class="p">][</span><span class="s1">&#39;ead_y100_dd_bl_all&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="n">baseline_results_dict</span><span class="p">[</span><span class="n">inc_f</span><span class="p">][</span><span class="s1">&#39;ead_y100_dd_bl_all&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">])</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span> <span class="n">baseline_results_dict</span><span class="p">[</span><span class="n">inc_f</span><span class="p">][</span><span class="s1">&#39;ead_y100_id_bl_all&#39;</span><span class="p">],</span> <span class="n">baseline_results_dict</span><span class="p">[</span><span class="n">inc_f</span><span class="p">][</span><span class="s1">&#39;ead_y100_id_bl_full&#39;</span><span class="p">]]</span>

<span class="c1"># add all components</span>
<span class="n">future_risk_df</span><span class="o">=</span><span class="n">future_risk_df</span><span class="o">.</span><span class="n">T</span>
<span class="n">future_risk_df</span><span class="p">[</span><span class="s1">&#39;total&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">future_risk_df</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">future_risk_df</span><span class="o">=</span><span class="n">future_risk_df</span><span class="o">.</span><span class="n">T</span> 
<span class="n">future_risk_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="s1">&#39;total&#39;</span><span class="p">,</span> <span class="s1">&#39;Risk component&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;Total [M€]&#39;</span>

<span class="n">future_risk_df</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="n">future_risk_df</span><span class="p">[</span><span class="s1">&#39;Risk component&#39;</span><span class="p">]</span>
<span class="n">future_risk_df</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;Risk component&#39;</span><span class="p">],</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">future_risk_df</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">data_path</span> <span class="o">/</span> <span class="s1">&#39;output&#39;</span> <span class="o">/</span> <span class="s1">&#39;future_risk_df.csv&#39;</span><span class="p">)</span>
<span class="n">future_risk_df</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Year 0 (undiscounted)</th>
      <th>Future A (discounted)</th>
      <th>Future B (discounted)</th>
      <th>Future C (discounted)</th>
    </tr>
    <tr>
      <th>Risk component</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>Direct damage [M€]</th>
      <td>1.680</td>
      <td>1.153</td>
      <td>1.844</td>
      <td>2.480</td>
    </tr>
    <tr>
      <th>Indirect losses tributaries [M€]</th>
      <td>0.731</td>
      <td>0.444</td>
      <td>0.669</td>
      <td>0.876</td>
    </tr>
    <tr>
      <th>Indirect losses mainstem [M€]</th>
      <td>2.048</td>
      <td>1.180</td>
      <td>1.963</td>
      <td>2.678</td>
    </tr>
    <tr>
      <th>Total [M€]</th>
      <td>4.460</td>
      <td>2.778</td>
      <td>4.477</td>
      <td>6.034</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>Calculate total discounted adaptation costs including initial cost and maintenance</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Process adaptation costs and benefits for different levels and incorporate yearly maintenance costs</span>
<span class="n">yearly_maintenance_percent</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;l1&#39;</span><span class="p">:</span> <span class="mf">1.0</span><span class="p">,</span> <span class="s1">&#39;l2&#39;</span><span class="p">:</span> <span class="mf">1.0</span><span class="p">,</span> <span class="s1">&#39;l3&#39;</span><span class="p">:</span> <span class="mf">1.0</span><span class="p">}</span>
<span class="n">maintenance_pc_dict</span> <span class="o">=</span> <span class="n">discount_maintenance_costs</span><span class="p">(</span><span class="n">yearly_maintenance_percent</span><span class="p">,</span> <span class="n">discount_rate_percent</span><span class="p">,</span> <span class="n">num_years</span><span class="p">)</span>

<span class="n">processed_adaptation_costs</span> <span class="o">=</span> <span class="n">process_adaptation_costs</span><span class="p">(</span><span class="n">adaptation_cost_dict</span><span class="p">,</span> <span class="n">maintenance_pc_dict</span><span class="p">)</span>

<span class="c1"># Find the avoided damages</span>
<span class="n">avoided_damages_dict</span> <span class="o">=</span> <span class="p">{}</span>
<span class="k">for</span> <span class="n">adapt_id</span> <span class="ow">in</span> <span class="n">adapt_ids</span><span class="p">:</span>
    <span class="k">if</span> <span class="n">adapt_id</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">adapted_results_dict</span><span class="p">:</span>
        <span class="k">continue</span>
    <span class="n">avoided_damages_dict</span><span class="p">[</span><span class="n">adapt_id</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">inc_f</span> <span class="ow">in</span> <span class="n">increase_factors_bounds</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
        <span class="n">avoided_damages_dict</span><span class="p">[</span><span class="n">adapt_id</span><span class="p">][</span><span class="n">inc_f</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">baseline_results_dict</span><span class="p">[</span><span class="n">inc_f</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="n">key_ad</span><span class="o">=</span><span class="n">key</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;bl&#39;</span><span class="p">,</span><span class="s1">&#39;ad&#39;</span><span class="p">)</span>
            <span class="n">key_diff</span><span class="o">=</span><span class="n">key</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;bl&#39;</span><span class="p">,</span><span class="s1">&#39;diff&#39;</span><span class="p">)</span>
            <span class="n">avoided_damages_dict</span><span class="p">[</span><span class="n">adapt_id</span><span class="p">][</span><span class="n">inc_f</span><span class="p">][</span><span class="n">key_diff</span><span class="p">]</span> <span class="o">=</span> <span class="n">baseline_results_dict</span><span class="p">[</span><span class="n">inc_f</span><span class="p">][</span><span class="n">key</span><span class="p">]</span> <span class="o">-</span> <span class="n">adapted_results_dict</span><span class="p">[</span><span class="n">adapt_id</span><span class="p">][</span><span class="n">inc_f</span><span class="p">][</span><span class="n">key_ad</span><span class="p">]</span>

<span class="n">benefits_dict</span> <span class="o">=</span> <span class="p">{}</span>
<span class="k">for</span> <span class="n">adapt_id</span> <span class="ow">in</span> <span class="n">adapt_ids</span><span class="p">:</span>
    <span class="n">benefits_dict</span><span class="p">[</span><span class="n">adapt_id</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">inc_f</span> <span class="ow">in</span> <span class="n">increase_factors_bounds</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
        <span class="n">benefits_dict</span><span class="p">[</span><span class="n">adapt_id</span><span class="p">][</span><span class="n">inc_f</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">total_avoided_damages_y0</span> <span class="o">=</span> <span class="n">avoided_damages_dict</span><span class="p">[</span><span class="n">adapt_id</span><span class="p">][</span><span class="n">inc_f</span><span class="p">][</span><span class="s1">&#39;ead_y0_dd_diff_all&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">avoided_damages_dict</span><span class="p">[</span><span class="n">adapt_id</span><span class="p">][</span><span class="n">inc_f</span><span class="p">][</span><span class="s1">&#39;ead_y0_id_diff_all&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">avoided_damages_dict</span><span class="p">[</span><span class="n">adapt_id</span><span class="p">][</span><span class="n">inc_f</span><span class="p">][</span><span class="s1">&#39;ead_y0_id_diff_full&#39;</span><span class="p">]</span>
        <span class="n">total_avoided_damages_y100</span> <span class="o">=</span> <span class="n">avoided_damages_dict</span><span class="p">[</span><span class="n">adapt_id</span><span class="p">][</span><span class="n">inc_f</span><span class="p">][</span><span class="s1">&#39;ead_y100_dd_diff_all&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">avoided_damages_dict</span><span class="p">[</span><span class="n">adapt_id</span><span class="p">][</span><span class="n">inc_f</span><span class="p">][</span><span class="s1">&#39;ead_y100_id_diff_all&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">avoided_damages_dict</span><span class="p">[</span><span class="n">adapt_id</span><span class="p">][</span><span class="n">inc_f</span><span class="p">][</span><span class="s1">&#39;ead_y100_id_diff_full&#39;</span><span class="p">]</span>
        <span class="n">total_avoided_damages_full_period</span> <span class="o">=</span> <span class="n">avoided_damages_dict</span><span class="p">[</span><span class="n">adapt_id</span><span class="p">][</span><span class="n">inc_f</span><span class="p">][</span><span class="s1">&#39;total_dd_diff_all&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">avoided_damages_dict</span><span class="p">[</span><span class="n">adapt_id</span><span class="p">][</span><span class="n">inc_f</span><span class="p">][</span><span class="s1">&#39;total_id_diff_all&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">avoided_damages_dict</span><span class="p">[</span><span class="n">adapt_id</span><span class="p">][</span><span class="n">inc_f</span><span class="p">][</span><span class="s1">&#39;total_id_diff_full&#39;</span><span class="p">]</span>
        <span class="n">benefits_dict</span><span class="p">[</span><span class="n">adapt_id</span><span class="p">][</span><span class="n">inc_f</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;total_avoided_damages_y0&#39;</span><span class="p">:</span> <span class="n">total_avoided_damages_y0</span><span class="p">,</span> <span class="s1">&#39;total_avoided_damages_y100&#39;</span><span class="p">:</span> <span class="n">total_avoided_damages_y100</span><span class="p">,</span> <span class="s1">&#39;total_avoided_damages_full_period&#39;</span><span class="p">:</span> <span class="n">total_avoided_damages_full_period</span><span class="p">}</span>
</pre></div>
</div>
</div>
</div>
<p>Calculate the benefit to cost ratios for each adaptation under each future conditions and save results</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">adapt_ids</span><span class="o">=</span><span class="n">benefits_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
<span class="n">bcr_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>

<span class="k">for</span> <span class="n">adapt_id</span> <span class="ow">in</span> <span class="n">adapt_ids</span><span class="p">:</span>
    <span class="k">for</span> <span class="n">inc_f</span> <span class="ow">in</span> <span class="n">increase_factors_bounds</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
        <span class="n">total_adaptation_cost</span> <span class="o">=</span> <span class="n">processed_adaptation_costs</span><span class="p">[</span><span class="n">adapt_id</span><span class="p">]</span>
        <span class="n">total_avoided_damages</span> <span class="o">=</span> <span class="n">benefits_dict</span><span class="p">[</span><span class="n">adapt_id</span><span class="p">][</span><span class="n">inc_f</span><span class="p">][</span><span class="s1">&#39;total_avoided_damages_full_period&#39;</span><span class="p">]</span>
        <span class="n">bcr</span> <span class="o">=</span> <span class="n">total_avoided_damages</span> <span class="o">/</span> <span class="n">total_adaptation_cost</span> <span class="k">if</span> <span class="n">total_adaptation_cost</span> <span class="o">!=</span> <span class="mi">0</span> <span class="k">else</span> <span class="n">math</span><span class="o">.</span><span class="n">nan</span>
        <span class="n">bcr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan_to_num</span><span class="p">(</span><span class="n">bcr</span><span class="p">,</span> <span class="n">nan</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="c1"># bcr = bcr if bcr != math.nan else 0</span>
        <span class="n">bcr_mean</span> <span class="o">=</span> <span class="n">bcr</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
        <span class="n">total_avoided_damages_mean</span> <span class="o">=</span> <span class="n">total_avoided_damages</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
        <span class="n">new_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({(</span><span class="n">adapt_id</span><span class="p">,</span><span class="n">inc_f</span><span class="p">):</span> <span class="p">[</span><span class="n">total_adaptation_cost</span><span class="p">,</span> <span class="n">total_avoided_damages_mean</span><span class="p">,</span> <span class="n">bcr_mean</span><span class="p">,</span> <span class="n">total_avoided_damages</span><span class="p">,</span> <span class="n">bcr</span><span class="p">]},</span> <span class="n">index</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;total_adaptation_cost&#39;</span><span class="p">,</span> <span class="s1">&#39;total_avoided_damages_mean&#39;</span><span class="p">,</span><span class="s1">&#39;bcr_mean&#39;</span><span class="p">,</span> <span class="s1">&#39;total_avoided_damages&#39;</span><span class="p">,</span> <span class="s1">&#39;bcr&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">T</span>
        <span class="n">bcr_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">bcr_df</span><span class="p">,</span> <span class="n">new_df</span><span class="p">])</span>
        
<span class="n">adapt_ids_output</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;baseline&#39;</span><span class="p">,</span> <span class="s1">&#39;l1_trib&#39;</span><span class="p">,</span> <span class="s1">&#39;l2_trib&#39;</span><span class="p">,</span><span class="s1">&#39;l3_trib&#39;</span><span class="p">,</span><span class="s1">&#39;l4_trib&#39;</span><span class="p">]</span><span class="c1">#, &#39;l1_rhine&#39;, &#39;l2_rhine&#39;, &#39;l3_rhine&#39;, &#39;l4_rhine&#39;]</span>

<span class="n">bcr_df</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="s1">&#39;bcr_mean&#39;</span><span class="p">,</span> <span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">bcr_df</span> <span class="o">=</span> <span class="n">bcr_df</span><span class="p">[</span><span class="n">bcr_df</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">get_level_values</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">adapt_ids_output</span><span class="p">)]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

<span class="c1"># Turn the total avoided damages and bcr columns into separate columns for the upper and lower bounds</span>
<span class="n">bcr_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="s1">&#39;total_avoided_damages_lower&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">bcr_df</span><span class="p">[</span><span class="s1">&#39;total_avoided_damages&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="n">bcr_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="s1">&#39;total_avoided_damages_upper&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">bcr_df</span><span class="p">[</span><span class="s1">&#39;total_avoided_damages&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
<span class="n">bcr_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="s1">&#39;bcr_lower&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">bcr_df</span><span class="p">[</span><span class="s1">&#39;bcr&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="n">x</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span> <span class="k">else</span> <span class="mi">0</span><span class="p">)</span>
<span class="n">bcr_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="s1">&#39;bcr_upper&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">bcr_df</span><span class="p">[</span><span class="s1">&#39;bcr&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="n">x</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span> <span class="k">else</span> <span class="mi">0</span><span class="p">)</span>

<span class="n">bcr_df</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">data_path</span> <span class="o">/</span> <span class="s1">&#39;output&#39;</span> <span class="o">/</span> <span class="s1">&#39;bcr_df.csv&#39;</span><span class="p">)</span>

<span class="n">bcr_df</span>    
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th></th>
      <th>total_adaptation_cost</th>
      <th>total_avoided_damages_mean</th>
      <th>bcr_mean</th>
      <th>total_avoided_damages</th>
      <th>bcr</th>
      <th>total_avoided_damages_lower</th>
      <th>total_avoided_damages_upper</th>
      <th>bcr_lower</th>
      <th>bcr_upper</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th rowspan="3" valign="top">baseline</th>
      <th>lower bound</th>
      <td>0.000</td>
      <td>0.000</td>
      <td>0.000</td>
      <td>[0.0, 0.0]</td>
      <td>0.000</td>
      <td>0.000</td>
      <td>0.000</td>
      <td>0.000</td>
      <td>0.000</td>
    </tr>
    <tr>
      <th>mean</th>
      <td>0.000</td>
      <td>0.000</td>
      <td>0.000</td>
      <td>[0.0, 0.0]</td>
      <td>0.000</td>
      <td>0.000</td>
      <td>0.000</td>
      <td>0.000</td>
      <td>0.000</td>
    </tr>
    <tr>
      <th>upper bound</th>
      <td>0.000</td>
      <td>0.000</td>
      <td>0.000</td>
      <td>[0.0, 0.0]</td>
      <td>0.000</td>
      <td>0.000</td>
      <td>0.000</td>
      <td>0.000</td>
      <td>0.000</td>
    </tr>
    <tr>
      <th rowspan="3" valign="top">l1_trib</th>
      <th>lower bound</th>
      <td>435.727</td>
      <td>15.079</td>
      <td>0.035</td>
      <td>[9.835288626903797, 20.321839491874066]</td>
      <td>[0.02257212506556448, 0.04663890608336039]</td>
      <td>9.835</td>
      <td>20.322</td>
      <td>0.023</td>
      <td>0.047</td>
    </tr>
    <tr>
      <th>mean</th>
      <td>435.727</td>
      <td>21.343</td>
      <td>0.049</td>
      <td>[12.894443627457846, 29.79207338101]</td>
      <td>[0.0295929286115394, 0.06837322541599164]</td>
      <td>12.894</td>
      <td>29.792</td>
      <td>0.030</td>
      <td>0.068</td>
    </tr>
    <tr>
      <th>upper bound</th>
      <td>435.727</td>
      <td>27.082</td>
      <td>0.062</td>
      <td>[15.707917480960631, 38.45673467131418]</td>
      <td>[0.036049890486175566, 0.08825874435851716]</td>
      <td>15.708</td>
      <td>38.457</td>
      <td>0.036</td>
      <td>0.088</td>
    </tr>
    <tr>
      <th rowspan="3" valign="top">l2_trib</th>
      <th>lower bound</th>
      <td>1,360.178</td>
      <td>91.740</td>
      <td>0.067</td>
      <td>[80.3712624376798, 103.10815552773397]</td>
      <td>[0.05908880173698988, 0.07580492298685948]</td>
      <td>80.371</td>
      <td>103.108</td>
      <td>0.059</td>
      <td>0.076</td>
    </tr>
    <tr>
      <th>mean</th>
      <td>1,360.178</td>
      <td>117.468</td>
      <td>0.086</td>
      <td>[101.15376818733411, 133.78196378511302]</td>
      <td>[0.07436806107164799, 0.09835624941456263]</td>
      <td>101.154</td>
      <td>133.782</td>
      <td>0.074</td>
      <td>0.098</td>
    </tr>
    <tr>
      <th>upper bound</th>
      <td>1,360.178</td>
      <td>141.086</td>
      <td>0.104</td>
      <td>[120.23621758971255, 161.936087897667]</td>
      <td>[0.08839744216128304, 0.1190551087743402]</td>
      <td>120.236</td>
      <td>161.936</td>
      <td>0.088</td>
      <td>0.119</td>
    </tr>
    <tr>
      <th rowspan="3" valign="top">l3_trib</th>
      <th>lower bound</th>
      <td>215.266</td>
      <td>0.000</td>
      <td>0.000</td>
      <td>[0.0, 0.0]</td>
      <td>[0.0, 0.0]</td>
      <td>0.000</td>
      <td>0.000</td>
      <td>0.000</td>
      <td>0.000</td>
    </tr>
    <tr>
      <th>mean</th>
      <td>215.266</td>
      <td>0.000</td>
      <td>0.000</td>
      <td>[0.0, 0.0]</td>
      <td>[0.0, 0.0]</td>
      <td>0.000</td>
      <td>0.000</td>
      <td>0.000</td>
      <td>0.000</td>
    </tr>
    <tr>
      <th>upper bound</th>
      <td>215.266</td>
      <td>0.000</td>
      <td>0.000</td>
      <td>[0.0, 0.0]</td>
      <td>[0.0, 0.0]</td>
      <td>0.000</td>
      <td>0.000</td>
      <td>0.000</td>
      <td>0.000</td>
    </tr>
    <tr>
      <th rowspan="3" valign="top">l4_trib</th>
      <th>lower bound</th>
      <td>0.000</td>
      <td>22.575</td>
      <td>0.000</td>
      <td>[22.574833550930002, 22.574833550930002]</td>
      <td>0.000</td>
      <td>22.575</td>
      <td>22.575</td>
      <td>0.000</td>
      <td>0.000</td>
    </tr>
    <tr>
      <th>mean</th>
      <td>0.000</td>
      <td>27.705</td>
      <td>0.000</td>
      <td>[27.70503439170446, 27.70503439170446]</td>
      <td>0.000</td>
      <td>27.705</td>
      <td>27.705</td>
      <td>0.000</td>
      <td>0.000</td>
    </tr>
    <tr>
      <th>upper bound</th>
      <td>0.000</td>
      <td>32.402</td>
      <td>0.000</td>
      <td>[32.401510638587496, 32.401510638587496]</td>
      <td>0.000</td>
      <td>32.402</td>
      <td>32.402</td>
      <td>0.000</td>
      <td>0.000</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>Create visualisation of BCRs</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Create a scatter plot of total avoided damages vs total adaptation costs, consider the upper and lower bounds as error bars</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>

<span class="c1"># Add BCR lines</span>
<span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">max</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">bcr_df</span><span class="p">[</span><span class="s1">&#39;total_adaptation_cost&#39;</span><span class="p">]),</span> <span class="mi">100</span><span class="p">)</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">x</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s1">&#39;dashed&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">)</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">2</span><span class="p">):</span>
    <span class="n">y</span> <span class="o">=</span> <span class="n">i</span><span class="o">/</span><span class="mi">10</span> <span class="o">*</span> <span class="n">x</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s1">&#39;dotted&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;grey&#39;</span><span class="p">)</span>

<span class="c1"># Set the y axis to the maximum value of the total avoided damages*1.2</span>
<span class="n">max_x</span> <span class="o">=</span> <span class="mf">1.2</span> <span class="o">*</span> <span class="n">bcr_df</span><span class="p">[</span><span class="s1">&#39;total_adaptation_cost&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
<span class="n">max_y</span> <span class="o">=</span> <span class="mi">3</span> <span class="o">*</span> <span class="n">bcr_df</span><span class="p">[</span><span class="s1">&#39;total_avoided_damages_mean&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>

<span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">max_x</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">max_y</span><span class="p">)</span>

<span class="n">bcr_texts</span> <span class="o">=</span> <span class="p">{</span><span class="mf">1.0</span><span class="p">:</span> <span class="p">(</span><span class="n">max_x</span> <span class="o">*</span> <span class="mf">0.25</span><span class="p">,</span> <span class="n">max_y</span> <span class="o">*</span> <span class="mf">0.95</span><span class="p">),</span> 
             <span class="mf">0.8</span><span class="p">:</span> <span class="p">(</span><span class="n">max_x</span> <span class="o">*</span> <span class="mf">0.3</span><span class="p">,</span> <span class="n">max_y</span> <span class="o">*</span> <span class="mf">0.85</span><span class="p">),</span> 
             <span class="mf">0.6</span><span class="p">:</span> <span class="p">(</span><span class="n">max_x</span> <span class="o">*</span> <span class="mf">0.35</span><span class="p">,</span> <span class="n">max_y</span> <span class="o">*</span> <span class="mf">0.75</span><span class="p">),</span> 
             <span class="mf">0.4</span><span class="p">:</span> <span class="p">(</span><span class="n">max_x</span> <span class="o">*</span> <span class="mf">0.4</span><span class="p">,</span> <span class="n">max_y</span> <span class="o">*</span> <span class="mf">0.65</span><span class="p">),</span> 
             <span class="mf">0.2</span><span class="p">:</span> <span class="p">(</span><span class="n">max_x</span> <span class="o">*</span> <span class="mf">0.6</span><span class="p">,</span> <span class="n">max_y</span> <span class="o">*</span> <span class="mf">0.5</span><span class="p">)}</span>

<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">bcr_texts</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
    <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="mf">1.0</span><span class="p">:</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">bcr_texts</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">bcr_texts</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span> <span class="sa">f</span><span class="s1">&#39;BCR = </span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span> <span class="n">verticalalignment</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span> <span class="n">horizontalalignment</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span> <span class="n">bbox</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">facecolor</span><span class="o">=</span><span class="s1">&#39;white&#39;</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">))</span>
    <span class="k">else</span><span class="p">:</span>   
        <span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">bcr_texts</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">bcr_texts</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span> <span class="sa">f</span><span class="s1">&#39;BCR = </span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span> <span class="n">verticalalignment</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span> <span class="n">horizontalalignment</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span> <span class="n">bbox</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">facecolor</span><span class="o">=</span><span class="s1">&#39;white&#39;</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s1">&#39;grey&#39;</span><span class="p">))</span>

<span class="n">markers</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;baseline&#39;</span><span class="p">:</span> <span class="s1">&#39;o&#39;</span><span class="p">,</span>  <span class="c1"># empty circle</span>
    <span class="s1">&#39;l1&#39;</span><span class="p">:</span> <span class="s1">&#39;o&#39;</span><span class="p">,</span>        <span class="c1"># full circle</span>
    <span class="s1">&#39;l2&#39;</span><span class="p">:</span> <span class="s1">&#39;^&#39;</span><span class="p">,</span>        <span class="c1"># triangle</span>
    <span class="s1">&#39;l3&#39;</span><span class="p">:</span> <span class="s1">&#39;s&#39;</span><span class="p">,</span>        <span class="c1"># square</span>
    <span class="s1">&#39;l4&#39;</span><span class="p">:</span> <span class="s1">&#39;d&#39;</span>         <span class="c1"># diamond</span>
<span class="p">}</span>

<span class="c1"># Create a dictionary to store handles for the legend</span>
<span class="n">handles</span> <span class="o">=</span> <span class="p">{}</span>
<span class="k">for</span> <span class="n">adapt_id</span> <span class="ow">in</span> <span class="n">adapt_ids_output</span><span class="p">:</span>
    <span class="k">if</span> <span class="s2">&quot;baseline&quot;</span> <span class="ow">in</span> <span class="n">adapt_id</span><span class="p">:</span><span class="k">continue</span>
    <span class="k">if</span> <span class="s2">&quot;rhine&quot;</span> <span class="ow">in</span> <span class="n">adapt_id</span><span class="p">:</span>
        <span class="n">study_area</span> <span class="o">=</span> <span class="s2">&quot;S1&quot;</span>
    <span class="k">elif</span> <span class="s2">&quot;trib&quot;</span> <span class="ow">in</span> <span class="n">adapt_id</span><span class="p">:</span>
        <span class="n">study_area</span> <span class="o">=</span> <span class="s2">&quot;S2&quot;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">study_area</span> <span class="o">=</span> <span class="s2">&quot;NA&quot;</span>

    <span class="k">for</span> <span class="n">inc_f</span> <span class="ow">in</span> <span class="n">increase_factors_bounds</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">bcr_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[(</span><span class="n">adapt_id</span><span class="p">,</span> <span class="n">inc_f</span><span class="p">),</span> <span class="s1">&#39;total_adaptation_cost&#39;</span><span class="p">]</span>
        <span class="n">y</span> <span class="o">=</span> <span class="n">bcr_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[(</span><span class="n">adapt_id</span><span class="p">,</span> <span class="n">inc_f</span><span class="p">),</span> <span class="s1">&#39;total_avoided_damages_mean&#39;</span><span class="p">]</span>
        <span class="n">yerr</span> <span class="o">=</span> <span class="p">[[</span><span class="n">y</span> <span class="o">-</span> <span class="n">bcr_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[(</span><span class="n">adapt_id</span><span class="p">,</span> <span class="n">inc_f</span><span class="p">),</span> <span class="s1">&#39;total_avoided_damages_lower&#39;</span><span class="p">]],</span> <span class="p">[</span><span class="n">bcr_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[(</span><span class="n">adapt_id</span><span class="p">,</span> <span class="n">inc_f</span><span class="p">),</span> <span class="s1">&#39;total_avoided_damages_upper&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">y</span><span class="p">]]</span>
                
        <span class="n">marker_style</span> <span class="o">=</span> <span class="n">markers</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">adapt_id</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">],</span> <span class="s1">&#39;x&#39;</span><span class="p">)</span>
        <span class="n">markerfacecolor</span> <span class="o">=</span> <span class="s1">&#39;none&#39;</span> <span class="k">if</span> <span class="n">adapt_id</span> <span class="o">==</span> <span class="s1">&#39;baseline&#39;</span> <span class="k">else</span> <span class="s1">&#39;black&#39;</span>
        
        <span class="k">if</span> <span class="n">inc_f</span> <span class="o">==</span> <span class="s1">&#39;mean&#39;</span><span class="p">:</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="p">(</span><span class="n">adapt_id</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span><span class="si">}</span><span class="s1">, </span><span class="si">{</span><span class="n">study_area</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="p">(</span><span class="n">x</span><span class="o">+</span><span class="mi">20</span><span class="p">,</span> <span class="n">y</span><span class="o">-</span><span class="mi">10</span><span class="p">))</span>
            <span class="n">handle</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">yerr</span><span class="o">=</span><span class="n">yerr</span><span class="p">,</span> <span class="n">fmt</span><span class="o">=</span><span class="n">marker_style</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">adapt_id</span><span class="si">}</span><span class="s1"> </span><span class="si">{</span><span class="n">inc_f</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">markerfacecolor</span><span class="o">=</span><span class="n">markerfacecolor</span><span class="p">,</span> <span class="n">markeredgecolor</span><span class="o">=</span><span class="s1">&#39;none&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;grey&#39;</span><span class="p">,</span> <span class="n">capsize</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>        
            <span class="n">generic_adapt_id</span> <span class="o">=</span> <span class="n">adapt_id</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">generic_adapt_id</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">handles</span><span class="p">:</span>
                <span class="n">handles</span><span class="p">[</span><span class="n">generic_adapt_id</span><span class="p">]</span> <span class="o">=</span> <span class="n">handle</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">handle</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">yerr</span><span class="o">=</span><span class="n">yerr</span><span class="p">,</span> <span class="n">fmt</span><span class="o">=</span><span class="n">marker_style</span><span class="p">,</span> <span class="n">markerfacecolor</span><span class="o">=</span><span class="n">markerfacecolor</span><span class="p">,</span> <span class="n">markeredgecolor</span><span class="o">=</span><span class="s1">&#39;none&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">capsize</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>        
            <span class="k">pass</span>
        
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Total adaptation cost (million EUR)&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Total avoided damages (million EUR)&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Total avoided damages vs total adaptation costs&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">([</span><span class="n">value</span> <span class="k">for</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">handles</span><span class="o">.</span><span class="n">values</span><span class="p">()],</span> <span class="p">[</span><span class="n">key</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">handles</span><span class="o">.</span><span class="n">keys</span><span class="p">()],</span> <span class="n">facecolor</span><span class="o">=</span><span class="s1">&#39;white&#39;</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">loc</span><span class="o">=</span><span class="s1">&#39;upper left&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../../_images/226fee538564e1c953da5a2946c6380e2226a3eb4bf60017223a385059925fc5.png" src="../../../_images/226fee538564e1c953da5a2946c6380e2226a3eb4bf60017223a385059925fc5.png" />
</div>
</div>
<p>Find adaptations that have a BCR greater than 1</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Find adaptations with BCR greater than 1 under all increase factors</span>
<span class="n">adaptations_with_bcr_greater_than_1</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">adapt_id</span> <span class="ow">in</span> <span class="n">adapt_ids_output</span><span class="p">:</span>
    <span class="n">bcr_values</span> <span class="o">=</span> <span class="n">bcr_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">adapt_id</span><span class="p">][</span><span class="s1">&#39;bcr_mean&#39;</span><span class="p">]</span>
    <span class="k">if</span> <span class="nb">all</span><span class="p">(</span><span class="n">bcr</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="k">for</span> <span class="n">bcr</span> <span class="ow">in</span> <span class="n">bcr_values</span><span class="p">):</span>
        <span class="n">adaptations_with_bcr_greater_than_1</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">adapt_id</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;No-regret: Adaptations with BCR greater than 1 under all increase factors: </span><span class="si">{</span><span class="n">adaptations_with_bcr_greater_than_1</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>

<span class="c1"># Find adaptations with BCR greater than 1 in at least one increase factor but not all 3</span>
<span class="n">adaptations_with_bcr_greater_than_1_some</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">adapt_id</span> <span class="ow">in</span> <span class="n">adapt_ids_output</span><span class="p">:</span>
    <span class="n">bcr_values</span> <span class="o">=</span> <span class="n">bcr_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">adapt_id</span><span class="p">][</span><span class="s1">&#39;bcr_mean&#39;</span><span class="p">]</span>
    <span class="k">if</span> <span class="nb">any</span><span class="p">(</span><span class="n">bcr</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="k">for</span> <span class="n">bcr</span> <span class="ow">in</span> <span class="n">bcr_values</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="nb">all</span><span class="p">(</span><span class="n">bcr</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="k">for</span> <span class="n">bcr</span> <span class="ow">in</span> <span class="n">bcr_values</span><span class="p">):</span>
        <span class="n">adaptations_with_bcr_greater_than_1_some</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">adapt_id</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Adaptations with BCR greater than 1 in at least one increase factor but not all 3: </span><span class="si">{</span><span class="n">adaptations_with_bcr_greater_than_1_some</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>

<span class="c1"># Find adaptations with BCR less than 1 in all increase factors</span>
<span class="n">adaptations_with_bcr_less_than_1</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">adapt_id</span> <span class="ow">in</span> <span class="n">adapt_ids_output</span><span class="p">:</span>
    <span class="n">bcr_values</span> <span class="o">=</span> <span class="n">bcr_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">adapt_id</span><span class="p">][</span><span class="s1">&#39;bcr_mean&#39;</span><span class="p">]</span>
    <span class="k">if</span> <span class="nb">all</span><span class="p">(</span><span class="n">bcr</span> <span class="o">&lt;</span> <span class="mi">1</span> <span class="k">for</span> <span class="n">bcr</span> <span class="ow">in</span> <span class="n">bcr_values</span><span class="p">):</span>
        <span class="n">adaptations_with_bcr_less_than_1</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">adapt_id</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Economically inefficient: Adaptations with BCR less than 1 in all increase factors: </span><span class="si">{</span><span class="n">adaptations_with_bcr_less_than_1</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>No-regret: Adaptations with BCR greater than 1 under all increase factors: []
Adaptations with BCR greater than 1 in at least one increase factor but not all 3: []
Economically inefficient: Adaptations with BCR less than 1 in all increase factors: [&#39;baseline&#39;, &#39;l1_trib&#39;, &#39;l2_trib&#39;, &#39;l3_trib&#39;, &#39;l4_trib&#39;]
</pre></div>
</div>
</div>
</div>
<p>Generate detailed output and maps</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Create a DataFrame with the benefits for each adaptation and increase factor by appending each new Series to the previous one</span>
<span class="n">avoided_damages_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>
<span class="k">for</span> <span class="n">adapt_id</span> <span class="ow">in</span> <span class="n">adapt_ids_output</span><span class="p">:</span>
    <span class="k">for</span> <span class="n">inc_f</span> <span class="ow">in</span> <span class="n">increase_factors_bounds</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
        <span class="n">new_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">avoided_damages_dict</span><span class="p">[</span><span class="n">adapt_id</span><span class="p">][</span><span class="n">inc_f</span><span class="p">],</span> <span class="n">name</span><span class="o">=</span><span class="p">(</span><span class="n">adapt_id</span><span class="p">,</span> <span class="n">inc_f</span><span class="p">))</span>
        <span class="n">avoided_damages_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">avoided_damages_df</span><span class="p">,</span> <span class="n">new_df</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

<span class="n">avoided_damages_df</span> <span class="o">=</span> <span class="n">avoided_damages_df</span><span class="o">.</span><span class="n">T</span>

<span class="n">avoided_damages_df</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Avoided Direct Y0 [M€/y]&#39;</span><span class="p">,</span> <span class="s1">&#39;Avoided Direct Y100 [M€/y]&#39;</span><span class="p">,</span> <span class="s1">&#39;Avoided Direct Total [M€]&#39;</span><span class="p">,</span> <span class="s1">&#39;Avoided Indirect Tributaries Y0 [M€/y]&#39;</span><span class="p">,</span> <span class="s1">&#39;Avoided Indirect Tributaries Y100 [M€/y]&#39;</span><span class="p">,</span> <span class="s1">&#39;Avoided Indirect Tributaries Total [M€]&#39;</span><span class="p">,</span> <span class="s1">&#39;Avoided Indirect Full Flood Y0 [M€/y]&#39;</span><span class="p">,</span> <span class="s1">&#39;Avoided Indirect Full Flood Y100 [M€/y]&#39;</span><span class="p">,</span> <span class="s1">&#39;Avoided Indirect Full Flood Total [M€]&#39;</span><span class="p">]</span>
<span class="n">avoided_damages_df</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">names</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Adaptation, Climate Change Increase Factor&#39;</span><span class="p">]</span>

<span class="n">avoided_damages_df</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">data_path</span> <span class="o">/</span> <span class="s1">&#39;output&#39;</span> <span class="o">/</span> <span class="s1">&#39;avoided_damages_df.csv&#39;</span><span class="p">)</span>
<span class="n">avoided_damages_df</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Avoided Direct Y0 [M€/y]</th>
      <th>Avoided Direct Y100 [M€/y]</th>
      <th>Avoided Direct Total [M€]</th>
      <th>Avoided Indirect Tributaries Y0 [M€/y]</th>
      <th>Avoided Indirect Tributaries Y100 [M€/y]</th>
      <th>Avoided Indirect Tributaries Total [M€]</th>
      <th>Avoided Indirect Full Flood Y0 [M€/y]</th>
      <th>Avoided Indirect Full Flood Y100 [M€/y]</th>
      <th>Avoided Indirect Full Flood Total [M€]</th>
    </tr>
    <tr>
      <th>Adaptation, Climate Change Increase Factor</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>(baseline, lower bound)</th>
      <td>[0.0, 0.0]</td>
      <td>[0.0, 0.0]</td>
      <td>[0.0, 0.0]</td>
      <td>0.000</td>
      <td>0.000</td>
      <td>0.000</td>
      <td>0.000</td>
      <td>0.000</td>
      <td>0.000</td>
    </tr>
    <tr>
      <th>(baseline, mean)</th>
      <td>[0.0, 0.0]</td>
      <td>[0.0, 0.0]</td>
      <td>[0.0, 0.0]</td>
      <td>0.000</td>
      <td>0.000</td>
      <td>0.000</td>
      <td>0.000</td>
      <td>0.000</td>
      <td>0.000</td>
    </tr>
    <tr>
      <th>(baseline, upper bound)</th>
      <td>[0.0, 0.0]</td>
      <td>[0.0, 0.0]</td>
      <td>[0.0, 0.0]</td>
      <td>0.000</td>
      <td>0.000</td>
      <td>0.000</td>
      <td>0.000</td>
      <td>0.000</td>
      <td>0.000</td>
    </tr>
    <tr>
      <th>(l1_trib, lower bound)</th>
      <td>[0.06795927397899026, 0.1906504913275655]</td>
      <td>[0.04049597579089148, 0.12230051654181584]</td>
      <td>[5.460906339647892, 15.94745720461816]</td>
      <td>0.046</td>
      <td>0.034</td>
      <td>4.200</td>
      <td>0.002</td>
      <td>0.001</td>
      <td>0.174</td>
    </tr>
    <tr>
      <th>(l1_trib, mean)</th>
      <td>[0.06795927397899026, 0.1906504913275655]</td>
      <td>[0.08663090809314511, 0.2572485346597566]</td>
      <td>[8.791211640861647, 25.6888413944138]</td>
      <td>0.046</td>
      <td>0.031</td>
      <td>3.938</td>
      <td>0.002</td>
      <td>0.001</td>
      <td>0.165</td>
    </tr>
    <tr>
      <th>(l1_trib, upper bound)</th>
      <td>[0.06795927397899026, 0.1906504913275655]</td>
      <td>[0.12862015399657034, 0.380294654293722]</td>
      <td>[11.822255607936285, 34.57107279828983]</td>
      <td>0.046</td>
      <td>0.028</td>
      <td>3.729</td>
      <td>0.002</td>
      <td>0.001</td>
      <td>0.157</td>
    </tr>
    <tr>
      <th>(l2_trib, lower bound)</th>
      <td>[0.19112371926527727, 0.45218484752808097]</td>
      <td>[0.12258613834127485, 0.30251878228882156]</td>
      <td>[15.985745881166629, 38.72263897122079]</td>
      <td>0.695</td>
      <td>0.420</td>
      <td>56.247</td>
      <td>0.108</td>
      <td>0.057</td>
      <td>8.139</td>
    </tr>
    <tr>
      <th>(l2_trib, mean)</th>
      <td>[0.19112371926527727, 0.45218484752808097]</td>
      <td>[0.2318685384791077, 0.5488260285897621]</td>
      <td>[23.874426721186182, 56.50262231896508]</td>
      <td>0.695</td>
      <td>0.605</td>
      <td>69.576</td>
      <td>0.108</td>
      <td>0.051</td>
      <td>7.704</td>
    </tr>
    <tr>
      <th>(l2_trib, upper bound)</th>
      <td>[0.19112371926527727, 0.45218484752808097]</td>
      <td>[0.3317004586537897, 0.7743284386349978]</td>
      <td>[31.080913354999893, 72.78078366295432]</td>
      <td>0.695</td>
      <td>0.774</td>
      <td>81.833</td>
      <td>0.108</td>
      <td>0.046</td>
      <td>7.323</td>
    </tr>
    <tr>
      <th>(l3_trib, lower bound)</th>
      <td>[0.0, 0.0]</td>
      <td>[0.0, 0.0]</td>
      <td>[0.0, 0.0]</td>
      <td>0.000</td>
      <td>0.000</td>
      <td>0.000</td>
      <td>0.000</td>
      <td>0.000</td>
      <td>0.000</td>
    </tr>
    <tr>
      <th>(l3_trib, mean)</th>
      <td>[0.0, 0.0]</td>
      <td>[0.0, 0.0]</td>
      <td>[0.0, 0.0]</td>
      <td>0.000</td>
      <td>0.000</td>
      <td>0.000</td>
      <td>0.000</td>
      <td>0.000</td>
      <td>0.000</td>
    </tr>
    <tr>
      <th>(l3_trib, upper bound)</th>
      <td>[0.0, 0.0]</td>
      <td>[0.0, 0.0]</td>
      <td>[0.0, 0.0]</td>
      <td>0.000</td>
      <td>0.000</td>
      <td>0.000</td>
      <td>0.000</td>
      <td>0.000</td>
      <td>0.000</td>
    </tr>
    <tr>
      <th>(l4_trib, lower bound)</th>
      <td>[0.0, 0.0]</td>
      <td>[0.0, 0.0]</td>
      <td>[0.0, 0.0]</td>
      <td>0.144</td>
      <td>0.081</td>
      <td>11.251</td>
      <td>0.145</td>
      <td>0.082</td>
      <td>11.324</td>
    </tr>
    <tr>
      <th>(l4_trib, mean)</th>
      <td>[0.0, 0.0]</td>
      <td>[0.0, 0.0]</td>
      <td>[0.0, 0.0]</td>
      <td>0.144</td>
      <td>0.117</td>
      <td>13.818</td>
      <td>0.145</td>
      <td>0.117</td>
      <td>13.887</td>
    </tr>
    <tr>
      <th>(l4_trib, upper bound)</th>
      <td>[0.0, 0.0]</td>
      <td>[0.0, 0.0]</td>
      <td>[0.0, 0.0]</td>
      <td>0.144</td>
      <td>0.149</td>
      <td>16.168</td>
      <td>0.145</td>
      <td>0.150</td>
      <td>16.234</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>Create geometries for visualisation</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">od_geoms</span> <span class="o">=</span> <span class="n">get_od_geoms_from_sps</span><span class="p">(</span><span class="n">shortest_paths</span><span class="p">,</span> <span class="n">graph_r0</span><span class="p">)</span>
<span class="n">od_geoms_plot</span><span class="o">=</span> <span class="n">gpd</span><span class="o">.</span><span class="n">GeoDataFrame</span><span class="p">(</span><span class="n">od_geoms</span><span class="p">)</span>
<span class="n">od_geoms_plot</span><span class="o">.</span><span class="n">crs</span> <span class="o">=</span> <span class="s1">&#39;EPSG:3857&#39;</span>
<span class="n">od_geoms_gdf</span> <span class="o">=</span> <span class="n">od_geoms_plot</span><span class="o">.</span><span class="n">to_crs</span><span class="p">(</span><span class="s1">&#39;EPSG:4326&#39;</span><span class="p">)</span>
<span class="n">od_geoms_plot</span><span class="o">.</span><span class="n">to_file</span><span class="p">(</span><span class="n">data_path</span> <span class="o">/</span> <span class="s1">&#39;output&#39;</span> <span class="o">/</span> <span class="s1">&#39;od_geoms_plot.geojson&#39;</span><span class="p">,</span> <span class="n">driver</span><span class="o">=</span><span class="s1">&#39;GeoJSON&#39;</span><span class="p">)</span>
<span class="n">shortest_paths_assets</span> <span class="o">=</span> <span class="n">get_asset_ids_from_sps</span><span class="p">(</span><span class="n">shortest_paths</span><span class="p">,</span> <span class="n">graph_r0</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Prepare geodataframe for plotting</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">basins_gdf</span> <span class="o">=</span> <span class="n">basins_gdf_0</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

<span class="c1"># Extract the geometries of the stretches of disrupted rail track</span>
<span class="n">rp_defs</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;L&#39;</span><span class="p">,</span> <span class="s1">&#39;M&#39;</span><span class="p">,</span> <span class="s1">&#39;H&#39;</span><span class="p">]</span>
<span class="n">disrupted_asset_ids</span> <span class="o">=</span> <span class="p">{</span><span class="n">rp_def</span><span class="p">:</span> <span class="p">[]</span> <span class="k">for</span> <span class="n">rp_def</span> <span class="ow">in</span> <span class="n">rp_defs</span><span class="p">}</span>
<span class="k">for</span> <span class="n">rp_def</span> <span class="ow">in</span> <span class="n">rp_defs</span><span class="p">:</span>
    <span class="k">for</span> <span class="n">hazard_map</span><span class="p">,</span> <span class="n">asset_dict</span> <span class="ow">in</span> <span class="n">collect_output</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="n">rp</span> <span class="o">=</span> <span class="n">hazard_map</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;_RW_&#39;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">rp</span> <span class="o">!=</span> <span class="n">rp_def</span><span class="p">:</span>
            <span class="k">continue</span>

        <span class="n">overlay_assets</span> <span class="o">=</span> <span class="n">load_baseline_run</span><span class="p">(</span><span class="n">hazard_map</span><span class="p">,</span> <span class="n">interim_data_path</span><span class="p">,</span> <span class="n">only_overlay</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">disrupted_asset_ids</span><span class="p">[</span><span class="n">rp_def</span><span class="p">]</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">overlay_assets</span><span class="o">.</span><span class="n">asset</span><span class="o">.</span><span class="n">unique</span><span class="p">())</span>

<span class="c1"># Filter out assets that are bridges or tunnels</span>
<span class="n">disrupted_asset_ids_filt</span> <span class="o">=</span> <span class="p">{</span><span class="n">rp_def</span><span class="p">:</span> <span class="p">[]</span> <span class="k">for</span> <span class="n">rp_def</span> <span class="ow">in</span> <span class="n">rp_defs</span><span class="p">}</span>
<span class="k">for</span> <span class="n">rp_def</span><span class="p">,</span> <span class="n">asset_ids</span> <span class="ow">in</span> <span class="n">disrupted_asset_ids</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
    <span class="k">for</span> <span class="n">asset_id</span> <span class="ow">in</span> <span class="n">asset_ids</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">assets</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">asset_id</span><span class="p">,</span> <span class="s1">&#39;bridge&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">assets</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">asset_id</span><span class="p">,</span> <span class="s1">&#39;tunnel&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">disrupted_asset_ids_filt</span><span class="p">[</span><span class="n">rp_def</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">asset_id</span><span class="p">)</span>

<span class="c1"># Prepare gdf for plotting</span>
<span class="n">basins_gdf</span> <span class="o">=</span> <span class="n">basins_gdf_0</span><span class="p">[</span><span class="n">basins_gdf_0</span><span class="p">[</span><span class="s1">&#39;HYBAS_ID&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">eadD_bl_by_ts_basin_incf</span><span class="p">[</span><span class="s1">&#39;mean&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">())]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="n">basin_list</span><span class="o">=</span><span class="n">basins_gdf</span><span class="o">.</span><span class="n">HYBAS_ID</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>

<span class="n">basins_gdf</span><span class="p">[</span><span class="s1">&#39;Average EAD_D_bl_t0&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">eadD_bl_by_ts_basin_incf</span><span class="p">[</span><span class="s1">&#39;mean&#39;</span><span class="p">][</span><span class="n">basin</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span> <span class="k">for</span> <span class="n">basin</span> <span class="ow">in</span> <span class="n">basin_list</span><span class="p">]</span>
<span class="n">basins_gdf</span><span class="p">[</span><span class="s1">&#39;Average EAD_D_bl_t100&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">eadD_bl_by_ts_basin_incf</span><span class="p">[</span><span class="s1">&#39;mean&#39;</span><span class="p">][</span><span class="n">basin</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span> <span class="k">for</span> <span class="n">basin</span> <span class="ow">in</span> <span class="n">basin_list</span><span class="p">]</span>
<span class="n">basins_gdf</span><span class="p">[</span><span class="s1">&#39;EAD_ID_bl_t0&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.0</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">basin</span> <span class="ow">in</span> <span class="n">eadIT_bl_by_ts_basin_incf</span><span class="p">[</span><span class="s1">&#39;mean&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span> <span class="k">else</span> <span class="n">eadIT_bl_by_ts_basin_incf</span><span class="p">[</span><span class="s1">&#39;mean&#39;</span><span class="p">][</span><span class="n">basin</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">basin</span> <span class="ow">in</span> <span class="n">basin_list</span><span class="p">]</span>
<span class="n">basins_gdf</span><span class="p">[</span><span class="s1">&#39;EAD_ID_bl_t100&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.0</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">basin</span> <span class="ow">in</span> <span class="n">eadIT_bl_by_ts_basin_incf</span><span class="p">[</span><span class="s1">&#39;mean&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span> <span class="k">else</span> <span class="n">eadIT_bl_by_ts_basin_incf</span><span class="p">[</span><span class="s1">&#39;mean&#39;</span><span class="p">][</span><span class="n">basin</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">basin</span> <span class="ow">in</span> <span class="n">basin_list</span><span class="p">]</span>

<span class="n">basins_gdf_reduced</span> <span class="o">=</span> <span class="n">basins_gdf</span><span class="p">[[</span><span class="s1">&#39;HYBAS_ID&#39;</span><span class="p">,</span> <span class="s1">&#39;geometry&#39;</span><span class="p">,</span> <span class="s1">&#39;Average EAD_D_bl_t0&#39;</span><span class="p">,</span> <span class="s1">&#39;Average EAD_D_bl_t100&#39;</span><span class="p">,</span> <span class="s1">&#39;EAD_ID_bl_t0&#39;</span><span class="p">,</span> <span class="s1">&#39;EAD_ID_bl_t100&#39;</span><span class="p">]]</span>
</pre></div>
</div>
</div>
</div>
<p>Set plotting style</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># import matplotlib.colors as mcolors</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.patches</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">mpatches</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">mpl</span>

<span class="c1">#Plotting prep</span>
<span class="c1"># dic_colors = {&#39;H&#39;: &#39;#f03b20&#39;, &#39;M&#39;: &#39;#feb24c&#39;, &#39;L&#39;: &#39;#ffeda0&#39;} # Yellow, orange, red</span>
<span class="n">dic_colors</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;H&#39;</span><span class="p">:</span> <span class="s1">&#39;#9ecae1&#39;</span><span class="p">,</span> <span class="s1">&#39;M&#39;</span><span class="p">:</span> <span class="s1">&#39;#3182bd&#39;</span><span class="p">,</span> <span class="s1">&#39;L&#39;</span><span class="p">:</span> <span class="s1">&#39;#08519c&#39;</span><span class="p">}</span> <span class="c1"># Blues</span>

<span class="n">main_basin_list</span> <span class="o">=</span> <span class="n">basin_list_full_flood</span> <span class="o">-</span> <span class="nb">set</span><span class="p">(</span><span class="n">basin_list_tributaries</span><span class="p">)</span>
<span class="n">assets_4326_clipped</span> <span class="o">=</span> <span class="n">gpd</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="n">assets</span><span class="o">.</span><span class="n">to_crs</span><span class="p">(</span><span class="mi">4326</span><span class="p">),</span> <span class="n">regions_gdf</span><span class="p">)</span>
<span class="n">basins_gdf_reduced_clipped</span> <span class="o">=</span> <span class="n">gpd</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="n">basins_gdf_reduced</span><span class="p">,</span> <span class="n">regions_gdf</span><span class="p">)</span>
<span class="c1"># Set the font colors</span>
<span class="n">default_mpl_color</span> <span class="o">=</span> <span class="n">miraca_colors</span><span class="p">[</span><span class="s1">&#39;grey_900&#39;</span><span class="p">]</span>
<span class="n">mpl</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;text.color&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">default_mpl_color</span>
<span class="n">mpl</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;axes.labelcolor&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">default_mpl_color</span>
<span class="n">mpl</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;xtick.color&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">default_mpl_color</span>
<span class="n">mpl</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;ytick.color&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">default_mpl_color</span>

<span class="n">fontsize_set</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;large&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;title&#39;</span><span class="p">:</span> <span class="mi">42</span><span class="p">,</span> <span class="s1">&#39;label&#39;</span><span class="p">:</span> <span class="mi">38</span><span class="p">,</span> <span class="s1">&#39;legend&#39;</span><span class="p">:</span> <span class="mi">20</span><span class="p">,</span> <span class="s1">&#39;ticks&#39;</span><span class="p">:</span> <span class="mi">28</span><span class="p">,</span> <span class="s1">&#39;legend_title&#39;</span><span class="p">:</span> <span class="mi">20</span><span class="p">,</span> <span class="s1">&#39;legend_label&#39;</span><span class="p">:</span> <span class="mi">20</span><span class="p">,</span> <span class="s1">&#39;suptitle&#39;</span><span class="p">:</span> <span class="mi">16</span><span class="p">},</span>
    <span class="s1">&#39;small&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;title&#39;</span><span class="p">:</span> <span class="mi">24</span><span class="p">,</span> <span class="s1">&#39;label&#39;</span><span class="p">:</span> <span class="mi">24</span><span class="p">,</span> <span class="s1">&#39;legend&#39;</span><span class="p">:</span> <span class="mi">18</span><span class="p">,</span> <span class="s1">&#39;ticks&#39;</span><span class="p">:</span> <span class="mi">16</span><span class="p">,</span> <span class="s1">&#39;legend_title&#39;</span><span class="p">:</span> <span class="mi">18</span><span class="p">,</span> <span class="s1">&#39;legend_label&#39;</span><span class="p">:</span> <span class="mi">18</span><span class="p">,</span> <span class="s1">&#39;suptitle&#39;</span><span class="p">:</span> <span class="mi">12</span><span class="p">},</span>
    <span class="s1">&#39;default_miraca&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;title&#39;</span><span class="p">:</span> <span class="mi">42</span><span class="p">,</span> <span class="s1">&#39;label&#39;</span><span class="p">:</span> <span class="mi">38</span><span class="p">,</span> <span class="s1">&#39;legend&#39;</span><span class="p">:</span> <span class="mi">20</span><span class="p">,</span> <span class="s1">&#39;ticks&#39;</span><span class="p">:</span> <span class="mi">28</span><span class="p">,</span> <span class="s1">&#39;legend_title&#39;</span><span class="p">:</span> <span class="mi">20</span><span class="p">,</span> <span class="s1">&#39;legend_label&#39;</span><span class="p">:</span> <span class="mi">20</span><span class="p">,</span> <span class="s1">&#39;suptitle&#39;</span><span class="p">:</span> <span class="mi">16</span><span class="p">}</span>
<span class="p">}</span>

<span class="n">mainfont</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;fontname&#39;</span><span class="p">:</span> <span class="s1">&#39;Arial&#39;</span><span class="p">}</span>
<span class="c1"># mainfont = {&#39;fontname&#39;: &#39;Space Grotesk&#39;}</span>
<span class="n">basefont</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;fontname&#39;</span><span class="p">:</span> <span class="s1">&#39;Calibri&#39;</span><span class="p">}</span>

<span class="c1"># Define the size set to use</span>
<span class="n">size_set</span> <span class="o">=</span> <span class="n">fontsize_set</span><span class="p">[</span><span class="s1">&#39;small&#39;</span><span class="p">]</span>  <span class="c1"># Change to &#39;large&#39; or &#39;small&#39; as needed</span>
</pre></div>
</div>
</div>
</div>
<p>Generate plot of damages and losses aggregated by tributaries</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Plot</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">axs</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span> <span class="mi">20</span><span class="p">))</span>
<span class="c1"># Direct damages</span>
<span class="c1"># Plot for year 0</span>
<span class="n">ax</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span>
<span class="n">vmax_dd</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="nb">max</span><span class="p">([</span><span class="n">eadD_bl_by_ts_basin_incf</span><span class="p">[</span><span class="s1">&#39;mean&#39;</span><span class="p">][</span><span class="n">basin</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="k">for</span> <span class="n">basin</span> <span class="ow">in</span> <span class="n">eadD_bl_by_ts_basin_incf</span><span class="p">[</span><span class="s1">&#39;mean&#39;</span><span class="p">]])</span> <span class="o">/</span> <span class="mf">10.0</span><span class="p">)</span> <span class="o">*</span> <span class="mi">10</span>
<span class="n">basins_gdf_reduced_clipped</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">column</span><span class="o">=</span><span class="s1">&#39;Average EAD_D_bl_t0&#39;</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">axs</span><span class="p">[</span><span class="n">ax</span><span class="p">],</span> <span class="n">legend</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;Reds&#39;</span><span class="p">,</span> <span class="n">vmin</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="n">vmax_dd</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.8</span><span class="p">)</span>
<span class="n">basins_gdf_reduced_clipped</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">axs</span><span class="p">[</span><span class="n">ax</span><span class="p">],</span> <span class="n">edgecolor</span><span class="o">=</span><span class="n">miraca_colors</span><span class="p">[</span><span class="s1">&#39;grey_200&#39;</span><span class="p">],</span> <span class="n">facecolor</span><span class="o">=</span><span class="s2">&quot;None&quot;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="n">ax</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Current climate&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">size_set</span><span class="p">[</span><span class="s1">&#39;title&#39;</span><span class="p">],</span> <span class="n">fontweight</span><span class="o">=</span><span class="s1">&#39;bold&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">mainfont</span><span class="p">)</span>
<span class="c1"># Plot for year 100</span>
<span class="n">ax</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span>
<span class="n">valid_asset_ids</span> <span class="o">=</span> <span class="p">[</span><span class="n">asset_id</span> <span class="k">for</span> <span class="n">asset_id</span> <span class="ow">in</span> <span class="n">asset_ids</span> <span class="k">if</span> <span class="n">asset_id</span> <span class="ow">in</span> <span class="n">assets_4326_clipped</span><span class="o">.</span><span class="n">index</span><span class="p">]</span>
<span class="n">basins_gdf_reduced_clipped</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">column</span><span class="o">=</span><span class="s1">&#39;Average EAD_D_bl_t100&#39;</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">axs</span><span class="p">[</span><span class="n">ax</span><span class="p">],</span> <span class="n">legend</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;Reds&#39;</span><span class="p">,</span> <span class="n">vmin</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="n">vmax_dd</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.8</span><span class="p">)</span>
<span class="n">basins_gdf_reduced_clipped</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">axs</span><span class="p">[</span><span class="n">ax</span><span class="p">],</span> <span class="n">edgecolor</span><span class="o">=</span><span class="n">miraca_colors</span><span class="p">[</span><span class="s1">&#39;grey_200&#39;</span><span class="p">],</span> <span class="n">facecolor</span><span class="o">=</span><span class="s2">&quot;None&quot;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="n">ax</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Future climate (Future B)&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">size_set</span><span class="p">[</span><span class="s1">&#39;title&#39;</span><span class="p">],</span> <span class="n">fontweight</span><span class="o">=</span><span class="s1">&#39;bold&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">mainfont</span><span class="p">)</span>
<span class="c1"># Add color bar and legend</span>
<span class="n">sm1</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">ScalarMappable</span><span class="p">(</span><span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;Reds&#39;</span><span class="p">,</span> <span class="n">norm</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">Normalize</span><span class="p">(</span><span class="n">vmin</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="n">vmax_dd</span><span class="p">))</span>
<span class="n">cbar1</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">sm1</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">axs</span><span class="p">[</span><span class="n">ax</span><span class="p">])</span>
<span class="n">cbar1</span><span class="o">.</span><span class="n">set_label</span><span class="p">(</span><span class="s1">&#39;Direct Expected Annual Damages [Million €/year]&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">size_set</span><span class="p">[</span><span class="s1">&#39;label&#39;</span><span class="p">],</span> <span class="o">**</span><span class="n">mainfont</span><span class="p">)</span>
<span class="n">cbar1</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">labelsize</span><span class="o">=</span><span class="n">size_set</span><span class="p">[</span><span class="s1">&#39;ticks&#39;</span><span class="p">])</span>
<span class="n">rp_letter_equiv</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;H&#39;</span><span class="p">:</span> <span class="s1">&#39;RP10&#39;</span><span class="p">,</span> <span class="s1">&#39;M&#39;</span><span class="p">:</span> <span class="s1">&#39;RP100&#39;</span><span class="p">,</span> <span class="s1">&#39;L&#39;</span><span class="p">:</span> <span class="s1">&#39;RP200&#39;</span><span class="p">}</span>
<span class="n">legend_elements</span> <span class="o">=</span> <span class="p">[</span><span class="n">mpatches</span><span class="o">.</span><span class="n">Patch</span><span class="p">(</span><span class="n">facecolor</span><span class="o">=</span><span class="n">dic_colors</span><span class="p">[</span><span class="n">rp_def</span><span class="p">],</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">rp_letter_equiv</span><span class="p">[</span><span class="n">rp_def</span><span class="p">])</span> <span class="k">for</span> <span class="n">rp_def</span> <span class="ow">in</span> <span class="n">disrupted_asset_ids_filt</span><span class="o">.</span><span class="n">keys</span><span class="p">()]</span>
<span class="n">axs</span><span class="p">[</span><span class="n">ax</span><span class="p">]</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">handles</span><span class="o">=</span><span class="n">legend_elements</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s1">&#39;Disrupted Assets&#39;</span><span class="p">,</span> <span class="n">loc</span><span class="o">=</span><span class="s1">&#39;upper left&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">size_set</span><span class="p">[</span><span class="s1">&#39;legend_label&#39;</span><span class="p">],</span> <span class="n">title_fontsize</span><span class="o">=</span><span class="n">size_set</span><span class="p">[</span><span class="s1">&#39;legend_title&#39;</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">setp</span><span class="p">(</span><span class="n">axs</span><span class="p">[</span><span class="n">ax</span><span class="p">]</span><span class="o">.</span><span class="n">texts</span><span class="p">,</span> <span class="n">family</span><span class="o">=</span><span class="s1">&#39;Space Grotesk&#39;</span><span class="p">)</span>

<span class="c1"># Indirect losses, tributary basins</span>
<span class="c1"># Plot for year 0</span>
<span class="n">ax</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span>
<span class="n">vmax_id</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="nb">max</span><span class="p">([</span><span class="n">eadIT_bl_by_ts_basin_incf</span><span class="p">[</span><span class="s1">&#39;mean&#39;</span><span class="p">][</span><span class="n">basin</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="k">for</span> <span class="n">basin</span> <span class="ow">in</span> <span class="n">eadIT_bl_by_ts_basin_incf</span><span class="p">[</span><span class="s1">&#39;mean&#39;</span><span class="p">]]))</span>
<span class="n">basins_gdf_reduced_clipped</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">column</span><span class="o">=</span><span class="s1">&#39;EAD_ID_bl_t0&#39;</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">axs</span><span class="p">[</span><span class="n">ax</span><span class="p">],</span> <span class="n">legend</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;Purples&#39;</span><span class="p">,</span> <span class="n">vmin</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="n">vmax_id</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.8</span><span class="p">)</span>
<span class="n">basins_gdf_reduced_clipped</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">axs</span><span class="p">[</span><span class="n">ax</span><span class="p">],</span> <span class="n">edgecolor</span><span class="o">=</span><span class="n">miraca_colors</span><span class="p">[</span><span class="s1">&#39;grey_200&#39;</span><span class="p">],</span> <span class="n">facecolor</span><span class="o">=</span><span class="s2">&quot;None&quot;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">basins_gdf_reduced_clipped</span><span class="p">[</span><span class="n">basins_gdf_reduced_clipped</span><span class="p">[</span><span class="s1">&#39;HYBAS_ID&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">main_basin_list</span><span class="p">)]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">axs</span><span class="p">[</span><span class="n">ax</span><span class="p">],</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s1">&#39;None&#39;</span><span class="p">,</span> <span class="n">facecolor</span><span class="o">=</span><span class="n">miraca_colors</span><span class="p">[</span><span class="s1">&#39;grey_500&#39;</span><span class="p">],</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">hatch</span><span class="o">=</span><span class="s1">&#39;//&#39;</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="n">ax</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">size_set</span><span class="p">[</span><span class="s1">&#39;title&#39;</span><span class="p">])</span>
<span class="c1"># Plot for year 100</span>
<span class="n">ax</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span>
<span class="n">basins_gdf_reduced_clipped</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">column</span><span class="o">=</span><span class="s1">&#39;EAD_ID_bl_t100&#39;</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">axs</span><span class="p">[</span><span class="n">ax</span><span class="p">],</span> <span class="n">legend</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;Purples&#39;</span><span class="p">,</span> <span class="n">vmin</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="mf">1.1</span><span class="o">*</span><span class="n">vmax_id</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.8</span><span class="p">)</span>
<span class="n">basins_gdf_reduced_clipped</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">axs</span><span class="p">[</span><span class="n">ax</span><span class="p">],</span> <span class="n">edgecolor</span><span class="o">=</span><span class="n">miraca_colors</span><span class="p">[</span><span class="s1">&#39;grey_200&#39;</span><span class="p">],</span> <span class="n">facecolor</span><span class="o">=</span><span class="s2">&quot;None&quot;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">basins_gdf_reduced_clipped</span><span class="p">[</span><span class="n">basins_gdf_reduced_clipped</span><span class="p">[</span><span class="s1">&#39;HYBAS_ID&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">main_basin_list</span><span class="p">)]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">axs</span><span class="p">[</span><span class="n">ax</span><span class="p">],</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s1">&#39;None&#39;</span><span class="p">,</span> <span class="n">facecolor</span><span class="o">=</span><span class="n">miraca_colors</span><span class="p">[</span><span class="s1">&#39;grey_500&#39;</span><span class="p">],</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">hatch</span><span class="o">=</span><span class="s1">&#39;//&#39;</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="n">ax</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">size_set</span><span class="p">[</span><span class="s1">&#39;title&#39;</span><span class="p">])</span>
<span class="c1"># Add color bar</span>
<span class="n">sm2</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">ScalarMappable</span><span class="p">(</span><span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;Purples&#39;</span><span class="p">,</span> <span class="n">norm</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">Normalize</span><span class="p">(</span><span class="n">vmin</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="n">vmax_id</span><span class="p">))</span>
<span class="n">cbar2</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">sm2</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">axs</span><span class="p">[</span><span class="n">ax</span><span class="p">],</span> <span class="n">ticks</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">])</span>
<span class="n">cbar2</span><span class="o">.</span><span class="n">set_label</span><span class="p">(</span><span class="s1">&#39;Indirect Expected Annual Losses [Million €/year]&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">size_set</span><span class="p">[</span><span class="s1">&#39;label&#39;</span><span class="p">],</span> <span class="o">**</span><span class="n">mainfont</span><span class="p">)</span>
<span class="n">cbar2</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">labelsize</span><span class="o">=</span><span class="n">size_set</span><span class="p">[</span><span class="s1">&#39;ticks&#39;</span><span class="p">])</span>

<span class="c1"># Plot static content</span>
<span class="k">for</span> <span class="n">ax</span> <span class="ow">in</span> <span class="n">axs</span><span class="o">.</span><span class="n">flat</span><span class="p">:</span>
    <span class="n">assets_4326_clipped</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">miraca_colors</span><span class="p">[</span><span class="s1">&#39;black&#39;</span><span class="p">],</span> <span class="n">lw</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">rp_def</span><span class="p">,</span> <span class="n">asset_ids</span> <span class="ow">in</span> <span class="n">disrupted_asset_ids_filt</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="n">valid_asset_ids</span> <span class="o">=</span> <span class="p">[</span><span class="n">asset_id</span> <span class="k">for</span> <span class="n">asset_id</span> <span class="ow">in</span> <span class="n">asset_ids</span> <span class="k">if</span> <span class="n">asset_id</span> <span class="ow">in</span> <span class="n">assets_4326_clipped</span><span class="o">.</span><span class="n">index</span><span class="p">]</span>
        <span class="n">assets_4326_clipped</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">valid_asset_ids</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">dic_colors</span><span class="p">[</span><span class="n">rp_def</span><span class="p">],</span> <span class="n">lw</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
    <span class="n">regions_gdf</span><span class="o">.</span><span class="n">boundary</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="n">miraca_colors</span><span class="p">[</span><span class="s1">&#39;blue_900&#39;</span><span class="p">],</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_axis_off</span><span class="p">()</span>

<span class="c1"># Label as A, B, C, D in the bottom right corner with a grey background and black text</span>
<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">ax</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">axs</span><span class="o">.</span><span class="n">flat</span><span class="p">):</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mf">0.98</span><span class="p">,</span> <span class="mf">0.05</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39; </span><span class="si">{</span><span class="nb">chr</span><span class="p">(</span><span class="mi">65</span><span class="o">+</span><span class="n">i</span><span class="p">)</span><span class="si">}</span><span class="s1"> &#39;</span><span class="p">,</span> <span class="n">transform</span><span class="o">=</span><span class="n">ax</span><span class="o">.</span><span class="n">transAxes</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">size_set</span><span class="p">[</span><span class="s1">&#39;title&#39;</span><span class="p">],</span> <span class="n">fontweight</span><span class="o">=</span><span class="s1">&#39;regular&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">ha</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span> <span class="n">va</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span> <span class="n">bbox</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">facecolor</span><span class="o">=</span><span class="s1">&#39;lightgrey&#39;</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">boxstyle</span><span class="o">=</span><span class="s1">&#39;square,pad=0.2&#39;</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="s1">&#39;Direct and Indirect Damages and Losses at Year 0 and 100 (Future B) [Baseline]&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">size_set</span><span class="p">[</span><span class="s1">&#39;suptitle&#39;</span><span class="p">],</span> <span class="n">fontweight</span><span class="o">=</span><span class="s1">&#39;bold&#39;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="mf">1.03</span><span class="p">,</span> <span class="o">**</span><span class="n">basefont</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.1</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;Adaptation: No adaptation&#39;</span><span class="p">,</span> <span class="n">ha</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span> <span class="n">va</span><span class="o">=</span><span class="s1">&#39;bottom&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">size_set</span><span class="p">[</span><span class="s1">&#39;suptitle&#39;</span><span class="p">],</span> <span class="n">transform</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span><span class="o">.</span><span class="n">transAxes</span><span class="p">,</span> <span class="o">**</span><span class="n">basefont</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../../_images/e5d9bebc2c2e669a813e2f82ce368a8d67bf17cc3eac849fea7831f74e9d7116.png" src="../../../_images/e5d9bebc2c2e669a813e2f82ce368a8d67bf17cc3eac849fea7831f74e9d7116.png" />
</div>
</div>
<p>Find the fraction of railways affected</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Save the exposed assets to a GeoJSON file</span>
<span class="k">for</span> <span class="n">rp_def</span><span class="p">,</span> <span class="n">asset_ids</span> <span class="ow">in</span> <span class="n">disrupted_asset_ids_filt</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
    <span class="n">valid_asset_ids</span> <span class="o">=</span> <span class="p">[</span><span class="n">asset_id</span> <span class="k">for</span> <span class="n">asset_id</span> <span class="ow">in</span> <span class="n">asset_ids</span> <span class="k">if</span> <span class="n">asset_id</span> <span class="ow">in</span> <span class="n">assets_4326_clipped</span><span class="o">.</span><span class="n">index</span><span class="p">]</span>
    <span class="n">assets_4326_clipped</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">valid_asset_ids</span><span class="p">]</span><span class="o">.</span><span class="n">to_parquet</span><span class="p">(</span><span class="n">data_path</span> <span class="o">/</span> <span class="s1">&#39;output&#39;</span> <span class="o">/</span> <span class="s1">&#39;impacts&#39;</span> <span class="o">/</span> <span class="sa">f</span><span class="s1">&#39;exposed_assets_</span><span class="si">{</span><span class="n">rp_def</span><span class="si">}</span><span class="s1">.pq&#39;</span><span class="p">)</span>

<span class="n">output_disruption_summary_path</span> <span class="o">=</span> <span class="n">data_path</span> <span class="o">/</span> <span class="s1">&#39;output&#39;</span> <span class="o">/</span> <span class="s1">&#39;disruption_summary.csv&#39;</span>
<span class="n">calculate_disruption_summary</span><span class="p">(</span><span class="n">disrupted_asset_ids_filt</span><span class="p">,</span> <span class="n">assets_4326_clipped</span><span class="p">,</span> <span class="n">assets</span><span class="p">,</span> <span class="n">save_to_csv</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">output_path</span><span class="o">=</span><span class="n">output_disruption_summary_path</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Total exposed assets: 73
Total assets: 537
Fraction of disrupted assets: 0.14
Fraction of disrupted asset by length: 0.23
</pre></div>
</div>
</div>
</div>
<p>Zooming to the areas with adapted assets</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Plot</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">axs</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">10</span><span class="p">))</span>

<span class="c1"># Find value max for color bars assuming baseline conditions have higher damages than adapted conditions</span>
<span class="n">baseline_basins_gdf</span> <span class="o">=</span> <span class="n">prep_adapted_basins_gdf</span><span class="p">(</span><span class="n">basins_gdf_0</span><span class="p">,</span> <span class="n">eadD_ad_by_ts_basin_incf</span><span class="p">,</span> <span class="n">eadIT_ad_by_ts_basin_incf</span><span class="p">,</span> <span class="n">adapt_id</span><span class="o">=</span><span class="s1">&#39;baseline&#39;</span><span class="p">,</span> <span class="n">inc_f</span><span class="o">=</span><span class="s1">&#39;mean&#39;</span><span class="p">,</span> <span class="n">clipping_gdf</span><span class="o">=</span><span class="n">regions_gdf</span><span class="p">)</span>
<span class="n">vmax_dd</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="nb">max</span><span class="p">([</span><span class="n">baseline_basins_gdf</span><span class="p">[</span><span class="s1">&#39;Average EAD_D_ad_t0&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">(),</span> <span class="n">baseline_basins_gdf</span><span class="p">[</span><span class="s1">&#39;Average EAD_D_ad_t100&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">()])</span> <span class="o">/</span> <span class="mf">10.0</span><span class="p">)</span> <span class="o">*</span> <span class="mi">10</span>
<span class="n">vmax_id</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="nb">max</span><span class="p">([</span><span class="n">baseline_basins_gdf</span><span class="p">[</span><span class="s1">&#39;EAD_ID_ad_t0&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">(),</span> <span class="n">baseline_basins_gdf</span><span class="p">[</span><span class="s1">&#39;EAD_ID_ad_t100&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">()]))</span> 
<span class="n">adapted_basins_list</span> <span class="o">=</span> <span class="n">find_adapted_basin</span><span class="p">(</span><span class="n">eadD_ad_by_ts_basin_incf</span><span class="p">,</span> <span class="n">eadIT_ad_by_ts_basin_incf</span><span class="p">,</span> <span class="n">adapt_id</span><span class="o">=</span><span class="s1">&#39;l1_trib&#39;</span><span class="p">)</span>
<span class="c1"># xmin, ymin, xmax, ymax = basins_gdf[basins_gdf[&#39;HYBAS_ID&#39;]==2080430320].total_bounds</span>
<span class="n">xmin</span><span class="p">,</span> <span class="n">ymin</span><span class="p">,</span> <span class="n">xmax</span><span class="p">,</span> <span class="n">ymax</span> <span class="o">=</span> <span class="n">basins_gdf</span><span class="p">[</span><span class="n">basins_gdf</span><span class="p">[</span><span class="s1">&#39;HYBAS_ID&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">adapted_basins_list</span><span class="p">)]</span><span class="o">.</span><span class="n">total_bounds</span>
<span class="n">buffer</span> <span class="o">=</span> <span class="mf">0.05</span>
<span class="n">xmin</span> <span class="o">-=</span> <span class="n">buffer</span>
<span class="n">ymin</span> <span class="o">-=</span> <span class="n">buffer</span>
<span class="n">xmax</span> <span class="o">+=</span> <span class="n">buffer</span>
<span class="n">ymax</span> <span class="o">+=</span> <span class="n">buffer</span>

<span class="c1"># Plot standard elements for all subplots</span>
<span class="k">for</span> <span class="n">ax</span> <span class="ow">in</span> <span class="n">axs</span><span class="o">.</span><span class="n">flat</span><span class="p">:</span>
    <span class="n">assets_4326_clipped</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">miraca_colors</span><span class="p">[</span><span class="s1">&#39;black&#39;</span><span class="p">],</span> <span class="n">markersize</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">rp_def</span><span class="p">,</span> <span class="n">asset_ids</span> <span class="ow">in</span> <span class="n">disrupted_asset_ids_filt</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="n">valid_asset_ids</span> <span class="o">=</span> <span class="p">[</span><span class="n">asset_id</span> <span class="k">for</span> <span class="n">asset_id</span> <span class="ow">in</span> <span class="n">asset_ids</span> <span class="k">if</span> <span class="n">asset_id</span> <span class="ow">in</span> <span class="n">assets_4326_clipped</span><span class="o">.</span><span class="n">index</span><span class="p">]</span>
        <span class="n">assets_4326_clipped</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">valid_asset_ids</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">dic_colors</span><span class="p">[</span><span class="n">rp_def</span><span class="p">],</span> <span class="n">markersize</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
    <span class="n">baseline_basins_gdf</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="n">miraca_colors</span><span class="p">[</span><span class="s1">&#39;grey_200&#39;</span><span class="p">],</span> <span class="n">facecolor</span><span class="o">=</span><span class="s2">&quot;None&quot;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">regions_gdf</span><span class="o">.</span><span class="n">boundary</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="n">miraca_colors</span><span class="p">[</span><span class="s1">&#39;blue_900&#39;</span><span class="p">],</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>

    <span class="n">ax</span><span class="o">.</span><span class="n">set_axis_off</span><span class="p">()</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="n">xmin</span><span class="p">,</span> <span class="n">xmax</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="n">ymin</span><span class="p">,</span> <span class="n">ymax</span><span class="p">)</span>    

<span class="c1"># Level 1 adaptation</span>
<span class="c1"># Plot for year 100</span>
<span class="n">ax</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span>
<span class="n">adapt_id</span> <span class="o">=</span> <span class="s1">&#39;l1_trib&#39;</span>
<span class="n">adapted_basins_gdf</span> <span class="o">=</span> <span class="n">prep_adapted_basins_gdf</span><span class="p">(</span><span class="n">basins_gdf</span><span class="p">,</span> <span class="n">eadD_ad_by_ts_basin_incf</span><span class="p">,</span> <span class="n">eadIT_ad_by_ts_basin_incf</span><span class="p">,</span> <span class="n">adapt_id</span><span class="o">=</span><span class="n">adapt_id</span><span class="p">,</span> <span class="n">inc_f</span><span class="o">=</span><span class="s1">&#39;mean&#39;</span><span class="p">,</span> <span class="n">clipping_gdf</span><span class="o">=</span><span class="n">regions_gdf</span><span class="p">)</span>
<span class="n">adapted_basins_gdf</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">column</span><span class="o">=</span><span class="s1">&#39;Average EAD_D_ad_t100&#39;</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">axs</span><span class="p">[</span><span class="n">ax</span><span class="p">],</span> <span class="n">legend</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;Blues&#39;</span><span class="p">,</span> <span class="n">vmin</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="n">vmax_dd</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.8</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="n">ax</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Level 1 adaptation&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">,</span> <span class="n">fontweight</span><span class="o">=</span><span class="s1">&#39;bold&#39;</span><span class="p">)</span>
<span class="c1"># kevel 1 adaptation is a gdf of the protected area and a filter of the protected assets</span>
<span class="n">gdf_prot_area</span> <span class="o">=</span> <span class="n">gpd</span><span class="o">.</span><span class="n">read_file</span><span class="p">(</span><span class="n">data_path</span> <span class="o">/</span> <span class="s1">&#39;input&#39;</span> <span class="o">/</span> <span class="s1">&#39;adaptations&#39;</span> <span class="o">/</span>  <span class="s1">&#39;l1_tributary.geojson&#39;</span><span class="p">)</span>
<span class="n">assets_adapt</span><span class="o">=</span><span class="n">filter_assets_to_adapt</span><span class="p">(</span><span class="n">assets_4326_clipped</span><span class="o">.</span><span class="n">to_crs</span><span class="p">(</span><span class="mi">3857</span><span class="p">),</span> <span class="n">gdf_prot_area</span><span class="o">.</span><span class="n">to_crs</span><span class="p">(</span><span class="mi">3857</span><span class="p">))</span>
<span class="n">assets_adapt</span><span class="o">=</span><span class="n">assets_adapt</span><span class="o">.</span><span class="n">to_crs</span><span class="p">(</span><span class="mi">4326</span><span class="p">)</span>
<span class="n">gdf_prot_area</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">axs</span><span class="p">[</span><span class="n">ax</span><span class="p">],</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">facecolor</span><span class="o">=</span><span class="n">miraca_colors</span><span class="p">[</span><span class="s1">&#39;green_success&#39;</span><span class="p">],</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
<span class="n">assets_adapt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">axs</span><span class="p">[</span><span class="n">ax</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;green&#39;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>
<span class="n">assets_adapt</span><span class="o">.</span><span class="n">to_file</span><span class="p">(</span><span class="n">data_path</span> <span class="o">/</span> <span class="s1">&#39;output&#39;</span> <span class="o">/</span> <span class="s1">&#39;adaptations&#39;</span> <span class="o">/</span> <span class="s1">&#39;l1_tributary_assets.geojson&#39;</span><span class="p">,</span> <span class="n">driver</span><span class="o">=</span><span class="s1">&#39;GeoJSON&#39;</span><span class="p">)</span>

<span class="c1"># Level 2 adaptation</span>
<span class="c1"># Plot for year 100</span>
<span class="n">ax</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span>
<span class="n">adapt_id</span> <span class="o">=</span> <span class="s1">&#39;l2_trib&#39;</span>
<span class="n">adapted_basins_gdf</span> <span class="o">=</span> <span class="n">prep_adapted_basins_gdf</span><span class="p">(</span><span class="n">basins_gdf</span><span class="p">,</span> <span class="n">eadD_ad_by_ts_basin_incf</span><span class="p">,</span> <span class="n">eadIT_ad_by_ts_basin_incf</span><span class="p">,</span> <span class="n">adapt_id</span><span class="o">=</span><span class="n">adapt_id</span><span class="p">,</span> <span class="n">inc_f</span><span class="o">=</span><span class="s1">&#39;mean&#39;</span><span class="p">,</span> <span class="n">clipping_gdf</span><span class="o">=</span><span class="n">regions_gdf</span><span class="p">)</span>
<span class="n">adapted_basins_gdf</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">column</span><span class="o">=</span><span class="s1">&#39;Average EAD_D_ad_t100&#39;</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">axs</span><span class="p">[</span><span class="n">ax</span><span class="p">],</span> <span class="n">legend</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;Blues&#39;</span><span class="p">,</span> <span class="n">vmin</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="n">vmax_dd</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.8</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="n">ax</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Level 2 adaptation&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">,</span> <span class="n">fontweight</span><span class="o">=</span><span class="s1">&#39;bold&#39;</span><span class="p">)</span>
<span class="c1"># level 2 adaptation is a gdf of the filter of the protected assets</span>
<span class="n">gdf_prot_area</span> <span class="o">=</span> <span class="n">gpd</span><span class="o">.</span><span class="n">read_file</span><span class="p">(</span><span class="n">data_path</span> <span class="o">/</span> <span class="s1">&#39;input&#39;</span> <span class="o">/</span> <span class="s1">&#39;adaptations&#39;</span> <span class="o">/</span>  <span class="s1">&#39;l2_tributary.geojson&#39;</span><span class="p">)</span>
<span class="n">assets_adapt</span><span class="o">=</span><span class="n">filter_assets_to_adapt</span><span class="p">(</span><span class="n">assets_4326_clipped</span><span class="o">.</span><span class="n">to_crs</span><span class="p">(</span><span class="mi">3857</span><span class="p">),</span> <span class="n">gdf_prot_area</span><span class="o">.</span><span class="n">to_crs</span><span class="p">(</span><span class="mi">3857</span><span class="p">))</span>
<span class="n">assets_adapt</span><span class="o">=</span><span class="n">assets_adapt</span><span class="o">.</span><span class="n">to_crs</span><span class="p">(</span><span class="mi">4326</span><span class="p">)</span>
<span class="n">assets_adapt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">axs</span><span class="p">[</span><span class="n">ax</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;green&#39;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>
<span class="n">assets_adapt</span><span class="o">.</span><span class="n">to_file</span><span class="p">(</span><span class="n">data_path</span> <span class="o">/</span> <span class="s1">&#39;output&#39;</span> <span class="o">/</span> <span class="s1">&#39;adaptations&#39;</span> <span class="o">/</span> <span class="s1">&#39;l2_tributary_assets.geojson&#39;</span><span class="p">,</span> <span class="n">driver</span><span class="o">=</span><span class="s1">&#39;GeoJSON&#39;</span><span class="p">)</span>

<span class="c1"># Level 3 adaptation</span>
<span class="c1"># Plot for year 100</span>
<span class="n">ax</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span>
<span class="n">adapt_id</span> <span class="o">=</span> <span class="s1">&#39;l3_trib&#39;</span>
<span class="n">adapted_basins_gdf</span> <span class="o">=</span> <span class="n">prep_adapted_basins_gdf</span><span class="p">(</span><span class="n">basins_gdf</span><span class="p">,</span> <span class="n">eadD_ad_by_ts_basin_incf</span><span class="p">,</span> <span class="n">eadIT_ad_by_ts_basin_incf</span><span class="p">,</span> <span class="n">adapt_id</span><span class="o">=</span><span class="n">adapt_id</span><span class="p">,</span> <span class="n">inc_f</span><span class="o">=</span><span class="s1">&#39;mean&#39;</span><span class="p">,</span> <span class="n">clipping_gdf</span><span class="o">=</span><span class="n">regions_gdf</span><span class="p">)</span>
<span class="n">adapted_basins_gdf</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">column</span><span class="o">=</span><span class="s1">&#39;Average EAD_D_ad_t100&#39;</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">axs</span><span class="p">[</span><span class="n">ax</span><span class="p">],</span> <span class="n">legend</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;Blues&#39;</span><span class="p">,</span> <span class="n">vmin</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="n">vmax_dd</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.8</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="n">ax</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Level 3 adaptation&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">,</span> <span class="n">fontweight</span><span class="o">=</span><span class="s1">&#39;bold&#39;</span><span class="p">)</span>
<span class="c1"># level 3 adaptation is a gdf of new connections between the protected assets</span>
<span class="n">added_links</span> <span class="o">=</span> <span class="p">[(</span><span class="mi">219651487</span><span class="p">,</span> <span class="mi">111997047</span><span class="p">)]</span>
<span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">osm_id_pair</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">added_links</span><span class="p">):</span>
        <span class="n">graph_v</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">add_l3_adaptation</span><span class="p">(</span><span class="n">graph_r0</span><span class="p">,</span> <span class="n">osm_id_pair</span><span class="p">)</span>
<span class="n">gdf_l3_edges</span> <span class="o">=</span> <span class="n">get_l3_gdf</span><span class="p">(</span><span class="n">added_links</span><span class="p">,</span> <span class="n">graph_v</span><span class="p">)</span>
<span class="n">gdf_l3_edges</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">axs</span><span class="p">[</span><span class="n">ax</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;green&#39;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>
<span class="n">gdf_l3_edges</span><span class="o">.</span><span class="n">to_file</span><span class="p">(</span><span class="n">data_path</span> <span class="o">/</span> <span class="s1">&#39;output&#39;</span> <span class="o">/</span> <span class="s1">&#39;adaptations&#39;</span> <span class="o">/</span> <span class="s1">&#39;l3_tributary_edges_b.geojson&#39;</span><span class="p">,</span> <span class="n">driver</span><span class="o">=</span><span class="s1">&#39;GeoJSON&#39;</span><span class="p">)</span>

<span class="c1"># Level 4 adaptation</span>
<span class="c1"># Plot for year 100</span>
<span class="n">ax</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span>
<span class="n">adapt_id</span> <span class="o">=</span> <span class="s1">&#39;l4_trib&#39;</span>
<span class="n">adapted_basins_gdf</span> <span class="o">=</span> <span class="n">prep_adapted_basins_gdf</span><span class="p">(</span><span class="n">basins_gdf</span><span class="p">,</span> <span class="n">eadD_ad_by_ts_basin_incf</span><span class="p">,</span> <span class="n">eadIT_ad_by_ts_basin_incf</span><span class="p">,</span> <span class="n">adapt_id</span><span class="o">=</span><span class="n">adapt_id</span><span class="p">,</span> <span class="n">inc_f</span><span class="o">=</span><span class="s1">&#39;mean&#39;</span><span class="p">,</span> <span class="n">clipping_gdf</span><span class="o">=</span><span class="n">regions_gdf</span><span class="p">)</span>
<span class="n">adapted_basins_gdf</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">column</span><span class="o">=</span><span class="s1">&#39;Average EAD_D_ad_t100&#39;</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">axs</span><span class="p">[</span><span class="n">ax</span><span class="p">],</span> <span class="n">legend</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;Blues&#39;</span><span class="p">,</span> <span class="n">vmin</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="n">vmax_dd</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.8</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="n">ax</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Level 4 adaptation&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">,</span> <span class="n">fontweight</span><span class="o">=</span><span class="s1">&#39;bold&#39;</span><span class="p">)</span>
<span class="c1"># level 4 adaptation is a gdf with the assets in shortest paths with reduced demand</span>
<span class="n">adapted_route_area</span> <span class="o">=</span> <span class="n">gpd</span><span class="o">.</span><span class="n">read_file</span><span class="p">(</span><span class="n">data_path</span> <span class="o">/</span> <span class="s1">&#39;input&#39;</span> <span class="o">/</span> <span class="s1">&#39;adaptations&#39;</span> <span class="o">/</span>  <span class="s1">&#39;l4_tributary.geojson&#39;</span><span class="p">)</span>
<span class="n">demand_reduction_dict</span> <span class="o">=</span> <span class="n">add_l4_adaptation</span><span class="p">(</span><span class="n">graph_r0</span><span class="p">,</span> <span class="n">shortest_paths</span><span class="p">,</span> <span class="n">adapted_route_area</span><span class="o">.</span><span class="n">to_crs</span><span class="p">(</span><span class="mi">3857</span><span class="p">))</span>   
<span class="n">assets_in_paths</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">([</span><span class="n">asset_id</span> <span class="k">for</span> <span class="n">od</span><span class="p">,</span> <span class="p">(</span><span class="n">asset_ids</span><span class="p">,</span> <span class="n">demand</span><span class="p">)</span> <span class="ow">in</span> <span class="n">get_asset_ids_from_sps</span><span class="p">(</span><span class="n">shortest_paths</span><span class="p">,</span> <span class="n">graph_r0</span><span class="p">)</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">for</span> <span class="n">asset_id</span> <span class="ow">in</span> <span class="n">asset_ids</span> <span class="k">if</span> <span class="n">asset_id</span> <span class="o">!=</span> <span class="s1">&#39;&#39;</span><span class="p">]))</span>
<span class="n">assets_adapt</span><span class="o">=</span><span class="n">assets_4326_clipped</span><span class="p">[</span><span class="n">assets_4326_clipped</span><span class="p">[</span><span class="s1">&#39;osm_id&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">assets_in_paths</span><span class="p">)]</span>
<span class="n">assets_adapt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">axs</span><span class="p">[</span><span class="n">ax</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;green&#39;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>
<span class="n">assets_adapt</span><span class="o">.</span><span class="n">to_file</span><span class="p">(</span><span class="n">data_path</span> <span class="o">/</span> <span class="s1">&#39;output&#39;</span> <span class="o">/</span> <span class="s1">&#39;adaptations&#39;</span> <span class="o">/</span> <span class="s1">&#39;l4_tributary_assets.geojson&#39;</span><span class="p">,</span> <span class="n">driver</span><span class="o">=</span><span class="s1">&#39;GeoJSON&#39;</span><span class="p">)</span>

<span class="k">for</span> <span class="n">ax</span> <span class="ow">in</span> <span class="n">axs</span><span class="o">.</span><span class="n">flat</span><span class="p">:</span>
    <span class="n">od_geoms_plot</span><span class="o">.</span><span class="n">to_crs</span><span class="p">(</span><span class="mi">4326</span><span class="p">)</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="n">miraca_colors</span><span class="p">[</span><span class="s1">&#39;black&#39;</span><span class="p">],</span> <span class="n">facecolor</span><span class="o">=</span><span class="s2">&quot;None&quot;</span><span class="p">,</span> <span class="n">markersize</span><span class="o">=</span><span class="mi">40</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="s1">&#39;Direct Damages at Year 100 [Adapted]&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">,</span>
             <span class="n">fontweight</span><span class="o">=</span><span class="s1">&#39;bold&#39;</span><span class="p">,</span>
             <span class="n">y</span><span class="o">=</span><span class="mf">1.03</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">data_path</span> <span class="o">/</span> <span class="s1">&#39;output&#39;</span> <span class="o">/</span> <span class="s1">&#39;plots&#39;</span> <span class="o">/</span> <span class="s1">&#39;adaptations_disrupted_assets.png&#39;</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">300</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Applying adaptation: new connection between assets with osm_id  (219651487, 111997047)
Level 3 adaptation
Applying adaptation: shifted demand for routes:  [(&#39;node_682&#39;, &#39;node_684&#39;), (&#39;node_684&#39;, &#39;node_682&#39;), (&#39;node_260&#39;, &#39;node_387&#39;), (&#39;node_387&#39;, &#39;node_260&#39;), (&#39;node_387&#39;, &#39;node_434&#39;), (&#39;node_387&#39;, &#39;node_286&#39;), (&#39;node_434&#39;, &#39;node_387&#39;), (&#39;node_286&#39;, &#39;node_387&#39;)]
Level 4 adaptation
</pre></div>
</div>
<img alt="../../../_images/4a3e9f841980632f35b81333b6679d7e116d61895178b2662c793ffeaab03c21.png" src="../../../_images/4a3e9f841980632f35b81333b6679d7e116d61895178b2662c793ffeaab03c21.png" />
</div>
</div>
<p>Produce processed output tables</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Neat table of adaptations for both case studies with descending BCRs, benefits, and costs</span>
<span class="n">adaptation_table</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>
<span class="n">dict_tags_names</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;l1&#39;</span><span class="p">:</span> <span class="s1">&#39;L1: flood wall&#39;</span><span class="p">,</span> 
                         <span class="s1">&#39;l2&#39;</span><span class="p">:</span> <span class="s1">&#39;L2: elevate rail (viaduct)&#39;</span><span class="p">,</span> 
                         <span class="s1">&#39;l3&#39;</span><span class="p">:</span> <span class="s1">&#39;L3: build new connection&#39;</span><span class="p">,</span> 
                         <span class="s1">&#39;l4&#39;</span><span class="p">:</span> <span class="s1">&#39;L4: reduce demand&#39;</span><span class="p">,</span> 
                         <span class="s1">&#39;trib&#39;</span><span class="p">:</span> <span class="s1">&#39;Study Area 2&#39;</span><span class="p">,</span>
                         <span class="s1">&#39;rhine&#39;</span><span class="p">:</span> <span class="s1">&#39;Study Area 1&#39;</span><span class="p">,</span>
                         <span class="s1">&#39;baseline&#39;</span><span class="p">:</span> <span class="s1">&#39;No adaptation&#39;</span><span class="p">,</span>
                         <span class="s1">&#39;upper bound&#39;</span><span class="p">:</span> <span class="s1">&#39;Future C&#39;</span><span class="p">,</span>
                         <span class="s1">&#39;lower bound&#39;</span><span class="p">:</span> <span class="s1">&#39;Future A&#39;</span><span class="p">,</span> 
                         <span class="s1">&#39;mean&#39;</span><span class="p">:</span> <span class="s1">&#39;Future B&#39;</span><span class="p">}</span>

<span class="k">for</span> <span class="n">adapt_id</span> <span class="ow">in</span> <span class="n">adapt_ids_output</span><span class="p">:</span>
    <span class="k">if</span> <span class="n">adapt_id</span> <span class="o">==</span> <span class="s1">&#39;baseline&#39;</span><span class="p">:</span> <span class="k">continue</span>
    <span class="n">name_components</span> <span class="o">=</span> <span class="n">adapt_id</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">)</span>
    <span class="n">adaptation_name</span> <span class="o">=</span> <span class="n">dict_tags_names</span><span class="p">[</span><span class="n">name_components</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>
    <span class="n">study_area</span> <span class="o">=</span> <span class="n">dict_tags_names</span><span class="p">[</span><span class="n">name_components</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">name_components</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="k">else</span> <span class="s1">&#39;Unknown&#39;</span>
    <span class="k">for</span> <span class="n">inc_f</span> <span class="ow">in</span> <span class="n">increase_factors_bounds</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
        <span class="n">bcr_values</span> <span class="o">=</span> <span class="n">bcr_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">adapt_id</span><span class="p">][</span><span class="s1">&#39;bcr_&#39;</span><span class="o">+</span><span class="n">inc_f</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
        <span class="c1"># npv_values = npv_df.loc[adapt_id][&#39;npv_mean&#39;].mean()</span>
        <span class="n">benefits</span> <span class="o">=</span> <span class="n">benefits_dict</span><span class="p">[</span><span class="n">adapt_id</span><span class="p">][</span><span class="n">inc_f</span><span class="p">][</span><span class="s1">&#39;total_avoided_damages_full_period&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
        <span class="n">costs</span> <span class="o">=</span> <span class="n">processed_adaptation_costs</span><span class="p">[</span><span class="n">adapt_id</span><span class="p">]</span>
        <span class="c1"># new_row = pd.DataFrame({&#39;Adaptation&#39;: [adapt_id], &#39;BCR&#39;: [bcr_values], &#39;Benefits&#39;: [benefits], &#39;Costs&#39;: [costs]})</span>
        <span class="n">new_row</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s1">&#39;Adaptation&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">adaptation_name</span><span class="p">],</span> <span class="s1">&#39;Study Area&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">study_area</span><span class="p">],</span> <span class="s1">&#39;BCR&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">bcr_values</span><span class="p">],</span> <span class="s1">&#39;Benefits&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">benefits</span><span class="p">],</span> <span class="s1">&#39;Costs&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">costs</span><span class="p">]})</span>
        <span class="n">adaptation_table</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">adaptation_table</span><span class="p">,</span> <span class="n">new_row</span><span class="p">],</span> <span class="n">ignore_index</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="c1"># make study area a level for sorting and merge all the rows in a single cell</span>
<span class="n">adaptation_table</span><span class="p">[</span><span class="s1">&#39;Study Area&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Categorical</span><span class="p">(</span><span class="n">adaptation_table</span><span class="p">[</span><span class="s1">&#39;Study Area&#39;</span><span class="p">],</span> <span class="p">[</span><span class="s1">&#39;Study Area 1&#39;</span><span class="p">,</span> <span class="s1">&#39;Study Area 2&#39;</span><span class="p">,</span> <span class="s1">&#39;Unknown&#39;</span><span class="p">])</span>
<span class="n">adaptation_table</span> <span class="o">=</span> <span class="n">adaptation_table</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;Study Area&#39;</span><span class="p">,</span> <span class="s1">&#39;BCR&#39;</span><span class="p">],</span> <span class="n">ascending</span><span class="o">=</span><span class="p">[</span><span class="kc">True</span><span class="p">,</span> <span class="kc">False</span><span class="p">])</span>
<span class="c1"># adaptation_table = adaptation_table.sort_values(by=&#39;BCR&#39;, ascending=False)</span>
<span class="n">adaptation_table</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">data_path</span> <span class="o">/</span> <span class="s1">&#39;output&#39;</span> <span class="o">/</span> <span class="s1">&#39;adaptation_table.csv&#39;</span><span class="p">)</span>
<span class="n">adaptation_table</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Adaptation</th>
      <th>Study Area</th>
      <th>BCR</th>
      <th>Benefits</th>
      <th>Costs</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>5</th>
      <td>L2: elevate rail (viaduct)</td>
      <td>Study Area 2</td>
      <td>0.098</td>
      <td>141.086</td>
      <td>1,360.178</td>
    </tr>
    <tr>
      <th>4</th>
      <td>L2: elevate rail (viaduct)</td>
      <td>Study Area 2</td>
      <td>0.086</td>
      <td>117.468</td>
      <td>1,360.178</td>
    </tr>
    <tr>
      <th>3</th>
      <td>L2: elevate rail (viaduct)</td>
      <td>Study Area 2</td>
      <td>0.074</td>
      <td>91.740</td>
      <td>1,360.178</td>
    </tr>
    <tr>
      <th>2</th>
      <td>L1: flood wall</td>
      <td>Study Area 2</td>
      <td>0.068</td>
      <td>27.082</td>
      <td>435.727</td>
    </tr>
    <tr>
      <th>1</th>
      <td>L1: flood wall</td>
      <td>Study Area 2</td>
      <td>0.049</td>
      <td>21.343</td>
      <td>435.727</td>
    </tr>
    <tr>
      <th>0</th>
      <td>L1: flood wall</td>
      <td>Study Area 2</td>
      <td>0.029</td>
      <td>15.079</td>
      <td>435.727</td>
    </tr>
    <tr>
      <th>6</th>
      <td>L3: build new connection</td>
      <td>Study Area 2</td>
      <td>0.000</td>
      <td>0.000</td>
      <td>215.266</td>
    </tr>
    <tr>
      <th>7</th>
      <td>L3: build new connection</td>
      <td>Study Area 2</td>
      <td>0.000</td>
      <td>0.000</td>
      <td>215.266</td>
    </tr>
    <tr>
      <th>8</th>
      <td>L3: build new connection</td>
      <td>Study Area 2</td>
      <td>0.000</td>
      <td>0.000</td>
      <td>215.266</td>
    </tr>
    <tr>
      <th>9</th>
      <td>L4: reduce demand</td>
      <td>Study Area 2</td>
      <td>0.000</td>
      <td>22.575</td>
      <td>0.000</td>
    </tr>
    <tr>
      <th>10</th>
      <td>L4: reduce demand</td>
      <td>Study Area 2</td>
      <td>0.000</td>
      <td>27.705</td>
      <td>0.000</td>
    </tr>
    <tr>
      <th>11</th>
      <td>L4: reduce demand</td>
      <td>Study Area 2</td>
      <td>0.000</td>
      <td>32.402</td>
      <td>0.000</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">bcr_df_beautified</span> <span class="o">=</span> <span class="n">bcr_df</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="n">bcr_df_beautified</span><span class="p">[</span><span class="s1">&#39;Adaptation&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">bcr_df_beautified</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">dict_tags_names</span><span class="p">[</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]])</span>
<span class="n">bcr_df_beautified</span><span class="p">[</span><span class="s1">&#39;Study Area&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">bcr_df_beautified</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">dict_tags_names</span><span class="p">[</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]]</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">))</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="k">else</span> <span class="s1">&#39;Unknown&#39;</span><span class="p">)</span>
<span class="n">bcr_df_beautified</span><span class="p">[</span><span class="s1">&#39;Future Climate&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">bcr_df_beautified</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">dict_tags_names</span><span class="p">[</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]])</span>
<span class="n">bcr_df_beautified</span><span class="p">[</span><span class="s1">&#39;string_id&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">bcr_df_beautified</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;_&#39;</span> <span class="o">+</span> <span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>

<span class="c1">#add index level to dataframe (study area)</span>
<span class="n">bcr_df_beautified</span> <span class="o">=</span> <span class="n">bcr_df_beautified</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
<span class="n">bcr_df_beautified</span><span class="o">.</span><span class="n">set_index</span><span class="p">([</span><span class="s1">&#39;Study Area&#39;</span><span class="p">,</span> <span class="s1">&#39;Adaptation&#39;</span><span class="p">,</span> <span class="s1">&#39;Future Climate&#39;</span><span class="p">],</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">bcr_df_beautified</span> <span class="o">=</span> <span class="n">bcr_df_beautified</span><span class="o">.</span><span class="n">sort_index</span><span class="p">()</span>

<span class="c1"># New formatted columns</span>
<span class="n">bcr_df_beautified</span><span class="p">[</span><span class="s1">&#39;Benefits (M€)&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">bcr_df_beautified</span><span class="p">[</span><span class="s1">&#39;total_avoided_damages&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">x</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="si">:</span><span class="s1">.0f</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39; (&#39;</span> <span class="o">+</span> <span class="n">bcr_df_beautified</span><span class="p">[</span><span class="s1">&#39;total_avoided_damages_lower&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">x</span><span class="si">:</span><span class="s1">.0f</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39; - &#39;</span> <span class="o">+</span> <span class="n">bcr_df_beautified</span><span class="p">[</span><span class="s1">&#39;total_avoided_damages_upper&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">x</span><span class="si">:</span><span class="s1">.0f</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;)&#39;</span>
<span class="n">bcr_df_beautified</span><span class="p">[</span><span class="s1">&#39;Costs (M€)&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">bcr_df_beautified</span><span class="p">[</span><span class="s1">&#39;total_adaptation_cost&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">x</span><span class="si">:</span><span class="s1">.0f</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
<span class="n">bcr_df_beautified</span><span class="p">[</span><span class="s1">&#39;BCR avg (range)&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">bcr_df_beautified</span><span class="p">[</span><span class="s1">&#39;bcr&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">x</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="si">:</span><span class="s1">.2f</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39; (&#39;</span> <span class="o">+</span> <span class="n">bcr_df_beautified</span><span class="p">[</span><span class="s1">&#39;bcr_lower&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">x</span><span class="si">:</span><span class="s1">.2f</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39; - &#39;</span> <span class="o">+</span> <span class="n">bcr_df_beautified</span><span class="p">[</span><span class="s1">&#39;bcr_upper&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">x</span><span class="si">:</span><span class="s1">.2f</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;)&#39;</span>

<span class="c1"># Drop unnecessary columns</span>
<span class="n">drop_cols</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;total_avoided_damages&#39;</span><span class="p">,</span><span class="s1">&#39;total_avoided_damages_lower&#39;</span><span class="p">,</span> <span class="s1">&#39;total_avoided_damages_mean&#39;</span><span class="p">,</span><span class="s1">&#39;total_avoided_damages_upper&#39;</span><span class="p">,</span>  <span class="s1">&#39;total_adaptation_cost&#39;</span><span class="p">,</span> <span class="s1">&#39;bcr&#39;</span><span class="p">,</span> <span class="s1">&#39;bcr_mean&#39;</span><span class="p">,</span> <span class="s1">&#39;bcr_lower&#39;</span><span class="p">,</span> <span class="s1">&#39;bcr_upper&#39;</span><span class="p">,</span> <span class="s1">&#39;level_0&#39;</span><span class="p">,</span> <span class="s1">&#39;level_1&#39;</span><span class="p">]</span>
<span class="n">bcr_df_beautified</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="n">drop_cols</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="c1"># move string id to last column</span>
<span class="n">bcr_df_beautified</span> <span class="o">=</span> <span class="n">bcr_df_beautified</span><span class="p">[[</span><span class="s1">&#39;Benefits (M€)&#39;</span><span class="p">,</span> <span class="s1">&#39;Costs (M€)&#39;</span><span class="p">,</span> <span class="s1">&#39;BCR avg (range)&#39;</span><span class="p">,</span> <span class="s1">&#39;string_id&#39;</span><span class="p">]]</span>

<span class="n">bcr_df_beautified</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th></th>
      <th></th>
      <th>Benefits (M€)</th>
      <th>Costs (M€)</th>
      <th>BCR avg (range)</th>
      <th>string_id</th>
    </tr>
    <tr>
      <th>Study Area</th>
      <th>Adaptation</th>
      <th>Future Climate</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th rowspan="12" valign="top">Study Area 2</th>
      <th rowspan="3" valign="top">L1: flood wall</th>
      <th>Future A</th>
      <td>15 (10 - 20)</td>
      <td>436</td>
      <td>0.03 (0.02 - 0.05)</td>
      <td>l1_trib_lower bound</td>
    </tr>
    <tr>
      <th>Future B</th>
      <td>21 (13 - 30)</td>
      <td>436</td>
      <td>0.05 (0.03 - 0.07)</td>
      <td>l1_trib_mean</td>
    </tr>
    <tr>
      <th>Future C</th>
      <td>27 (16 - 38)</td>
      <td>436</td>
      <td>0.06 (0.04 - 0.09)</td>
      <td>l1_trib_upper bound</td>
    </tr>
    <tr>
      <th rowspan="3" valign="top">L2: elevate rail (viaduct)</th>
      <th>Future A</th>
      <td>92 (80 - 103)</td>
      <td>1360</td>
      <td>0.07 (0.06 - 0.08)</td>
      <td>l2_trib_lower bound</td>
    </tr>
    <tr>
      <th>Future B</th>
      <td>117 (101 - 134)</td>
      <td>1360</td>
      <td>0.09 (0.07 - 0.10)</td>
      <td>l2_trib_mean</td>
    </tr>
    <tr>
      <th>Future C</th>
      <td>141 (120 - 162)</td>
      <td>1360</td>
      <td>0.10 (0.09 - 0.12)</td>
      <td>l2_trib_upper bound</td>
    </tr>
    <tr>
      <th rowspan="3" valign="top">L3: build new connection</th>
      <th>Future A</th>
      <td>0 (0 - 0)</td>
      <td>215</td>
      <td>0.00 (0.00 - 0.00)</td>
      <td>l3_trib_lower bound</td>
    </tr>
    <tr>
      <th>Future B</th>
      <td>0 (0 - 0)</td>
      <td>215</td>
      <td>0.00 (0.00 - 0.00)</td>
      <td>l3_trib_mean</td>
    </tr>
    <tr>
      <th>Future C</th>
      <td>0 (0 - 0)</td>
      <td>215</td>
      <td>0.00 (0.00 - 0.00)</td>
      <td>l3_trib_upper bound</td>
    </tr>
    <tr>
      <th rowspan="3" valign="top">L4: reduce demand</th>
      <th>Future A</th>
      <td>23 (23 - 23)</td>
      <td>0</td>
      <td>0.00 (0.00 - 0.00)</td>
      <td>l4_trib_lower bound</td>
    </tr>
    <tr>
      <th>Future B</th>
      <td>28 (28 - 28)</td>
      <td>0</td>
      <td>0.00 (0.00 - 0.00)</td>
      <td>l4_trib_mean</td>
    </tr>
    <tr>
      <th>Future C</th>
      <td>32 (32 - 32)</td>
      <td>0</td>
      <td>0.00 (0.00 - 0.00)</td>
      <td>l4_trib_upper bound</td>
    </tr>
    <tr>
      <th rowspan="3" valign="top">Unknown</th>
      <th rowspan="3" valign="top">No adaptation</th>
      <th>Future A</th>
      <td>0 (0 - 0)</td>
      <td>0</td>
      <td>0.00 (0.00 - 0.00)</td>
      <td>baseline_lower bound</td>
    </tr>
    <tr>
      <th>Future B</th>
      <td>0 (0 - 0)</td>
      <td>0</td>
      <td>0.00 (0.00 - 0.00)</td>
      <td>baseline_mean</td>
    </tr>
    <tr>
      <th>Future C</th>
      <td>0 (0 - 0)</td>
      <td>0</td>
      <td>0.00 (0.00 - 0.00)</td>
      <td>baseline_upper bound</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./background/AdaptationModelling/book"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                </article>
              

              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="03_batch_process_adaptations.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">Adaptation of CI - A multi-level approach</p>
      </div>
    </a>
    <a class="right-next"
       href="../../../about.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">About Miraca</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By MIRACA
</p>

  </div>
  
  <div class="footer-item">
    

  <p class="copyright">
    
      © Copyright 2023.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script defer src="../../../_static/scripts/bootstrap.js?digest=8878045cc6db502f8baf"></script>
<script defer src="../../../_static/scripts/pydata-sphinx-theme.js?digest=8878045cc6db502f8baf"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>